
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Best practices and techniques for optimizing Chronovyan and) runtime") performance">
      
      
        <meta name="author" content="Chronovyan Team">
      
      
        <link rel="canonical" href="https://chronovyan.github.io/guides/performance/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Performance Optimization - Chronovyan</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-XXXXXXXXXX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#performance-optimization-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Chronovyan" class="md-header__button md-logo" aria-label="Chronovyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chronovyan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Performance Optimization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chronovyan/Chronovyan.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Chronovyan/Chronovyan.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation/" class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Getting%20Started%20-%20The%20Journey%20of%20a%20Temporal%20Developer/" class="md-tabs__link">
          
  
  
    
  
  Language Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../TUTORIAL_ROADMAP/" class="md-tabs__link">
          
  
  
    
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../api_reference/" class="md-tabs__link">
        
  
  
    
  
  API Reference

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../Chronoscript%20Standard%20Library%20Reference/" class="md-tabs__link">
        
  
  
    
  
  Standard Library

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../chronicle_compiler_design/" class="md-tabs__link">
        
  
  
    
  
  Compiler

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../Chronoscript%20Runtime%20Mechanics%20Guide/" class="md-tabs__link">
        
  
  
    
  
  Runtime

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../Chronovyan_Glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../ROADMAP/" class="md-tabs__link">
        
  
  
    
  
  Roadmap

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../CONTRIBUTING.md" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Chronovyan" class="md-nav__button md-logo" aria-label="Chronovyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Chronovyan
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chronovyan/Chronovyan.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    Chronovyan/Chronovyan.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Language Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Language Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Getting%20Started%20-%20The%20Journey%20of%20a%20Temporal%20Developer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basics
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../core/Core%20Concepts%20-%20The%20Foundation%20of%20Temporal%20Programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core Concepts
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced/Advanced Features - The Art of Temporal Mastery.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/act1/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../TUTORIAL_ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial Roadmap
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

              
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/act2/README.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Act 2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api_reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chronoscript%20Standard%20Library%20Reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Standard Library
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../chronicle_compiler_design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compiler
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chronoscript%20Runtime%20Mechanics%20Guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runtime
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Chronovyan_Glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ROADMAP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Roadmap
    
  </span>
  
    
  
  
    <span class="md-status md-status--draft"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#3-memory-benchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      3. Memory Benchmarking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Memory Benchmarking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-cache-behavior-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      4. Cache Behavior Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Cache Behavior Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-thread-scaling-benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      5. Thread Scaling Benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Thread Scaling Benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-benchmark-analysis-and-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      6. Benchmark Analysis and Reporting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Benchmark Analysis and Reporting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-benchmarking-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      7. Benchmarking Best Practices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling-tips" class="md-nav__link">
    <span class="md-ellipsis">
      Profiling Tips
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="performance-optimization-guide">Performance Optimization Guide</h1>
<p>This guide provides best practices and techniques for optimizing the performance of applications using Chronovyan. Following these guidelines will help you write efficient and scalable time-handling code.
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>    graph TD
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>        A[Performance Considerations] --&gt; B[Clock Selection]
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>        A --&gt; C[Time Point Arithmetic]
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        A --&gt; D[Time Zone Optimization]
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        A --&gt; E[String Operations]
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        A --&gt; F[Memory Management]
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        B --&gt; G[system_clock, steady_clock, high_resolution_clock]
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        C --&gt; H[Duration Types, Batch Operations]
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        D --&gt; I[Cache Lookups, Batch Conversions]
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>        E --&gt; J[Pre-allocation, String Views]
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        F --&gt; K[Avoid Copies, Smart Pointers]
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>```text
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>## Table of Contents
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a> [Clock Selection](#))
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>)
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>)) )[)T)i)m)e) )P)o)i)n)t) )A)r)i)t)h)m)e)t)i)c)])()#))
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>)
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>)) )[)T)i)m)e) )Z)o)n)e) )O)p)t)i)m)i)z)a)t)i)o)n)])()#))
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>)
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>)) )[)S)t)r)i)n)g) )O)p)e)r)a)t)i)o)n)s)])()#))
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>)
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>)) )[)D)u)r)a)t)i)o)n) )T)y)p)e)s)])()#))
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>)
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>)) )[)M)e)m)o)r)y) )M)a)n)a)g)e)m)e)n)t)])()#))
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>)
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>)) )[)T)h)r)e)a)d) )S)a)f)e)t)y)])()#))
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>)
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>)) [Compile-Time) Optimization](#))
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>)
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>) [Benchmarking](#))
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>)
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>) [Real-World) Examples](#)r)e)a)l)-)w)o)r)l)d)-)e)x)a)m)p)l)e)s)
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>## Performance Cheat Sheet
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>| Operation | Fast ✅ | Slow ❌ | --- |--------| --- | Clock Access | `steady_clock::now()` |`system_clock::now()` | Time Zone | Cached lookup | Repeated lookups | String Ops | `format_to` with buffer | Multiple allocations | Duration | Fixed-size types | Floating-point | Memory | Stack allocation | Unnecessary copies |
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>##
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>``mermaid
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>    pie
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>        title Clock Characteristics
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>        &quot;Monotonic&quot; : 2
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>        &quot;Adjustable&quot; : 1
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>        &quot;High Precision&quot; : 1
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>```text
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>Choose the most appropriate clock for your use case:
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>| Clock Type | Characteristics | Best For | Performance | --- |-----------------| --- |-------------| `system_clock` | Wall clock time, can be adjusted | Timestamps, logging | ⚡ Fast | `steady_clock` | Monotonic, never adjusted | Measuring intervals, timeouts | ⚡⚡ Very Fast | `high_resolution_clock` | Shortest tick period available | Precise measurements | ⚡⚡⚡ Fastest |
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>###
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>``mermaid
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>    flowchart LR
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>        A[Need Timestamp?] --&gt;|Yes| B[system_clock]
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>        A --&gt;|No| C[Measuring Time?]
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>        C --&gt;|Yes| D[steady_clock]
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>        C --&gt;|No| E[Need Max Precision?]
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>        E --&gt;|Yes| F[high_resolution_clock]
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>        E --&gt;|No| G[steady_clock]
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>```text
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>###
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>``cpp
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a>    // For timestamps (can be affected by system time changes)
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>    auto timestamp = chronovyan::system_clock::now();
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a>    // For measuring intervals (monotonic)
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a>    auto start = chronovyan::steady_clock::now();
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a>    // ... operation ...
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a>    auto end = chronovyan::steady_clock::now();
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a>    auto duration = end - start;
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a>    // For high-precision timing
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a>    auto precise_start = chronovyan::high_resolution_clock::now();
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>    // ... precision-sensitive operation ...
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a>    auto precise_end = chronovyan::high_resolution_clock::now();
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>```text
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a>###
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>``mermaid
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a>    bar
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a>        title Clock Access Latency (lower is better)
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>        system_clock: 15
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a>        steady_clock: 12
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a>        high_resolution_clock: 10
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a>```text
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a>## Time Point Arithmetic
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a>###
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>``cpp
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a>    // Good: Using duration literals
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>    using namespace std::chrono_literals;
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a>    auto timeout = 500ms;
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>    // Better: Compile-time constants when possible
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>    constexpr auto TIMEOUT = 500ms;
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>    constexpr auto CACHE_TTL = 24h;
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a>```text
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>### Batch Operations
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>For operations on multiple time points, process them in batches to improve cache locality:
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>```cpp
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a>    struct Event {
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a>        chronovyan::system_clock::time_point when;
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a>        // ... other data ...
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a>    };
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a>    // Process events in batches
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a>    void process_events(const std::vector&lt;Event&gt;&amp; events) {
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a>        constexpr size_t BATCH_SIZE = 64;
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a>        for (size_t i = 0; i &lt; events.size(); i += BATCH_SIZE) {
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a>            auto batch_end = std::min(i + BATCH_SIZE, events.size());
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>            // Process batch...
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a>        }
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a>    }
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a>```text
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a>##
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a>``mermaid
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a>    pie
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a>        title Time Zone Operation Costs
<a id="__codelineno-0-132" name="__codelineno-0-132" href="#__codelineno-0-132"></a>        &quot;Lookup&quot; : 40
<a id="__codelineno-0-133" name="__codelineno-0-133" href="#__codelineno-0-133"></a>        &quot;Conversion&quot; : 35
<a id="__codelineno-0-134" name="__codelineno-0-134" href="#__codelineno-0-134"></a>        &quot;Cached Lookup&quot; : 5
<a id="__codelineno-0-135" name="__codelineno-0-135" href="#__codelineno-0-135"></a>        &quot;Cached Conversion&quot; : 20
<a id="__codelineno-0-136" name="__codelineno-0-136" href="#__codelineno-0-136"></a>```text
<a id="__codelineno-0-137" name="__codelineno-0-137" href="#__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138" href="#__codelineno-0-138"></a>Time zone operations can be performance bottlenecks. Here&#39;s how to optimize them:
<a id="__codelineno-0-139" name="__codelineno-0-139" href="#__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140" href="#__codelineno-0-140"></a>### 1. Cache Time Zone Lookups
<a id="__codelineno-0-141" name="__codelineno-0-141" href="#__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142" href="#__codelineno-0-142"></a>Time zone lookups are expensive operations. Always cache them when possible.
<a id="__codelineno-0-143" name="__codelineno-0-143" href="#__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144" href="#__codelineno-0-144"></a>####
<a id="__codelineno-0-145" name="__codelineno-0-145" href="#__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146" href="#__codelineno-0-146"></a>``mermaid
<a id="__codelineno-0-147" name="__codelineno-0-147" href="#__codelineno-0-147"></a>    flowchart LR
<a id="__codelineno-0-148" name="__codelineno-0-148" href="#__codelineno-0-148"></a>        A[Loop Start] --&gt; B[Lookup Time Zone]
<a id="__codelineno-0-149" name="__codelineno-0-149" href="#__codelineno-0-149"></a>        B --&gt; C[Use Time Zone]
<a id="__codelineno-0-150" name="__codelineno-0-150" href="#__codelineno-0-150"></a>        C --&gt; D[Next Iteration]
<a id="__codelineno-0-151" name="__codelineno-0-151" href="#__codelineno-0-151"></a>        D --&gt; B
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cities</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">tz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">locate_zone</span><span class="p">(</span><span class="n">city</span><span class="p">.</span><span class="n">time_zone</span><span class="p">);</span><span class="w">  </span><span class="c1">// Expensive!</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="cp">####</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Create</span><span class="w"> </span><span class="n">Cache</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Loop</span><span class="w"> </span><span class="n">Start</span><span class="p">]</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">{</span><span class="n">In</span><span class="w"> </span><span class="n">Cache</span><span class="o">?</span><span class="p">}</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">No</span><span class="o">|</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Lookup</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">Cache</span><span class="p">]</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Yes</span><span class="o">|</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Use</span><span class="w"> </span><span class="n">Cached</span><span class="p">]</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">        </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">        </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Next</span><span class="w"> </span><span class="n">Iteration</span><span class="p">]</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">        </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">time_zone</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">tz_cache</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">city</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cities</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tz_cache</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">city</span><span class="p">.</span><span class="n">time_zone</span><span class="p">);</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tz_cache</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">            </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tz_cache</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">city</span><span class="p">.</span><span class="n">time_zone</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">                                 </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">locate_zone</span><span class="p">(</span><span class="n">city</span><span class="p">.</span><span class="n">time_zone</span><span class="p">)).</span><span class="n">first</span><span class="p">;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">*</span><span class="w"> </span><span class="n">tz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="c1">// Use tz...</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="cp">### 2. Batch Time Zone Conversions</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="n">When</span><span class="w"> </span><span class="n">converting</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">points</span><span class="p">,</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">them</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">batches</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">improve</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="n">locality</span><span class="p">.</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="cp">####</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">    </span><span class="n">gantt</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">Zone</span><span class="w"> </span><span class="n">Conversion</span><span class="w"> </span><span class="n">Strategies</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">        </span><span class="n">dateFormat</span><span class="w">  </span><span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="p">.</span><span class="n">SSS</span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">        </span><span class="n">axisFormat</span><span class="w"> </span><span class="o">%</span><span class="n">S</span><span class="p">.</span><span class="o">%</span><span class="n">Lms</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="n">Conversion</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">        </span><span class="n">Lookup</span><span class="w"> </span><span class="n">TZ</span><span class="w">       </span><span class="o">:</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">        </span><span class="n">Convert</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="o">:</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">s</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">        </span><span class="n">Convert</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="o">:</span><span class="n">a3</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">s</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Batch</span><span class="w"> </span><span class="n">Conversion</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">        </span><span class="n">Single</span><span class="w"> </span><span class="n">Lookup</span><span class="w">   </span><span class="o">:</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">        </span><span class="n">Convert</span><span class="w"> </span><span class="n">All</span><span class="w">     </span><span class="o">:</span><span class="n">b2</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="n">s</span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="cp">####</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">convert_times</span><span class="p">(</span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">utc_times</span><span class="p">,</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="n">tz</span><span class="p">,</span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">zoned_time</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">::</span><span class="n">duration</span><span class="o">&gt;&gt;&amp;</span><span class="w"> </span><span class="n">results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="w">        </span><span class="n">results</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="w">        </span><span class="n">results</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">utc_times</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="w">        </span><span class="c1">// Single time zone lookup, multiple conversions</span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">utc</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">utc_times</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-48" name="__codelineno-2-48" href="#__codelineno-2-48"></a><span class="w">            </span><span class="n">results</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">tz</span><span class="p">,</span><span class="w"> </span><span class="n">utc</span><span class="p">);</span>
<a id="__codelineno-2-49" name="__codelineno-2-49" href="#__codelineno-2-49"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-50" name="__codelineno-2-50" href="#__codelineno-2-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-51" name="__codelineno-2-51" href="#__codelineno-2-51"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-2-52" name="__codelineno-2-52" href="#__codelineno-2-52"></a>
<a id="__codelineno-2-53" name="__codelineno-2-53" href="#__codelineno-2-53"></a><span class="cp">### 3. Time Zone Conversion Performance Tips</span>
<a id="__codelineno-2-54" name="__codelineno-2-54" href="#__codelineno-2-54"></a>
<a id="__codelineno-2-55" name="__codelineno-2-55" href="#__codelineno-2-55"></a><span class="o">|</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cost</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Optimization</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="o">|------|</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">Zone</span><span class="w"> </span><span class="n">Lookup</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">High</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cache</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">First</span><span class="w"> </span><span class="n">Conversion</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">High</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Warm</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="n">early</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Subsequent</span><span class="w"> </span><span class="n">Conversions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Medium</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Batch</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">DST</span><span class="w"> </span><span class="n">Transitions</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Variable</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Pre</span><span class="o">-</span><span class="n">calculate</span><span class="w"> </span><span class="n">transitions</span><span class="w"> </span><span class="o">|</span>
<a id="__codelineno-2-56" name="__codelineno-2-56" href="#__codelineno-2-56"></a>
<a id="__codelineno-2-57" name="__codelineno-2-57" href="#__codelineno-2-57"></a><span class="cp">###</span>
<a id="__codelineno-2-58" name="__codelineno-2-58" href="#__codelineno-2-58"></a>
<a id="__codelineno-2-59" name="__codelineno-2-59" href="#__codelineno-2-59"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-2-60" name="__codelineno-2-60" href="#__codelineno-2-60"></a><span class="w">    </span><span class="n">classDiagram</span>
<a id="__codelineno-2-61" name="__codelineno-2-61" href="#__codelineno-2-61"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">time_zone</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-62" name="__codelineno-2-62" href="#__codelineno-2-62"></a><span class="w">            </span><span class="o">&lt;&lt;</span><span class="n">singleton</span><span class="o">&gt;&gt;</span>
<a id="__codelineno-2-63" name="__codelineno-2-63" href="#__codelineno-2-63"></a><span class="w">            </span><span class="o">+</span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="n">locate_zone</span><span class="p">(</span><span class="n">string_view</span><span class="p">)</span>
<a id="__codelineno-2-64" name="__codelineno-2-64" href="#__codelineno-2-64"></a><span class="w">            </span><span class="o">+</span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="n">current_zone</span><span class="p">()</span>
<a id="__codelineno-2-65" name="__codelineno-2-65" href="#__codelineno-2-65"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-66" name="__codelineno-2-66" href="#__codelineno-2-66"></a>
<a id="__codelineno-2-67" name="__codelineno-2-67" href="#__codelineno-2-67"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">zoned_time</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-68" name="__codelineno-2-68" href="#__codelineno-2-68"></a><span class="w">            </span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="n">zone_</span>
<a id="__codelineno-2-69" name="__codelineno-2-69" href="#__codelineno-2-69"></a><span class="w">            </span><span class="o">-</span><span class="n">sys_time</span><span class="w"> </span><span class="n">time_</span>
<a id="__codelineno-2-70" name="__codelineno-2-70" href="#__codelineno-2-70"></a><span class="w">            </span><span class="o">+</span><span class="n">zoned_time</span><span class="p">()</span>
<a id="__codelineno-2-71" name="__codelineno-2-71" href="#__codelineno-2-71"></a><span class="w">            </span><span class="o">+</span><span class="n">zoned_time</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">sys_time</span><span class="o">&amp;</span><span class="p">)</span>
<a id="__codelineno-2-72" name="__codelineno-2-72" href="#__codelineno-2-72"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-73" name="__codelineno-2-73" href="#__codelineno-2-73"></a>
<a id="__codelineno-2-74" name="__codelineno-2-74" href="#__codelineno-2-74"></a><span class="w">        </span><span class="n">time_zone</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">zoned_time</span>
<a id="__codelineno-2-75" name="__codelineno-2-75" href="#__codelineno-2-75"></a><span class="err">```</span><span class="n">text</span><span class="err">`</span><span class="n">time_zone</span><span class="err">`</span><span class="w"> </span><span class="n">lookups</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="kr">thread</span><span class="o">-</span><span class="n">safe</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="n">startup</span>
<a id="__codelineno-2-76" name="__codelineno-2-76" href="#__codelineno-2-76"></a><span class="o">-</span><span class="w"> </span><span class="err">`</span><span class="n">zoned_time</span><span class="err">`</span><span class="w"> </span><span class="n">objects</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">immutable</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="kr">thread</span><span class="o">-</span><span class="n">safe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">concurrent</span><span class="w"> </span><span class="n">reads</span>
<a id="__codelineno-2-77" name="__codelineno-2-77" href="#__codelineno-2-77"></a><span class="o">-</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">operations</span><span class="p">,</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">synchronization</span><span class="w"> </span><span class="n">primitives</span>
<a id="__codelineno-2-78" name="__codelineno-2-78" href="#__codelineno-2-78"></a>
<a id="__codelineno-2-79" name="__codelineno-2-79" href="#__codelineno-2-79"></a><span class="cp">##</span>
<a id="__codelineno-2-80" name="__codelineno-2-80" href="#__codelineno-2-80"></a>
<a id="__codelineno-2-81" name="__codelineno-2-81" href="#__codelineno-2-81"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-2-82" name="__codelineno-2-82" href="#__codelineno-2-82"></a><span class="w">    </span><span class="n">pie</span>
<a id="__codelineno-2-83" name="__codelineno-2-83" href="#__codelineno-2-83"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">Costs</span>
<a id="__codelineno-2-84" name="__codelineno-2-84" href="#__codelineno-2-84"></a><span class="w">        </span><span class="s">&quot;Allocation&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">45</span>
<a id="__codelineno-2-85" name="__codelineno-2-85" href="#__codelineno-2-85"></a><span class="w">        </span><span class="s">&quot;Formatting&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">35</span>
<a id="__codelineno-2-86" name="__codelineno-2-86" href="#__codelineno-2-86"></a><span class="w">        </span><span class="s">&quot;Parsing&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-2-87" name="__codelineno-2-87" href="#__codelineno-2-87"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-2-88" name="__codelineno-2-88" href="#__codelineno-2-88"></a>
<a id="__codelineno-2-89" name="__codelineno-2-89" href="#__codelineno-2-89"></a><span class="n">String</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">significant</span><span class="w"> </span><span class="n">bottleneck</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">time</span><span class="o">-</span><span class="n">related</span><span class="w"> </span><span class="n">code</span><span class="p">.</span><span class="w"> </span><span class="n">Here</span><span class="err">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">how</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">optimize</span><span class="w"> </span><span class="n">them</span><span class="o">:</span>
<a id="__codelineno-2-90" name="__codelineno-2-90" href="#__codelineno-2-90"></a>
<a id="__codelineno-2-91" name="__codelineno-2-91" href="#__codelineno-2-91"></a><span class="cp">### 1. Avoid Formatting in Tight Loops</span>
<a id="__codelineno-2-92" name="__codelineno-2-92" href="#__codelineno-2-92"></a>
<a id="__codelineno-2-93" name="__codelineno-2-93" href="#__codelineno-2-93"></a><span class="cp">####</span>
<a id="__codelineno-2-94" name="__codelineno-2-94" href="#__codelineno-2-94"></a>
<a id="__codelineno-2-95" name="__codelineno-2-95" href="#__codelineno-2-95"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-2-96" name="__codelineno-2-96" href="#__codelineno-2-96"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-2-97" name="__codelineno-2-97" href="#__codelineno-2-97"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Loop</span><span class="w"> </span><span class="n">Start</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Allocate</span><span class="w"> </span><span class="n">String</span><span class="p">]</span>
<a id="__codelineno-2-98" name="__codelineno-2-98" href="#__codelineno-2-98"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Format</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">String</span><span class="p">]</span>
<a id="__codelineno-2-99" name="__codelineno-2-99" href="#__codelineno-2-99"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Process</span><span class="w"> </span><span class="n">String</span><span class="p">]</span>
<a id="__codelineno-2-100" name="__codelineno-2-100" href="#__codelineno-2-100"></a><span class="w">        </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Deallocate</span><span class="w"> </span><span class="n">String</span><span class="p">]</span>
<a id="__codelineno-2-101" name="__codelineno-2-101" href="#__codelineno-2-101"></a><span class="w">        </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Next</span><span class="w"> </span><span class="n">Iteration</span><span class="p">]</span>
<a id="__codelineno-2-102" name="__codelineno-2-102" href="#__codelineno-2-102"></a><span class="w">        </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">time_points</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">        </span><span class="c1">// New allocation on each iteration!</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">formatted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tp</span><span class="p">);</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="n">process</span><span class="p">(</span><span class="n">formatted</span><span class="p">);</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="cp">####</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Allocate</span><span class="w"> </span><span class="n">Buffer</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Loop</span><span class="w"> </span><span class="n">Start</span><span class="p">]</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Clear</span><span class="w"> </span><span class="n">Buffer</span><span class="p">]</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Format</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Buffer</span><span class="p">]</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">        </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Process</span><span class="w"> </span><span class="n">Buffer</span><span class="p">]</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">        </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Next</span><span class="w"> </span><span class="n">Iteration</span><span class="p">]</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">        </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="c1">// Pre-allocate to avoid reallocations</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">buffer</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span><span class="w">  </span><span class="c1">// Sufficient for most date-time formats</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">tp</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">time_points</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">        </span><span class="c1">// Reuse the same buffer</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">format_to</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">back_inserter</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tp</span><span class="p">);</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="n">process</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="cp">### 2. Use String Views for Parsing</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="n">Avoid</span><span class="w"> </span><span class="n">unnecessary</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">copies</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="err">`</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="err">`</span><span class="o">:</span><span class="err">```</span><span class="n">mermaid</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">    </span><span class="n">classDiagram</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">string_view</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">            </span><span class="o">+</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">()</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">            </span><span class="o">+</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">()</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">            </span><span class="o">+</span><span class="n">string_view</span><span class="w"> </span><span class="n">substr</span><span class="p">()</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">string</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">            </span><span class="o">+</span><span class="n">string</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="p">)</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">            </span><span class="o">+</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="n">c_str</span><span class="p">()</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">        </span><span class="n">string_view</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">string</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="cp">####</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span><span class="o">&gt;</span><span class="w"> </span><span class="n">parse_timestamp</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">        </span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span><span class="w"> </span><span class="n">tp</span><span class="p">;</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">istringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">str</span><span class="p">)};</span><span class="w">  </span><span class="c1">// One allocation</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">        </span><span class="n">ss</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">tp</span><span class="p">);</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">fail</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">tp</span><span class="p">;</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="cp">### 3. Performance Comparison</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="o">|</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="p">(</span><span class="n">ms</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Relative</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="o">|-----------|</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Naive</span><span class="w"> </span><span class="n">Formatting</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">1.0</span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Reused</span><span class="w"> </span><span class="n">Buffer</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">35</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">2.9</span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">View</span><span class="w"> </span><span class="n">Parsing</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">25</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">4.0</span><span class="n">x</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Cached</span><span class="w"> </span><span class="n">Format</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">15</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mf">6.7</span><span class="n">x</span><span class="w"> </span><span class="o">|</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="cp">### 4. Format String Optimization</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="n">Pre</span><span class="o">-</span><span class="n">compile</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="n">strings</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">possible</span><span class="o">:</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="err">```</span><span class="n">cpp</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="w">    </span><span class="c1">// Compile-time format string</span>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">fmt_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">;</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="w">    </span><span class="c1">// At usage:</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="w">    </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">format_to</span><span class="p">(</span><span class="n">back_inserter</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="w">                         </span><span class="n">fmt_string</span><span class="p">,</span>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="w">                         </span><span class="n">time_point</span><span class="p">);</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="cp">###</span>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a><span class="w">    </span><span class="n">gantt</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="n">Allocation</span><span class="w"> </span><span class="n">Strategies</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="w">        </span><span class="n">dateFormat</span><span class="w">  </span><span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="p">.</span><span class="n">SSS</span>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="w">        </span><span class="n">axisFormat</span><span class="w"> </span><span class="o">%</span><span class="n">S</span><span class="p">.</span><span class="o">%</span><span class="n">Lms</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Multiple</span><span class="w"> </span><span class="n">Allocations</span>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="w">        </span><span class="n">Alloc</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a><span class="w">        </span><span class="n">Alloc</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="w">        </span><span class="n">Alloc</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">:</span><span class="n">a3</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Single</span><span class="w"> </span><span class="n">Allocation</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a><span class="w">        </span><span class="n">Large</span><span class="w"> </span><span class="n">Alloc</span><span class="w"> </span><span class="o">:</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="w">        </span><span class="nl">Reuse</span><span class="w">       </span><span class="p">:</span><span class="n">b2</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">s</span>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="err">```</span><span class="n">text</span><span class="o">**</span><span class="n">Avoid</span><span class="o">**</span><span class="n">multiple</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="n">allocations</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">performance</span><span class="o">-</span><span class="n">critical</span><span class="w"> </span><span class="n">code</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="o">-**</span><span class="n">Pre</span><span class="o">-</span><span class="n">allocate</span><span class="o">**</span><span class="n">buffers</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">maximum</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">known</span>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="o">-**</span><span class="n">Reserve</span><span class="o">**</span><span class="n">capacity</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">containers</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">predictable</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="cp">##</span>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a><span class="w">    </span><span class="n">pie</span>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">Usage</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="w">        </span><span class="s">&quot;seconds&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">40</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="w">        </span><span class="s">&quot;milliseconds&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a><span class="w">        </span><span class="s">&quot;microseconds&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">15</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a><span class="w">        </span><span class="s">&quot;nanoseconds&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a><span class="w">        </span><span class="s">&quot;minutes&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a><span class="w">        </span><span class="s">&quot;hours&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a><span class="cp">###</span>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">TD</span>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Need</span><span class="w"> </span><span class="n">Sub</span><span class="o">-</span><span class="n">millisecond</span><span class="o">?</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Yes</span><span class="o">|</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Use</span><span class="w"> </span><span class="n">nanoseconds</span><span class="o">/</span><span class="n">microseconds</span><span class="p">]</span>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a><span class="w">        </span><span class="n">A</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">No</span><span class="o">|</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Human</span><span class="o">-</span><span class="n">readable</span><span class="o">?</span><span class="p">]</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Yes</span><span class="o">|</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Use</span><span class="w"> </span><span class="n">seconds</span><span class="o">/</span><span class="n">minutes</span><span class="o">/</span><span class="n">hours</span><span class="p">]</span>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">No</span><span class="o">|</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Need</span><span class="w"> </span><span class="n">exact</span><span class="w"> </span><span class="n">ms</span><span class="o">?</span><span class="p">]</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a><span class="w">        </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Yes</span><span class="o">|</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Use</span><span class="w"> </span><span class="n">milliseconds</span><span class="p">]</span>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a><span class="w">        </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">No</span><span class="o">|</span><span class="w"> </span><span class="n">G</span><span class="p">[</span><span class="n">Use</span><span class="w"> </span><span class="n">seconds</span><span class="p">]</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="cp">### Duration Type Comparison</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a><span class="o">|</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Precision</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Range</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Memory</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Performance</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Best</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="o">|-----------|</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="o">|--------|</span><span class="w"> </span><span class="o">---</span><span class="w"> </span><span class="o">|----------|</span><span class="w"> </span><span class="err">`</span><span class="n">nanoseconds</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="n">ns</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">±</span><span class="mi">292</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">⚡⚡⚡</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">High</span><span class="o">-</span><span class="n">precision</span><span class="w"> </span><span class="n">timing</span><span class="p">,</span><span class="w"> </span><span class="n">benchmarks</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">`</span><span class="n">microseconds</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="n">µs</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">±</span><span class="mi">292</span><span class="p">,</span><span class="mo">000</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">⚡⚡⚡</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">General</span><span class="w"> </span><span class="n">timing</span><span class="p">,</span><span class="w"> </span><span class="n">I</span><span class="o">/</span><span class="n">O</span><span class="w"> </span><span class="n">operations</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">`</span><span class="n">milliseconds</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="n">ms</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">±</span><span class="mi">292</span><span class="n">M</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">⚡⚡</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">UI</span><span class="w"> </span><span class="n">updates</span><span class="p">,</span><span class="w"> </span><span class="n">networking</span><span class="w"> </span><span class="n">timeouts</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">`</span><span class="n">seconds</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">±</span><span class="mi">292</span><span class="n">B</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">⚡</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">General</span><span class="w"> </span><span class="n">purpose</span><span class="p">,</span><span class="w"> </span><span class="n">timestamps</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">`</span><span class="n">minutes</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="n">min</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">±</span><span class="mf">5.5e18</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">⚡</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Human</span><span class="w"> </span><span class="n">intervals</span><span class="p">,</span><span class="w"> </span><span class="n">scheduling</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">`</span><span class="n">hours</span><span class="err">`</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">1</span><span class="n">h</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">±</span><span class="mf">3.3e17</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="err">⚡</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">durations</span><span class="p">,</span><span class="w"> </span><span class="n">calendar</span><span class="w"> </span><span class="n">events</span><span class="w"> </span><span class="o">|</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a><span class="cp">###</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a><span class="w">    </span><span class="n">classDiagram</span>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">duration</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a><span class="w">            </span><span class="o">+</span><span class="n">rep_</span><span class="w"> </span><span class="n">count_</span>
<a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a><span class="w">            </span><span class="o">+</span><span class="n">period</span><span class="w"> </span><span class="n">period_</span>
<a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a><span class="w">            </span><span class="o">+</span><span class="n">rep</span><span class="w"> </span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a><span class="w">            </span><span class="o">+</span><span class="k">static</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="n">zero</span><span class="p">()</span>
<a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a><span class="w">            </span><span class="o">+</span><span class="n">duration</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">()</span>
<a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a><span class="w">            </span><span class="o">+</span><span class="n">duration</span><span class="w"> </span><span class="k">operator</span><span class="o">-</span><span class="p">()</span>
<a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a>
<a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">seconds</span>
<a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">milliseconds</span>
<a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">microseconds</span>
<a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">nanoseconds</span>
<a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">minutes</span>
<a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">hours</span>
<a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a>
<a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a><span class="cp">###</span>
<a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a>
<a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a><span class="w">    </span><span class="c1">// High-precision timing</span>
<a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a><span class="w">    </span><span class="c1">// ... operation ...</span>
<a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">chronovyan</span><span class="o">::</span><span class="n">nanoseconds</span><span class="o">&gt;</span><span class="p">(</span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">);</span>
<a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a>
<a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a><span class="w">    </span><span class="c1">// Network timeout (human-readable)</span>
<a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="n">ms</span><span class="p">;</span><span class="w">  </span><span class="c1">// More readable than 0.5s or 500&#39;000µs</span>
<a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a>
<a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a><span class="w">    </span><span class="c1">// Calendar event</span>
<a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">meeting_duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="n">h</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">30</span><span class="n">min</span><span class="p">;</span><span class="w">  </span><span class="c1">// Self-documenting</span>
<a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a>
<a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a><span class="w">    </span><span class="c1">// Frame timing (60 FPS)</span>
<a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">frame_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">16.666</span><span class="n">ms</span><span class="p">;</span><span class="w">  </span><span class="c1">// 1/60 second</span>
<a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a>
<a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a><span class="cp">###</span>
<a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a>
<a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a><span class="w">    </span><span class="n">gantt</span>
<a id="__codelineno-4-153" name="__codelineno-4-153" href="#__codelineno-4-153"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="n">Conversion</span><span class="w"> </span><span class="n">Overhead</span>
<a id="__codelineno-4-154" name="__codelineno-4-154" href="#__codelineno-4-154"></a><span class="w">        </span><span class="n">dateFormat</span><span class="w">  </span><span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="p">.</span><span class="n">SSS</span>
<a id="__codelineno-4-155" name="__codelineno-4-155" href="#__codelineno-4-155"></a><span class="w">        </span><span class="n">axisFormat</span><span class="w"> </span><span class="o">%</span><span class="n">S</span><span class="p">.</span><span class="o">%</span><span class="n">Lms</span>
<a id="__codelineno-4-156" name="__codelineno-4-156" href="#__codelineno-4-156"></a>
<a id="__codelineno-4-157" name="__codelineno-4-157" href="#__codelineno-4-157"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">Conversion</span>
<a id="__codelineno-4-158" name="__codelineno-4-158" href="#__codelineno-4-158"></a><span class="w">        </span><span class="nl">Operation</span><span class="w"> </span><span class="p">:</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-4-159" name="__codelineno-4-159" href="#__codelineno-4-159"></a>
<a id="__codelineno-4-160" name="__codelineno-4-160" href="#__codelineno-4-160"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">With</span><span class="w"> </span><span class="n">Conversion</span>
<a id="__codelineno-4-161" name="__codelineno-4-161" href="#__codelineno-4-161"></a><span class="w">        </span><span class="nl">Convert</span><span class="w"> </span><span class="p">:</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-4-162" name="__codelineno-4-162" href="#__codelineno-4-162"></a><span class="w">        </span><span class="nl">Operation</span><span class="w"> </span><span class="p">:</span><span class="n">b2</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-4-163" name="__codelineno-4-163" href="#__codelineno-4-163"></a><span class="err">```</span><span class="n">text</span><span class="o">**</span><span class="n">Prefer</span><span class="o">**</span><span class="k">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">natural</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="n">operations</span>
<a id="__codelineno-4-164" name="__codelineno-4-164" href="#__codelineno-4-164"></a><span class="o">-**</span><span class="n">Avoid</span><span class="o">**</span><span class="n">unnecessary</span><span class="w"> </span><span class="err">`</span><span class="n">duration_cast</span><span class="err">`</span><span class="w"> </span><span class="n">operations</span>
<a id="__codelineno-4-165" name="__codelineno-4-165" href="#__codelineno-4-165"></a><span class="o">-**</span><span class="n">Use</span><span class="o">**</span><span class="n">floating</span><span class="o">-</span><span class="n">point</span><span class="w"> </span><span class="n">durations</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">division</span><span class="o">/</span><span class="n">multiplication</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">exact</span><span class="w"> </span><span class="n">precision</span><span class="w"> </span><span class="n">isn</span><span class="err">&#39;</span><span class="n">t</span><span class="w"> </span><span class="n">critical</span>
<a id="__codelineno-4-166" name="__codelineno-4-166" href="#__codelineno-4-166"></a><span class="o">-**</span><span class="n">Consider</span><span class="o">**</span><span class="n">integer</span><span class="w"> </span><span class="n">durations</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">exact</span><span class="w"> </span><span class="n">arithmetic</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">comparisons</span>
<a id="__codelineno-4-167" name="__codelineno-4-167" href="#__codelineno-4-167"></a>
<a id="__codelineno-4-168" name="__codelineno-4-168" href="#__codelineno-4-168"></a><span class="cp">### Common Pitfalls</span>
<a id="__codelineno-4-169" name="__codelineno-4-169" href="#__codelineno-4-169"></a>
<a id="__codelineno-4-170" name="__codelineno-4-170" href="#__codelineno-4-170"></a><span class="mf">1.</span><span class="o">**</span><span class="n">Mixing</span><span class="w"> </span><span class="n">Duration</span><span class="w"> </span><span class="n">Types</span><span class="o">**</span><span class="err">```</span><span class="n">cpp</span>
<a id="__codelineno-4-171" name="__codelineno-4-171" href="#__codelineno-4-171"></a><span class="w">    </span><span class="c1">// ❌ Error: Can&#39;t add different duration types</span>
<a id="__codelineno-4-172" name="__codelineno-4-172" href="#__codelineno-4-172"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">500</span><span class="n">ms</span><span class="p">;</span><span class="w">  </span><span class="c1">// Error</span>
<a id="__codelineno-4-173" name="__codelineno-4-173" href="#__codelineno-4-173"></a>
<a id="__codelineno-4-174" name="__codelineno-4-174" href="#__codelineno-4-174"></a><span class="w">    </span><span class="c1">// ✅ Correct: Explicit conversion</span>
<a id="__codelineno-4-175" name="__codelineno-4-175" href="#__codelineno-4-175"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">chrono</span><span class="o">::</span><span class="n">duration_cast</span><span class="o">&lt;</span><span class="n">seconds</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">500</span><span class="n">ms</span><span class="p">);</span>
<a id="__codelineno-4-176" name="__codelineno-4-176" href="#__codelineno-4-176"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-177" name="__codelineno-4-177" href="#__codelineno-4-177"></a>
<a id="__codelineno-4-178" name="__codelineno-4-178" href="#__codelineno-4-178"></a><span class="w">    </span><span class="mf">2.</span><span class="o">**</span><span class="n">Loss</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">Precision</span><span class="o">**</span><span class="err">```</span><span class="n">cpp</span>
<a id="__codelineno-4-179" name="__codelineno-4-179" href="#__codelineno-4-179"></a><span class="w">    </span><span class="c1">// ❌ Loses sub-second precision</span>
<a id="__codelineno-4-180" name="__codelineno-4-180" href="#__codelineno-4-180"></a><span class="w">    </span><span class="n">seconds</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span><span class="n">ms</span><span class="p">;</span><span class="w">  </span><span class="c1">// s.count() == 1</span>
<a id="__codelineno-4-181" name="__codelineno-4-181" href="#__codelineno-4-181"></a>
<a id="__codelineno-4-182" name="__codelineno-4-182" href="#__codelineno-4-182"></a><span class="w">    </span><span class="c1">// ✅ Preserves precision</span>
<a id="__codelineno-4-183" name="__codelineno-4-183" href="#__codelineno-4-183"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1500</span><span class="n">ms</span><span class="p">;</span><span class="w">    </span><span class="c1">// 1.5 seconds exactly</span>
<a id="__codelineno-4-184" name="__codelineno-4-184" href="#__codelineno-4-184"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-185" name="__codelineno-4-185" href="#__codelineno-4-185"></a>
<a id="__codelineno-4-186" name="__codelineno-4-186" href="#__codelineno-4-186"></a><span class="w">    </span><span class="mf">3.</span><span class="o">**</span><span class="n">Floating</span><span class="o">-</span><span class="n">point</span><span class="w"> </span><span class="n">Durations</span><span class="o">**</span>
<a id="__codelineno-4-187" name="__codelineno-4-187" href="#__codelineno-4-187"></a><span class="err">```</span><span class="n">cpp</span>
<a id="__codelineno-4-188" name="__codelineno-4-188" href="#__codelineno-4-188"></a><span class="w">       </span><span class="c1">// Good for calculations requiring division</span>
<a id="__codelineno-4-189" name="__codelineno-4-189" href="#__codelineno-4-189"></a><span class="w">       </span><span class="k">using</span><span class="w"> </span><span class="n">fsec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-4-190" name="__codelineno-4-190" href="#__codelineno-4-190"></a>
<a id="__codelineno-4-191" name="__codelineno-4-191" href="#__codelineno-4-191"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">time_series</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">time_series</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-4-192" name="__codelineno-4-192" href="#__codelineno-4-192"></a>
<a id="__codelineno-4-193" name="__codelineno-4-193" href="#__codelineno-4-193"></a><span class="w">    </span><span class="c1">// For lookups by time</span>
<a id="__codelineno-4-194" name="__codelineno-4-194" href="#__codelineno-4-194"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Event</span><span class="o">&gt;</span><span class="w"> </span><span class="n">events</span><span class="p">;</span>
<a id="__codelineno-4-195" name="__codelineno-4-195" href="#__codelineno-4-195"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">events</span><span class="p">.</span><span class="n">lower_bound</span><span class="p">(</span><span class="n">some_time</span><span class="p">);</span>
<a id="__codelineno-4-196" name="__codelineno-4-196" href="#__codelineno-4-196"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-197" name="__codelineno-4-197" href="#__codelineno-4-197"></a>
<a id="__codelineno-4-198" name="__codelineno-4-198" href="#__codelineno-4-198"></a><span class="cp">### 6. Memory Pooling</span>
<a id="__codelineno-4-199" name="__codelineno-4-199" href="#__codelineno-4-199"></a>
<a id="__codelineno-4-200" name="__codelineno-4-200" href="#__codelineno-4-200"></a><span class="n">For</span><span class="w"> </span><span class="n">high</span><span class="o">-</span><span class="n">frequency</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">allocations</span><span class="o">:</span>
<a id="__codelineno-4-201" name="__codelineno-4-201" href="#__codelineno-4-201"></a><span class="err">```</span><span class="n">cpp</span>
<a id="__codelineno-4-202" name="__codelineno-4-202" href="#__codelineno-4-202"></a><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">TimePointPool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-203" name="__codelineno-4-203" href="#__codelineno-4-203"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">pool_</span><span class="p">;</span>
<a id="__codelineno-4-204" name="__codelineno-4-204" href="#__codelineno-4-204"></a>
<a id="__codelineno-4-205" name="__codelineno-4-205" href="#__codelineno-4-205"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-4-206" name="__codelineno-4-206" href="#__codelineno-4-206"></a><span class="w">        </span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">acquire</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-207" name="__codelineno-4-207" href="#__codelineno-4-207"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pool_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-208" name="__codelineno-4-208" href="#__codelineno-4-208"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-4-209" name="__codelineno-4-209" href="#__codelineno-4-209"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-4-210" name="__codelineno-4-210" href="#__codelineno-4-210"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">pool_</span><span class="p">.</span><span class="n">back</span><span class="p">());</span>
<a id="__codelineno-4-211" name="__codelineno-4-211" href="#__codelineno-4-211"></a><span class="w">            </span><span class="n">pool_</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a id="__codelineno-4-212" name="__codelineno-4-212" href="#__codelineno-4-212"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ptr</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>
<a id="__codelineno-4-213" name="__codelineno-4-213" href="#__codelineno-4-213"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-214" name="__codelineno-4-214" href="#__codelineno-4-214"></a>
<a id="__codelineno-4-215" name="__codelineno-4-215" href="#__codelineno-4-215"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">release</span><span class="p">(</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">&gt;*</span><span class="w"> </span><span class="n">tp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-216" name="__codelineno-4-216" href="#__codelineno-4-216"></a><span class="w">            </span><span class="n">pool_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">tp</span><span class="p">));</span>
<a id="__codelineno-4-217" name="__codelineno-4-217" href="#__codelineno-4-217"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-218" name="__codelineno-4-218" href="#__codelineno-4-218"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-4-219" name="__codelineno-4-219" href="#__codelineno-4-219"></a>
<a id="__codelineno-4-220" name="__codelineno-4-220" href="#__codelineno-4-220"></a><span class="w">    </span><span class="cp">##</span>
<a id="__codelineno-4-221" name="__codelineno-4-221" href="#__codelineno-4-221"></a>
<a id="__codelineno-4-222" name="__codelineno-4-222" href="#__codelineno-4-222"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-4-223" name="__codelineno-4-223" href="#__codelineno-4-223"></a><span class="w">    </span><span class="n">pie</span>
<a id="__codelineno-4-224" name="__codelineno-4-224" href="#__codelineno-4-224"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Thread</span><span class="w"> </span><span class="n">Safety</span><span class="w"> </span><span class="n">Concerns</span>
<a id="__codelineno-4-225" name="__codelineno-4-225" href="#__codelineno-4-225"></a><span class="w">        </span><span class="s">&quot;Race Conditions&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">45</span>
<a id="__codelineno-4-226" name="__codelineno-4-226" href="#__codelineno-4-226"></a><span class="w">        </span><span class="s">&quot;Deadlocks&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">25</span>
<a id="__codelineno-4-227" name="__codelineno-4-227" href="#__codelineno-4-227"></a><span class="w">        </span><span class="s">&quot;False Sharing&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-4-228" name="__codelineno-4-228" href="#__codelineno-4-228"></a><span class="w">        </span><span class="s">&quot;Cache Invalidation&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-4-229" name="__codelineno-4-229" href="#__codelineno-4-229"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-4-230" name="__codelineno-4-230" href="#__codelineno-4-230"></a>
<a id="__codelineno-4-231" name="__codelineno-4-231" href="#__codelineno-4-231"></a><span class="cp">### 1. Thread-Local Caching</span>
<a id="__codelineno-4-232" name="__codelineno-4-232" href="#__codelineno-4-232"></a>
<a id="__codelineno-4-233" name="__codelineno-4-233" href="#__codelineno-4-233"></a><span class="cp">####</span>
<a id="__codelineno-4-234" name="__codelineno-4-234" href="#__codelineno-4-234"></a>
<a id="__codelineno-4-235" name="__codelineno-4-235" href="#__codelineno-4-235"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-4-236" name="__codelineno-4-236" href="#__codelineno-4-236"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-4-237" name="__codelineno-4-237" href="#__codelineno-4-237"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Lock</span><span class="o">|</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Global</span><span class="w"> </span><span class="n">Cache</span><span class="p">]</span>
<a id="__codelineno-4-238" name="__codelineno-4-238" href="#__codelineno-4-238"></a><span class="w">        </span><span class="n">C</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Wait</span><span class="o">|</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-4-239" name="__codelineno-4-239" href="#__codelineno-4-239"></a><span class="w">        </span><span class="n">D</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Wait</span><span class="o">|</span><span class="w"> </span><span class="n">B</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="w">    </span><span class="c1">// Global cache with mutex protection</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">cache_mutex</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">global_cache</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="nf">get_time_zone_slow</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">cache_mutex</span><span class="p">);</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_cache</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">global_cache</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">            </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">global_cache</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">locate_zone</span><span class="p">(</span><span class="n">name</span><span class="p">)).</span><span class="n">first</span><span class="p">;</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="cp">####</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Cache</span><span class="p">]</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="w">        </span><span class="n">C</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">Cache</span><span class="p">]</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">        </span><span class="n">E</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Thread</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="n">Cache</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w">    </span><span class="c1">// Each thread gets its own cache</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="nf">get_cached_time_zone</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">        </span><span class="k">thread_local</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">cache</span><span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">            </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">locate_zone</span><span class="p">(</span><span class="n">name</span><span class="p">)).</span><span class="n">first</span><span class="p">;</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="cp">###</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="n">classDiagram</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">time_point</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">            </span><span class="o">+</span><span class="n">duration</span><span class="w"> </span><span class="n">time_since_epoch</span><span class="p">()</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">            </span><span class="o">+</span><span class="n">time_point</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">duration</span><span class="o">&amp;</span><span class="p">)</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">            </span><span class="o">+</span><span class="k">static</span><span class="w"> </span><span class="n">time_point</span><span class="w"> </span><span class="n">min</span><span class="p">()</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">            </span><span class="o">+</span><span class="k">static</span><span class="w"> </span><span class="n">time_point</span><span class="w"> </span><span class="n">max</span><span class="p">()</span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">zoned_time</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">            </span><span class="o">-</span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="n">zone_</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">            </span><span class="o">-</span><span class="n">sys_time</span><span class="w"> </span><span class="n">time_</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">            </span><span class="o">+</span><span class="n">zoned_time</span><span class="p">()</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">            </span><span class="o">+</span><span class="n">zoned_time</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">sys_time</span><span class="o">&amp;</span><span class="p">)</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">            </span><span class="o">+</span><span class="n">sys_time</span><span class="w"> </span><span class="n">get_sys_time</span><span class="p">()</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">            </span><span class="o">+</span><span class="n">local_time</span><span class="w"> </span><span class="n">get_local_time</span><span class="p">()</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">        </span><span class="n">time_point</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">zoned_time</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="err">```</span><span class="n">text</span><span class="err">`</span><span class="n">time_point</span><span class="err">`</span><span class="w"> </span><span class="k">and</span><span class="err">`</span><span class="n">zoned_time</span><span class="err">`</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="kr">thread</span><span class="o">-</span><span class="n">safe</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">concurrent</span><span class="w"> </span><span class="n">reads</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="o">-</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">synchronization</span><span class="w"> </span><span class="n">needed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">operations</span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="o">-</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">modifications</span><span class="p">,</span><span class="w"> </span><span class="n">external</span><span class="w"> </span><span class="n">synchronization</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">required</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="cp">### 3. Thread Safety Patterns</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="cp">####</span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">    </span><span class="n">sequenceDiagram</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">        </span><span class="n">participant</span><span class="w"> </span><span class="n">Reader1</span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">        </span><span class="n">participant</span><span class="w"> </span><span class="n">Reader2</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">        </span><span class="n">participant</span><span class="w"> </span><span class="n">Writer</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">        </span><span class="n">participant</span><span class="w"> </span><span class="n">Data</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="w">        </span><span class="n">Reader1</span><span class="o">-&gt;&gt;</span><span class="n">Data</span><span class="o">:</span><span class="w"> </span><span class="n">Read</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">lock</span><span class="p">)</span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">        </span><span class="n">Reader2</span><span class="o">-&gt;&gt;</span><span class="n">Data</span><span class="o">:</span><span class="w"> </span><span class="n">Read</span><span class="w"> </span><span class="p">(</span><span class="n">no</span><span class="w"> </span><span class="n">lock</span><span class="p">)</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="w">        </span><span class="n">Writer</span><span class="o">-&gt;&gt;</span><span class="n">Data</span><span class="o">:</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">copy</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="w">        </span><span class="n">Writer</span><span class="o">-&gt;&gt;</span><span class="n">Data</span><span class="o">:</span><span class="w"> </span><span class="n">Atomic</span><span class="w"> </span><span class="n">swap</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">        </span><span class="n">Reader1</span><span class="o">-&gt;&gt;</span><span class="n">Data</span><span class="o">:</span><span class="w"> </span><span class="n">Read</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">version</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="cp">####</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">TimeZoneCache</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*&gt;&gt;</span><span class="w"> </span><span class="n">cache_</span><span class="p">;</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="w">        </span><span class="n">TimeZoneCache</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">cache_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*&gt;&gt;</span><span class="p">())</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">new_cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">cache_</span><span class="p">);</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="w">            </span><span class="c1">// Update new_cache...</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">atomic_store</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cache_</span><span class="p">,</span><span class="w"> </span><span class="n">new_cache</span><span class="p">);</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="w"> </span><span class="n">get</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">atomic_load</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cache_</span><span class="p">);</span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cache</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a><span class="cp">###</span>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a><span class="w">    </span><span class="n">gantt</span>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">False</span><span class="w"> </span><span class="n">Sharing</span><span class="w"> </span><span class="n">Impact</span>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a><span class="w">        </span><span class="n">dateFormat</span><span class="w">  </span><span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="p">.</span><span class="n">SSS</span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a><span class="w">        </span><span class="n">axisFormat</span><span class="w"> </span><span class="o">%</span><span class="n">S</span><span class="p">.</span><span class="o">%</span><span class="n">Lms</span>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">With</span><span class="w"> </span><span class="n">False</span><span class="w"> </span><span class="n">Sharing</span>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">s</span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">s</span>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Without</span><span class="w"> </span><span class="n">False</span><span class="w"> </span><span class="n">Sharing</span>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a><span class="w">        </span><span class="n">Thread</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="n">b2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a><span class="cp">####</span>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">alignas</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="n">PaddedCounter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">counter</span><span class="p">;</span>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a><span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">padding</span><span class="p">[</span><span class="mi">64</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">)];</span><span class="w">  </span><span class="c1">// Pad to cache line size</span>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a><span class="w">    </span><span class="c1">// Array of counters, each on its own cache line</span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a><span class="w">    </span><span class="n">PaddedCounter</span><span class="w"> </span><span class="n">counters</span><span class="p">[</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">::</span><span class="n">hardware_concurrency</span><span class="p">()];</span>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a><span class="cp">###</span>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">TD</span>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Get</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">Zone</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">{</span><span class="n">In</span><span class="w"> </span><span class="n">Cache</span><span class="o">?</span><span class="p">}</span>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Yes</span><span class="o">|</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Return</span><span class="w"> </span><span class="n">Cached</span><span class="p">]</span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">No</span><span class="o">|</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Create</span><span class="w"> </span><span class="n">New</span><span class="p">]</span>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a><span class="w">        </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Add</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Cache</span><span class="p">]</span>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a><span class="w">        </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a><span class="cp">####</span>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">TimeZoneFactory</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a><span class="w">        </span><span class="k">mutable</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex_</span><span class="p">;</span>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">cache_</span><span class="p">;</span>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">&gt;</span><span class="w"> </span><span class="n">get_time_zone</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a>
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a><span class="w">            </span><span class="c1">// Check if we have a valid entry in cache</span>
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">cache_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">lock</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">sp</span><span class="p">;</span><span class="w">  </span><span class="c1">// Return existing shared_ptr</span>
<a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a><span class="w">                </span><span class="c1">// Entry exists but expired, remove it</span>
<a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a><span class="w">                </span><span class="n">cache_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
<a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a>
<a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a><span class="w">            </span><span class="c1">// Create new entry</span>
<a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">tz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">time_zone</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a><span class="w">                </span><span class="n">locate_zone</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
<a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a><span class="w">                </span><span class="p">[</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">](</span><span class="o">/</span><span class="p">)</span><span class="n">c</span><span class="p">)</span><span class="n">o</span><span class="p">)</span><span class="n">n</span><span class="p">)</span><span class="n">s</span><span class="p">)</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="n">time_zone</span><span class="o">*</span><span class="n">tz</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a><span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a><span class="w">                    </span><span class="n">cache_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a><span class="w">                    </span><span class="k">delete</span><span class="w"> </span><span class="n">tz</span><span class="p">;</span>
<a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a><span class="w">            </span><span class="p">);</span>
<a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a>
<a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a><span class="w">            </span><span class="n">cache_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tz</span><span class="p">;</span>
<a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tz</span><span class="p">;</span>
<a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a>
<a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a><span class="cp">##</span>
<a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a>
<a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a><span class="w">    </span><span class="n">pie</span>
<a id="__codelineno-6-159" name="__codelineno-6-159" href="#__codelineno-6-159"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Compile</span><span class="o">-</span><span class="n">Time</span><span class="w"> </span><span class="n">Benefits</span>
<a id="__codelineno-6-160" name="__codelineno-6-160" href="#__codelineno-6-160"></a><span class="w">        </span><span class="s">&quot;Faster Runtime&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">40</span>
<a id="__codelineno-6-161" name="__codelineno-6-161" href="#__codelineno-6-161"></a><span class="w">        </span><span class="s">&quot;Smaller Binary&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-6-162" name="__codelineno-6-162" href="#__codelineno-6-162"></a><span class="w">        </span><span class="s">&quot;Better Optimizations&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-6-163" name="__codelineno-6-163" href="#__codelineno-6-163"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-6-164" name="__codelineno-6-164" href="#__codelineno-6-164"></a>
<a id="__codelineno-6-165" name="__codelineno-6-165" href="#__codelineno-6-165"></a><span class="cp">### 1. Compile-Time Calculations</span>
<a id="__codelineno-6-166" name="__codelineno-6-166" href="#__codelineno-6-166"></a>
<a id="__codelineno-6-167" name="__codelineno-6-167" href="#__codelineno-6-167"></a><span class="cp">####</span>
<a id="__codelineno-6-168" name="__codelineno-6-168" href="#__codelineno-6-168"></a>
<a id="__codelineno-6-169" name="__codelineno-6-169" href="#__codelineno-6-169"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-6-170" name="__codelineno-6-170" href="#__codelineno-6-170"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-6-171" name="__codelineno-6-171" href="#__codelineno-6-171"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Program</span><span class="w"> </span><span class="n">Start</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Calculate</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">Runtime</span><span class="p">]</span>
<a id="__codelineno-6-172" name="__codelineno-6-172" href="#__codelineno-6-172"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Use</span><span class="w"> </span><span class="n">Result</span><span class="p">]</span>
<a id="__codelineno-6-173" name="__codelineno-6-173" href="#__codelineno-6-173"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Program</span><span class="w"> </span><span class="n">End</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="w">    </span><span class="c1">// Calculated every time the function is called</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">get_week_later</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="o">*</span><span class="w"> </span><span class="mi">24</span><span class="n">h</span><span class="p">;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="cp">####</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Compile</span><span class="w"> </span><span class="n">Time</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Calculate</span><span class="w"> </span><span class="n">Value</span><span class="p">]</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">        </span><span class="n">C</span><span class="p">[</span><span class="n">Runtime</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Use</span><span class="w"> </span><span class="n">Precomputed</span><span class="w"> </span><span class="n">Value</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="w">    </span><span class="c1">// Compile-time duration calculations</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">one_day</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span><span class="n">h</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">one_week</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="o">*</span><span class="n">one_day</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">one_year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">365</span><span class="o">*</span><span class="w"> </span><span class="n">one_day</span><span class="p">;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="c1">// Compile-time time point calculations</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">epoch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system_clock</span><span class="o">::</span><span class="n">time_point</span><span class="p">{};</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">year_2000</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epoch</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">946&#39;684&#39;800</span><span class="n">s</span><span class="p">;</span><span class="w">  </span><span class="c1">// 2000-01-01 00:00:00 UTC</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="c1">// Known at compile time</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Clock</span><span class="o">&gt;</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">get_week_later</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">one_week</span><span class="p">;</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="cp">### 2. Type Aliases and Constants</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="cp">####</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">    </span><span class="n">classDiagram</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">duration</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">            </span><span class="o">&lt;&lt;</span><span class="n">templated</span><span class="o">&gt;&gt;</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="w">            </span><span class="o">+</span><span class="n">rep</span><span class="w"> </span><span class="n">count</span><span class="p">()</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="w">            </span><span class="o">+</span><span class="k">static</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="n">zero</span><span class="p">()</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">        </span><span class="k">class</span><span class="w"> </span><span class="nc">time_point</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="w">            </span><span class="o">&lt;&lt;</span><span class="n">templated</span><span class="o">&gt;&gt;</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">            </span><span class="o">+</span><span class="n">duration</span><span class="w"> </span><span class="n">time_since_epoch</span><span class="p">()</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">seconds</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">        </span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">milliseconds</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="w">        </span><span class="n">time_point</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">sys_time</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="w">        </span><span class="n">time_point</span><span class="w"> </span><span class="o">&lt;|--</span><span class="w"> </span><span class="n">local_time</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">        </span><span class="n">note</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">time_point</span><span class="w"> </span><span class="s">&quot;Commonly used aliases:</span><span class="se">\n</span><span class="s">- sys_time: System clock time</span><span class="se">\n</span><span class="s">- local_time: Local time&quot;</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="cp">####</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">    </span><span class="c1">// Duration types</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">86400</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">weeks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">604800</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">months</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">2629746</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w">  </span><span class="c1">// 30.44 days</span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">31556952</span><span class="o">&gt;&gt;</span><span class="p">;</span><span class="w">  </span><span class="c1">// 365.24 days</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="w">    </span><span class="c1">// Time point types</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">sys_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">system_clock</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">steady_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">steady_clock</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">highres_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_point</span><span class="o">&lt;</span><span class="n">high_resolution_clock</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="cp">### 3. Compile-Time String Processing</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="cp">####</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">TD</span>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Compile</span><span class="w"> </span><span class="n">Time</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Validate</span><span class="w"> </span><span class="n">Format</span><span class="w"> </span><span class="n">String</span><span class="p">]</span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Valid</span><span class="o">|</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Compile</span><span class="w"> </span><span class="n">Success</span><span class="p">]</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Invalid</span><span class="o">|</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Compile</span><span class="w"> </span><span class="n">Error</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">validate_format_string</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="n">fmt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="c1">// Compile-time format string validation</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">        </span><span class="c1">// Will fail to compile if format string is invalid</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">        </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">parse</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">{}...);</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="c1">// Usage:</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="c1">// validate_format_string&lt;year, month, day&gt;(&quot;%Y-%m-%d&quot;);  // OK</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">    </span><span class="c1">// validate_format_string&lt;year, month, day&gt;(&quot;%Y-%m&quot;);    // Compile error</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="cp">### 4. Compile-Time Date Calculations</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="cp">####</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">LR</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Year</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">{</span><span class="n">Is</span><span class="w"> </span><span class="n">Leap</span><span class="w"> </span><span class="n">Year</span><span class="o">?</span><span class="p">}</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Yes</span><span class="o">|</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="mi">366</span><span class="w"> </span><span class="n">Days</span><span class="p">]</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">No</span><span class="o">|</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="mi">365</span><span class="w"> </span><span class="n">Days</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">is_leap_year</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">400</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">days_in_month</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="n">m</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">is_leap_year</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">29</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">28</span><span class="p">;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">        </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">days</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">31</span><span class="p">};</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">days</span><span class="p">[</span><span class="n">m</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="c1">// Compile-time validation</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">days_in_month</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">29</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2020 was a leap year&quot;</span><span class="p">);</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">days_in_month</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2021 is not a leap year&quot;</span><span class="p">);</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="cp">###</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">    </span><span class="n">gantt</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Runtime</span><span class="w"> </span><span class="n">vs</span><span class="w"> </span><span class="n">Compile</span><span class="o">-</span><span class="n">Time</span><span class="w"> </span><span class="n">Calculation</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">        </span><span class="n">dateFormat</span><span class="w">  </span><span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="p">.</span><span class="n">SSS</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="w">        </span><span class="n">axisFormat</span><span class="w"> </span><span class="o">%</span><span class="n">S</span><span class="p">.</span><span class="o">%</span><span class="n">Lms</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Runtime</span>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">        </span><span class="nl">Calculate</span><span class="w"> </span><span class="p">:</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="n">s</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>
<a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Compile</span><span class="o">-</span><span class="n">Time</span>
<a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">        </span><span class="n">Use</span><span class="w"> </span><span class="n">Value</span><span class="w"> </span><span class="o">:</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="err">```</span><span class="n">text</span><span class="o">**</span><span class="n">Zero</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">overhead</span><span class="o">**</span><span class="k">for</span><span class="w"> </span><span class="n">compile</span><span class="o">-</span><span class="n">time</span><span class="w"> </span><span class="n">calculations</span>
<a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="o">-**</span><span class="n">Better</span><span class="w"> </span><span class="n">optimization</span><span class="o">**</span><span class="n">opportunities</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">compiler</span>
<a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="o">-**</span><span class="n">Smaller</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">size</span><span class="o">**</span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">constant</span><span class="w"> </span><span class="n">folding</span>
<a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="o">-**</span><span class="n">Early</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">detection</span><span class="o">**</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="n">time</span>
<a id="__codelineno-10-33" name="__codelineno-10-33" href="#__codelineno-10-33"></a>
<a id="__codelineno-10-34" name="__codelineno-10-34" href="#__codelineno-10-34"></a><span class="cp">###</span>
<a id="__codelineno-10-35" name="__codelineno-10-35" href="#__codelineno-10-35"></a>
<a id="__codelineno-10-36" name="__codelineno-10-36" href="#__codelineno-10-36"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-10-37" name="__codelineno-10-37" href="#__codelineno-10-37"></a><span class="w">    </span><span class="c1">// Type-safe duration units</span>
<a id="__codelineno-10-38" name="__codelineno-10-38" href="#__codelineno-10-38"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Rep</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">Period</span><span class="o">&gt;</span>
<a id="__codelineno-10-39" name="__codelineno-10-39" href="#__codelineno-10-39"></a><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">duration</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-40" name="__codelineno-10-40" href="#__codelineno-10-40"></a><span class="w">        </span><span class="n">Rep</span><span class="w"> </span><span class="n">rep_</span><span class="p">;</span>
<a id="__codelineno-10-41" name="__codelineno-10-41" href="#__codelineno-10-41"></a><span class="w">    </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-10-42" name="__codelineno-10-42" href="#__codelineno-10-42"></a><span class="w">        </span><span class="k">constexpr</span><span class="w"> </span><span class="k">explicit</span><span class="w"> </span><span class="n">duration</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Rep</span><span class="o">&amp;</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">rep_</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-10-43" name="__codelineno-10-43" href="#__codelineno-10-43"></a><span class="w">        </span><span class="k">constexpr</span><span class="w"> </span><span class="n">Rep</span><span class="w"> </span><span class="n">count</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">rep_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-10-44" name="__codelineno-10-44" href="#__codelineno-10-44"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-10-45" name="__codelineno-10-45" href="#__codelineno-10-45"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-10-46" name="__codelineno-10-46" href="#__codelineno-10-46"></a>
<a id="__codelineno-10-47" name="__codelineno-10-47" href="#__codelineno-10-47"></a><span class="w">    </span><span class="c1">// User-defined literals</span>
<a id="__codelineno-10-48" name="__codelineno-10-48" href="#__codelineno-10-48"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="s">&quot;&quot;</span><span class="n">_days</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-49" name="__codelineno-10-49" href="#__codelineno-10-49"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ratio</span><span class="o">&lt;</span><span class="mi">86400</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
<a id="__codelineno-10-50" name="__codelineno-10-50" href="#__codelineno-10-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-51" name="__codelineno-10-51" href="#__codelineno-10-51"></a>
<a id="__codelineno-10-52" name="__codelineno-10-52" href="#__codelineno-10-52"></a><span class="w">    </span><span class="c1">// Usage:</span>
<a id="__codelineno-10-53" name="__codelineno-10-53" href="#__codelineno-10-53"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">two_weeks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">14</span><span class="n">_days</span><span class="p">;</span><span class="w">  </span><span class="c1">// Type-safe, checked at compile time</span>
<a id="__codelineno-10-54" name="__codelineno-10-54" href="#__codelineno-10-54"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-10-55" name="__codelineno-10-55" href="#__codelineno-10-55"></a>
<a id="__codelineno-10-56" name="__codelineno-10-56" href="#__codelineno-10-56"></a><span class="cp">###</span>
<a id="__codelineno-10-57" name="__codelineno-10-57" href="#__codelineno-10-57"></a>
<a id="__codelineno-10-58" name="__codelineno-10-58" href="#__codelineno-10-58"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-10-59" name="__codelineno-10-59" href="#__codelineno-10-59"></a><span class="w">    </span><span class="c1">// Compile-time format string processing</span>
<a id="__codelineno-10-60" name="__codelineno-10-60" href="#__codelineno-10-60"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="__codelineno-10-61" name="__codelineno-10-61" href="#__codelineno-10-61"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">make_format_string</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-62" name="__codelineno-10-62" href="#__codelineno-10-62"></a><span class="w">        </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="n">fmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">;</span>
<a id="__codelineno-10-63" name="__codelineno-10-63" href="#__codelineno-10-63"></a><span class="w">        </span><span class="c1">// Validate format string at compile time</span>
<a id="__codelineno-10-64" name="__codelineno-10-64" href="#__codelineno-10-64"></a><span class="w">        </span><span class="k">static_assert</span><span class="p">(</span><span class="n">validate_format_string</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fmt</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;Invalid format string&quot;</span><span class="p">);</span>
<a id="__codelineno-10-65" name="__codelineno-10-65" href="#__codelineno-10-65"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">fmt</span><span class="p">;</span>
<a id="__codelineno-10-66" name="__codelineno-10-66" href="#__codelineno-10-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-67" name="__codelineno-10-67" href="#__codelineno-10-67"></a>
<a id="__codelineno-10-68" name="__codelineno-10-68" href="#__codelineno-10-68"></a><span class="w">    </span><span class="c1">// Usage:</span>
<a id="__codelineno-10-69" name="__codelineno-10-69" href="#__codelineno-10-69"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">fmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_format_string</span><span class="o">&lt;</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">month</span><span class="p">,</span><span class="w"> </span><span class="n">day</span><span class="p">,</span><span class="w"> </span><span class="n">hours</span><span class="p">,</span><span class="w"> </span><span class="n">minutes</span><span class="p">,</span><span class="w"> </span><span class="n">seconds</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-10-70" name="__codelineno-10-70" href="#__codelineno-10-70"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-10-71" name="__codelineno-10-71" href="#__codelineno-10-71"></a>
<a id="__codelineno-10-72" name="__codelineno-10-72" href="#__codelineno-10-72"></a><span class="cp">##</span>
<a id="__codelineno-10-73" name="__codelineno-10-73" href="#__codelineno-10-73"></a>
<a id="__codelineno-10-74" name="__codelineno-10-74" href="#__codelineno-10-74"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-10-75" name="__codelineno-10-75" href="#__codelineno-10-75"></a><span class="w">    </span><span class="n">pie</span>
<a id="__codelineno-10-76" name="__codelineno-10-76" href="#__codelineno-10-76"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Benchmarking</span><span class="w"> </span><span class="n">Focus</span><span class="w"> </span><span class="n">Areas</span>
<a id="__codelineno-10-77" name="__codelineno-10-77" href="#__codelineno-10-77"></a><span class="w">        </span><span class="s">&quot;CPU Time&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">40</span>
<a id="__codelineno-10-78" name="__codelineno-10-78" href="#__codelineno-10-78"></a><span class="w">        </span><span class="s">&quot;Memory Usage&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">30</span>
<a id="__codelineno-10-79" name="__codelineno-10-79" href="#__codelineno-10-79"></a><span class="w">        </span><span class="s">&quot;Cache Behavior&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">20</span>
<a id="__codelineno-10-80" name="__codelineno-10-80" href="#__codelineno-10-80"></a><span class="w">        </span><span class="s">&quot;Thread Contention&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">10</span>
<a id="__codelineno-10-81" name="__codelineno-10-81" href="#__codelineno-10-81"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-10-82" name="__codelineno-10-82" href="#__codelineno-10-82"></a>
<a id="__codelineno-10-83" name="__codelineno-10-83" href="#__codelineno-10-83"></a><span class="cp">### 1. Benchmarking with Google Benchmark</span>
<a id="__codelineno-10-84" name="__codelineno-10-84" href="#__codelineno-10-84"></a>
<a id="__codelineno-10-85" name="__codelineno-10-85" href="#__codelineno-10-85"></a><span class="cp">####</span>
<a id="__codelineno-10-86" name="__codelineno-10-86" href="#__codelineno-10-86"></a>
<a id="__codelineno-10-87" name="__codelineno-10-87" href="#__codelineno-10-87"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-10-88" name="__codelineno-10-88" href="#__codelineno-10-88"></a><span class="w">    </span><span class="n">flowchart</span><span class="w"> </span><span class="n">TD</span>
<a id="__codelineno-10-89" name="__codelineno-10-89" href="#__codelineno-10-89"></a><span class="w">        </span><span class="n">A</span><span class="p">[</span><span class="n">Setup</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Start</span><span class="w"> </span><span class="n">Timer</span><span class="p">]</span>
<a id="__codelineno-10-90" name="__codelineno-10-90" href="#__codelineno-10-90"></a><span class="w">        </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Run</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">Code</span><span class="p">]</span>
<a id="__codelineno-10-91" name="__codelineno-10-91" href="#__codelineno-10-91"></a><span class="w">        </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Stop</span><span class="w"> </span><span class="n">Timer</span><span class="p">]</span>
<a id="__codelineno-10-92" name="__codelineno-10-92" href="#__codelineno-10-92"></a><span class="w">        </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Report</span><span class="w"> </span><span class="n">Results</span><span class="p">]</span>
<a id="__codelineno-10-93" name="__codelineno-10-93" href="#__codelineno-10-93"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-10-94" name="__codelineno-10-94" href="#__codelineno-10-94"></a>
<a id="__codelineno-10-95" name="__codelineno-10-95" href="#__codelineno-10-95"></a><span class="cp">####</span>
<a id="__codelineno-10-96" name="__codelineno-10-96" href="#__codelineno-10-96"></a>
<a id="__codelineno-10-97" name="__codelineno-10-97" href="#__codelineno-10-97"></a><span class="err">``</span><span class="n">cpp</span>
<a id="__codelineno-10-98" name="__codelineno-10-98" href="#__codelineno-10-98"></a><span class="w">    </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;benchmark/benchmark.h&gt;</span>
<a id="__codelineno-10-99" name="__codelineno-10-99" href="#__codelineno-10-99"></a>
<a id="__codelineno-10-100" name="__codelineno-10-100" href="#__codelineno-10-100"></a><span class="w">    </span><span class="c1">// Benchmark time formatting</span>
<a id="__codelineno-10-101" name="__codelineno-10-101" href="#__codelineno-10-101"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">BM_TimeFormatting</span><span class="p">(</span><span class="n">benchmark</span><span class="o">::</span><span class="n">State</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-102" name="__codelineno-10-102" href="#__codelineno-10-102"></a><span class="w">        </span><span class="c1">// Setup (not measured)</span>
<a id="__codelineno-10-103" name="__codelineno-10-103" href="#__codelineno-10-103"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-10-104" name="__codelineno-10-104" href="#__codelineno-10-104"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-10-105" name="__codelineno-10-105" href="#__codelineno-10-105"></a><span class="w">        </span><span class="n">buffer</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
<a id="__codelineno-10-106" name="__codelineno-10-106" href="#__codelineno-10-106"></a>
<a id="__codelineno-10-107" name="__codelineno-10-107" href="#__codelineno-10-107"></a><span class="w">        </span><span class="c1">// Benchmark loop</span>
<a id="__codelineno-10-108" name="__codelineno-10-108" href="#__codelineno-10-108"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-109" name="__codelineno-10-109" href="#__codelineno-10-109"></a><span class="w">            </span><span class="n">buffer</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-10-110" name="__codelineno-10-110" href="#__codelineno-10-110"></a><span class="w">            </span><span class="c1">// Format time to string</span>
<a id="__codelineno-10-111" name="__codelineno-10-111" href="#__codelineno-10-111"></a><span class="w">            </span><span class="n">chronovyan</span><span class="o">::</span><span class="n">format_to</span><span class="p">(</span>
<a id="__codelineno-10-112" name="__codelineno-10-112" href="#__codelineno-10-112"></a><span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">back_inserter</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span>
<a id="__codelineno-10-113" name="__codelineno-10-113" href="#__codelineno-10-113"></a><span class="w">                </span><span class="s">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">,</span>
<a id="__codelineno-10-114" name="__codelineno-10-114" href="#__codelineno-10-114"></a><span class="w">                </span><span class="n">now</span>
<a id="__codelineno-10-115" name="__codelineno-10-115" href="#__codelineno-10-115"></a><span class="w">            </span><span class="p">);</span>
<a id="__codelineno-10-116" name="__codelineno-10-116" href="#__codelineno-10-116"></a><span class="w">            </span><span class="c1">// Prevent compiler optimizations</span>
<a id="__codelineno-10-117" name="__codelineno-10-117" href="#__codelineno-10-117"></a><span class="w">            </span><span class="n">benchmark</span><span class="o">::</span><span class="n">DoNotOptimize</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-10-118" name="__codelineno-10-118" href="#__codelineno-10-118"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-10-119" name="__codelineno-10-119" href="#__codelineno-10-119"></a>
<a id="__codelineno-10-120" name="__codelineno-10-120" href="#__codelineno-10-120"></a><span class="w">        </span><span class="c1">// Optional: Set custom metrics</span>
<a id="__codelineno-10-121" name="__codelineno-10-121" href="#__codelineno-10-121"></a><span class="w">        </span><span class="n">state</span><span class="p">.</span><span class="n">SetBytesProcessed</span><span class="p">(</span>
<a id="__codelineno-10-122" name="__codelineno-10-122" href="#__codelineno-10-122"></a><span class="w">            </span><span class="kt">int64_t</span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">iterations</span><span class="p">())</span><span class="o">*</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">size</span><span class="p">()</span>
<a id="__codelineno-10-123" name="__codelineno-10-123" href="#__codelineno-10-123"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-10-124" name="__codelineno-10-124" href="#__codelineno-10-124"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-125" name="__codelineno-10-125" href="#__codelineno-10-125"></a>
<a id="__codelineno-10-126" name="__codelineno-10-126" href="#__codelineno-10-126"></a><span class="w">    </span><span class="c1">// Register benchmark</span>
<a id="__codelineno-10-127" name="__codelineno-10-127" href="#__codelineno-10-127"></a><span class="w">    </span><span class="n">BENCHMARK</span><span class="p">(</span><span class="n">BM_TimeFormatting</span><span class="p">);</span>
<a id="__codelineno-10-128" name="__codelineno-10-128" href="#__codelineno-10-128"></a><span class="err">```</span><span class="n">text</span>
<a id="__codelineno-10-129" name="__codelineno-10-129" href="#__codelineno-10-129"></a>
<a id="__codelineno-10-130" name="__codelineno-10-130" href="#__codelineno-10-130"></a><span class="cp">### 2. Benchmarking Different Approaches</span>
<a id="__codelineno-10-131" name="__codelineno-10-131" href="#__codelineno-10-131"></a>
<a id="__codelineno-10-132" name="__codelineno-10-132" href="#__codelineno-10-132"></a><span class="cp">####</span>
<a id="__codelineno-10-133" name="__codelineno-10-133" href="#__codelineno-10-133"></a>
<a id="__codelineno-10-134" name="__codelineno-10-134" href="#__codelineno-10-134"></a><span class="err">``</span><span class="n">mermaid</span>
<a id="__codelineno-10-135" name="__codelineno-10-135" href="#__codelineno-10-135"></a><span class="w">    </span><span class="n">gantt</span>
<a id="__codelineno-10-136" name="__codelineno-10-136" href="#__codelineno-10-136"></a><span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="n">Benchmark</span><span class="w"> </span><span class="n">Comparison</span>
<a id="__codelineno-10-137" name="__codelineno-10-137" href="#__codelineno-10-137"></a><span class="w">        </span><span class="n">dateFormat</span><span class="w">  </span><span class="n">HH</span><span class="o">:</span><span class="n">mm</span><span class="o">:</span><span class="n">ss</span><span class="p">.</span><span class="n">SSS</span>
<a id="__codelineno-10-138" name="__codelineno-10-138" href="#__codelineno-10-138"></a><span class="w">        </span><span class="n">axisFormat</span><span class="w"> </span><span class="o">%</span><span class="n">S</span><span class="p">.</span><span class="o">%</span><span class="n">Lms</span>
<a id="__codelineno-10-139" name="__codelineno-10-139" href="#__codelineno-10-139"></a>
<a id="__codelineno-10-140" name="__codelineno-10-140" href="#__codelineno-10-140"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Implementation</span><span class="w"> </span><span class="n">A</span>
<a id="__codelineno-10-141" name="__codelineno-10-141" href="#__codelineno-10-141"></a><span class="w">        </span><span class="n">Run</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">s</span>
<a id="__codelineno-10-142" name="__codelineno-10-142" href="#__codelineno-10-142"></a><span class="w">        </span><span class="n">Run</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="n">a2</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">a1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="n">s</span>
<a id="__codelineno-10-143" name="__codelineno-10-143" href="#__codelineno-10-143"></a>
<a id="__codelineno-10-144" name="__codelineno-10-144" href="#__codelineno-10-144"></a><span class="w">        </span><span class="n">section</span><span class="w"> </span><span class="n">Implementation</span><span class="w"> </span><span class="n">B</span>
<a id="__codelineno-10-145" name="__codelineno-10-145" href="#__codelineno-10-145"></a><span class="w">        </span><span class="n">Run</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
<a id="__codelineno-10-146" name="__codelineno-10-146" href="#__codelineno-10-146"></a><span class="w">        </span><span class="n">Run</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">:</span><span class="n">b2</span><span class="p">,</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">b1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="n">s</span>
</code></pre></div>
```cpp
    // Compare different formatting approaches
    static void BM_Format_vs_Manual(benchmark::State&amp; state) {
        auto now = chronovyan::system_clock::now();
        std::string buffer;
        buffer.reserve(32);</p>
<div class="highlight"><pre><span></span><code>    for (auto _ : state) {
        // Method 1: Using format_to
        buffer.clear();
        chronovyan::format_to(
            std::back_inserter(buffer),
            &quot;%Y-%m-%d %H:%M:%S&quot;,
            now
        );
        benchmark::DoNotOptimize(buffer);
    }
}

static void BM_Format_Manual(benchmark::State&amp; state) {
    auto now = chronovyan::system_clock::now();
    std::string buffer;
    buffer.reserve(32);

    for (auto _ : state) {
        // Method 2: Manual formatting
        buffer.clear();
        auto dp = chronovyan::floor&lt;chronovyan::days&gt;(now);
        chronovyan::year_month_weekday ymd{chronovyan::sys_days{dp}};
        // ... manual formatting ...
        benchmark::DoNotOptimize(buffer);
    }
}

BENCHMARK(BM_Format_vs_Manual);
BENCHMARK(BM_Format_Manual);
</code></pre></div>
<p>```text</p>
<h3 id="3-memory-benchmarking">3. Memory Benchmarking</h3>
<h4 id="_1"></h4>
<p>``mermaid
    classDiagram
        class MemoryTracker {
            +size_t current_usage()
            +size_t peak_usage()
            +void reset_peak()
        }</p>
<div class="highlight"><pre><span></span><code>    class BenchmarkState {
        +size_t bytes_processed()
        +size_t items_processed()
        +void SetBytesProcessed(int64_t)
    }

    MemoryTracker &lt;|-- BenchmarkState
</code></pre></div>
<p>```text</p>
<h4 id="_2"></h4>
<p>``cpp
    #include <benchmark/benchmark.h></p>
<div class="highlight"><pre><span></span><code>static void BM_TimeParsing_Memory(benchmark::State&amp; state) {
    const char*time_str = &quot;2023-01-15 14:30:00&quot;;

    // Track memory allocations
    auto start_mem = GetCurrentRSS();  // Platform-specific memory function

    for (auto _ : state) {
        chronovyan::sys_seconds tp;
        std::istringstream ss(time_str);
        ss &gt;&gt; chronovyan::parse(&quot;%Y-%m-%d %H:%M:%S&quot;, tp);
        benchmark::DoNotOptimize(tp);
    }

    auto end_mem = GetCurrentRSS();
    state.counters[&quot;Memory&quot;] = end_mem - start_mem;
}

BENCHMARK(BM_TimeParsing_Memory);
</code></pre></div>
<p>```text</p>
<h3 id="4-cache-behavior-analysis">4. Cache Behavior Analysis</h3>
<h4 id="_3"></h4>
<p>``mermaid
    gantt
        title Cache Miss Impact
        dateFormat  HH<img alt="🇲🇲" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.1.0/assets/svg/1f1f2-1f1f2.svg" title=":mm:" />ss.SSS
        axisFormat %S.%Lms</p>
<div class="highlight"><pre><span></span><code>    section L1 Cache
    Access :a1, 0s, 1s

    section L2 Cache
    Access :a2, after a1, 2s

    section RAM
    Access :a3, after a2, 10s
</code></pre></div>
<p>```text</p>
<h4 id="_4"></h4>
<p>``cpp
    static void BM_CacheBehavior(benchmark::State&amp; state) {
        // Create a large vector of time points
        std::vector<chronovyan::system_clock::time_point> times(state.range(0));
        auto now = chronovyan::system_clock::now();</p>
<div class="highlight"><pre><span></span><code>    // Initialize with sequential times
    for (size_t i = 0; i &lt; times.size(); ++i) {
        times[i] = now + chronovyan::seconds(i);
    }

    // Shuffle for random access pattern
    std::random_device rd;
    std::mt19937 g(rd());
    std::shuffle(times.begin(), times.end(), g);

    // Benchmark random access
    size_t sum = 0;
    for (auto _ : state) {
        for (const auto&amp; t : times) {
            sum += t.time_since_epoch().count();
        }
    }

    state.counters[&quot;TimePerItem&quot;] =
        benchmark::Counter(
            state.iterations()* times.size(),
            benchmark::Counter::kIsRate
        );
}

// Test with different container sizes
BENCHMARK(BM_CacheBehavior)-&gt;RangeMultiplier(2)-&gt;Range(1&lt;&lt;10, 1&lt;&lt;20);
</code></pre></div>
<p>```text</p>
<h3 id="5-thread-scaling-benchmarks">5. Thread Scaling Benchmarks</h3>
<h4 id="_5"></h4>
<p>``mermaid
    flowchart TD
        A[Single Thread] --&gt;|2x Cores| B[2x Speedup?]
        B --&gt;|No| C[Bottleneck Found]
        B --&gt;|Yes| D[Continue Scaling]
```text</p>
<h4 id="_6"></h4>
<p>``cpp
    static void BM_ThreadScaling(benchmark::State&amp; state) {
        const size_t num_times = 1'000'000;
        std::vector<chronovyan::system_clock::time_point> times(num_times);
        auto now = chronovyan::system_clock::now();</p>
<div class="highlight"><pre><span></span><code>    // Initialize test data
    for (size_t i = 0; i &lt; num_times; ++i) {
        times[i] = now + chronovyan::milliseconds(i % 1000);
    }

    // Process times in parallel
    auto process_times = [&amp;]() {
        for (auto _ : state) {
            for (const auto&amp; t : times) {
                auto value = t.time_since_epoch().count();
                benchmark::DoNotOptimize(value);
            }
        }
    };

    // Execute with different thread counts
    if (state.thread_index() == 0) {
        // Single-threaded baseline
        process_times();
    } else {
        // Multi-threaded
        std::vector&lt;std::thread&gt; threads;
        for (int i = 0; i &lt; state.threads() - 1; ++i) {
            threads.emplace_back(process_times);
        }
        process_times();  // Use main thread too
        for (auto&amp; t : threads) t.join();
    }
}

// Test with 1-8 threads
BENCHMARK(BM_ThreadScaling)-&gt;ThreadRange(1, 8);
</code></pre></div>
<p>```text</p>
<h3 id="6-benchmark-analysis-and-reporting">6. Benchmark Analysis and Reporting</h3>
<h4 id="performance-metrics">Performance Metrics</h4>
<p>| Metric | Description | Importance | --- |-------------| --- | Time/Op | Time per operation | Primary performance indicator | Ops/sec | Operations per second | Throughput measurement | CPU % | CPU utilization | Efficiency indicator | Mem/Op | Memory per operation | Memory efficiency | Cache-misses | Cache miss rate | Memory access pattern |</p>
<h4 id="_7"></h4>
<p>``bash
    #</p>
<p>./benchmark --benchmark_format=console \
                --benchmark_out=results.json \
                --benchmark_out_format=json</p>
<div class="highlight"><pre><span></span><code>#
</code></pre></div>
<p>python3 -m pip install pandas matplotlib
    python3 -c "
    import pandas as pd
    import matplotlib.pyplot as plt</p>
<div class="highlight"><pre><span></span><code>#
</code></pre></div>
<p>df = pd.read_json('results.json', lines=True)
    df = df[df['name'].str.contains('BM_')]</p>
<div class="highlight"><pre><span></span><code>#
</code></pre></div>
<p>plt.figure(figsize=(12, 6))
    for name, group in df.groupby('name'):
        plt.plot(
            group['threads'],
            group['real_time'],
            'o-',
            label=name
        )</p>
<div class="highlight"><pre><span></span><code>plt.xlabel(&#39;Threads&#39;)
plt.ylabel(&#39;Time (ns)&#39;)
plt.title(&#39;Thread Scaling Performance&#39;)
plt.legend()
plt.grid(True)
plt.savefig(&#39;benchmark_results.png&#39;)
&quot;
</code></pre></div>
<p>```text</p>
<h3 id="7-benchmarking-best-practices">7. Benchmarking Best Practices</h3>
<ol>
<li>
<p><strong>Warm-up Runs</strong><code>cpp
    // First few iterations might be slower due to cache warming
    BENCHMARK(BM_Test)-&gt;MinWarmUpTime(1.0);</code>text</p>
<p>2.<strong>Iteration Count</strong><code>cpp
// Run enough iterations for stable measurements
BENCHMARK(BM_Test)-&gt;MinTime(5.0);  // Run for at least 5 seconds</code>text</p>
<p>3.<strong>Parameterized Tests</strong><code>cpp
static void BM_Parameterized(benchmark::State&amp; state) {
    auto size = state.range(0);
    // Test with different container sizes
}
BENCHMARK(BM_Parameterized)-&gt;RangeMultiplier(2)-&gt;Range(8, 8&lt;&lt;10);</code>text</p>
<p>4.<strong>Memory Access Patterns</strong><code>mermaid
flowchart LR
    A[Sequential] --&gt;|Best| B[Cache Friendly]
    C[Random] --&gt;|Worst| D[Cache Thrashing]
    E[Strided] --&gt;|Depends| F[Stride Length]</code>text</p>
<p>5.<strong>Avoiding Optimization</strong>```cpp
// Prevent dead code elimination
benchmark::DoNotOptimize(value);</p>
<p>// Force memory writes
benchmark::ClobberMemory();
```text</p>
<p>6.<strong>Measuring Real-world Scenarios</strong><code>cpp
// Simulate real-world access patterns
std::vector&lt;TimePoint&gt; times = generate_realistic_workload();
BENCHMARK_CAPTURE(BM_RealWorld, workload1, std::move(times));</code>text
}
BENCHMARK(BM_TimeFormatting);</p>
<p>BENCHMARK_MAIN();
```text</p>
</li>
</ol>
<h3 id="_8"></h3>
<p>``cpp
    static void BM_TimeZoneConversion(benchmark::State&amp; state) {
        auto tz = chronovyan::locate_zone("America/New_York");
        auto now = chronovyan::system_clock::now();</p>
<div class="highlight"><pre><span></span><code>    for (auto _ : state) {
        auto zt = chronovyan::zoned_time{tz, now};
        benchmark::DoNotOptimize(zt);
    }

    state.SetItemsProcessed(state.iterations());
}
BENCHMARK(BM_TimeZoneConversion);
</code></pre></div>
<p>```text</p>
<h2 id="real-world-examples">Real-World Examples</h2>
<h3 id="_9"></h3>
<p>``cpp
    class Logger {
        std::ofstream log_file;
        std::string buffer;</p>
<div class="highlight"><pre><span></span><code>public:
    void log(std::string_view message) {
        buffer.clear();
        auto now = system_clock::now();

        // Format timestamp
        format_to(std::back_inserter(buffer),
                 &quot;[%Y-%m-%d %H:%M:%S] &quot;,
                 zoned_time{current_zone(), now});

        // Append message
        buffer.append(message);
        buffer.push_back(&#39;\n&#39;);

        // Write to file
        log_file.write(buffer.data(), buffer.size());
    }
};
</code></pre></div>
<p>```text</p>
<h3 id="_10"></h3>
<p>``cpp
    struct TimeSeries {
        struct Point {
            system_clock::time_point time;
            double value;
        };</p>
<div class="highlight"><pre><span></span><code>    std::vector&lt;Point&gt; points;

    // Find all points in a time range \1CONST\2/core/Core Concepts - The Foundation of Temporal Programming.md#const\3c)o)n)s)t) Point&amp;) p,) system_clock::time_point) t) {
                return p.time &lt; t;
            });
    }

    // Resample to a fixed interval
    TimeSeries resample(seconds interval) const {
        if (points.empty()) return {};

        TimeSeries result;
        auto current = points.front().time;
        const auto end_time = points.back().time;

        while (current &lt;= end_time) {
            auto next = current + interval;
            auto [first, last] = find_in_range(current, next);

            if (first != last) {
                // Simple average of values in the interval
                double sum = 0;
                size_t count = 0;
                for (; first != last; ++first) {
                    sum += first-&gt;value;
                    ++count;
                }
                result.points.push_back({current, sum / count});
            }

            current = next;
        }

        return result;
    }
};
</code></pre></div>
<p>```text</p>
<h2 id="conclusion">Conclusion</h2>
<p>Optimizing time-related code requires careful consideration of both algorithmic efficiency and practical constraints. By following these guidelines and measuring performance in your specific use case, you can achieve optimal performance with Chronovyan.</p>
<p>Remember to always profile your application to identify actual bottlenecks before optimizing. In many cases, the biggest performance gains come from higher-level architectural decisions rather than micro-optimizations of time operations.
    }
}
BENCHMARK(BM_TimeFormatting);</p>
<p>BENCHMARK_MAIN();
```text</p>
<h2 id="memory-usage">Memory Usage</h2>
<p>Be aware of the memory footprint:</p>
<p><code>time_point&lt;system_clock&gt;</code>: Typically 8 bytes (64-bit)
- <code>time_point&lt;system_clock, nanoseconds&gt;</code>: 16 bytes (for higher precision)
- <code>zoned_time</code>: Larger due to time zone data</p>
<h2 id="_11"></h2>
<p><strong>Not thread-safe</strong>: Time zone database operations (use locks if modifying)</p>
<h2 id="profiling-tips">Profiling Tips</h2>
<ol>
<li>Profile your application to identify time-related bottlenecks</li>
<li>Look for:
    Excessive time zone conversions
    String formatting in tight loops
    Unnecessary time point copies
    Suboptimal duration types</li>
</ol>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="June 7, 2025 20:02:02 UTC"><span class="timeago" datetime="2025-06-07T20:02:02+00:00" locale="en"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="June 7, 2025 20:02:02 UTC">2025-06-07</span>
  </span>

    
    
    
    
  </aside>


  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 Chronovyan Team
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "search.highlight", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  </body>
</html>