
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Best practices and techniques for optimizing Chronovyan performance">
      
      
      
        <link rel="canonical" href="https://chronovyan.github.io/guides/performance/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Performance Optimization - Chronovyan</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#performance-optimization-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Chronovyan" class="md-header__button md-logo" aria-label="Chronovyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chronovyan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Performance Optimization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chronovyan/Chronovyan" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Chronovyan/Chronovyan
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting-started/installation/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../api/index.md" class="md-tabs__link">
        
  
    
  
  API Reference

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../CONTRIBUTING.md" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Chronovyan" class="md-nav__button md-logo" aria-label="Chronovyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Chronovyan
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chronovyan/Chronovyan" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Chronovyan/Chronovyan
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-cheat-sheet" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Cheat Sheet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clock-selection" class="md-nav__link">
    <span class="md-ellipsis">
      Clock Selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Clock Selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#when-to-use-each-clock" class="md-nav__link">
    <span class="md-ellipsis">
      When to Use Each Clock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-characteristics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Characteristics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-point-arithmetic" class="md-nav__link">
    <span class="md-ellipsis">
      Time Point Arithmetic
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Time Point Arithmetic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prefer-duration-types" class="md-nav__link">
    <span class="md-ellipsis">
      Prefer Duration Types
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#batch-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Batch Operations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#time-zone-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Time Zone Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Time Zone Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-cache-time-zone-lookups" class="md-nav__link">
    <span class="md-ellipsis">
      1. Cache Time Zone Lookups
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Cache Time Zone Lookups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inefficient-repeated-lookups" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Inefficient - Repeated Lookups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-cached-lookups" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Better - Cached Lookups
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-batch-time-zone-conversions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Batch Time Zone Conversions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Batch Time Zone Conversions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#single-vs-batch-conversion" class="md-nav__link">
    <span class="md-ellipsis">
      Single vs Batch Conversion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-time-zone-conversion-performance-tips" class="md-nav__link">
    <span class="md-ellipsis">
      3. Time Zone Conversion Performance Tips
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-thread-safety" class="md-nav__link">
    <span class="md-ellipsis">
      4. Thread Safety
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#string-operations" class="md-nav__link">
    <span class="md-ellipsis">
      String Operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="String Operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-avoid-formatting-in-tight-loops" class="md-nav__link">
    <span class="md-ellipsis">
      1. Avoid Formatting in Tight Loops
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Avoid Formatting in Tight Loops">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inefficient-multiple-allocations" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Inefficient - Multiple Allocations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-reuse-buffer" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Better - Reuse Buffer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-use-string-views-for-parsing" class="md-nav__link">
    <span class="md-ellipsis">
      2. Use String Views for Parsing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Use String Views for Parsing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-performance-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      3. Performance Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-format-string-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      4. Format String Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-memory-allocation-strategies" class="md-nav__link">
    <span class="md-ellipsis">
      5. Memory Allocation Strategies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#duration-types" class="md-nav__link">
    <span class="md-ellipsis">
      Duration Types
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Duration Types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#duration-type-selection-guide" class="md-nav__link">
    <span class="md-ellipsis">
      Duration Type Selection Guide
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duration-type-comparison" class="md-nav__link">
    <span class="md-ellipsis">
      Duration Type Comparison
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Layout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-usage_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example Usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Considerations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-thread-local-caching" class="md-nav__link">
    <span class="md-ellipsis">
      1. Thread-Local Caching
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Thread-Local Caching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#inefficient-global-cache-with-locks" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Inefficient - Global Cache with Locks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#better-thread-local-storage" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Better - Thread-Local Storage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-immutable-time-objects" class="md-nav__link">
    <span class="md-ellipsis">
      2. Immutable Time Objects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-thread-safety-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      3. Thread Safety Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Thread Safety Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#read-copy-update-rcu" class="md-nav__link">
    <span class="md-ellipsis">
      Read-Copy-Update (RCU)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-with-stdshared_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation with std::shared_ptr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-false-sharing-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      4. False Sharing Prevention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. False Sharing Prevention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache-line-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Line Alignment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-thread-safe-factory-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      5. Thread-Safe Factory Pattern
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Thread-Safe Factory Pattern">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-time-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Compile-Time Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compile-Time Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-compile-time-calculations" class="md-nav__link">
    <span class="md-ellipsis">
      1. Compile-Time Calculations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Compile-Time Calculations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runtime-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      ❌ Runtime Calculation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compile-time-calculation" class="md-nav__link">
    <span class="md-ellipsis">
      ✅ Compile-Time Calculation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-type-aliases-and-constants" class="md-nav__link">
    <span class="md-ellipsis">
      2. Type Aliases and Constants
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Type Aliases and Constants">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-aliases" class="md-nav__link">
    <span class="md-ellipsis">
      Type Aliases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-aliases" class="md-nav__link">
    <span class="md-ellipsis">
      Common Aliases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-compile-time-string-processing" class="md-nav__link">
    <span class="md-ellipsis">
      3. Compile-Time String Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Compile-Time String Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#format-string-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Format String Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-compile-time-date-calculations" class="md-nav__link">
    <span class="md-ellipsis">
      4. Compile-Time Date Calculations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Compile-Time Date Calculations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#date-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Date Algorithms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-compile-time-performance-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      5. Compile-Time Performance Benefits
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-type-safe-units" class="md-nav__link">
    <span class="md-ellipsis">
      6. Type-Safe Units
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-compile-time-formatting" class="md-nav__link">
    <span class="md-ellipsis">
      7. Compile-Time Formatting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#benchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      Benchmarking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benchmarking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-benchmarking-with-google-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      1. Benchmarking with Google Benchmark
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Benchmarking with Google Benchmark">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-benchmark-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Benchmark Structure
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-formatting-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Time Formatting Benchmark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-benchmarking-different-approaches" class="md-nav__link">
    <span class="md-ellipsis">
      2. Benchmarking Different Approaches
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Benchmarking Different Approaches">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#comparing-multiple-implementations" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing Multiple Implementations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-memory-benchmarking" class="md-nav__link">
    <span class="md-ellipsis">
      3. Memory Benchmarking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Memory Benchmarking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-usage-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Usage Analysis
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-benchmark-example" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Benchmark Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-cache-behavior-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      4. Cache Behavior Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Cache Behavior Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-aware-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Cache-Aware Benchmark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-thread-scaling-benchmarks" class="md-nav__link">
    <span class="md-ellipsis">
      5. Thread Scaling Benchmarks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Thread Scaling Benchmarks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-threaded-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-threaded Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-scaling-benchmark" class="md-nav__link">
    <span class="md-ellipsis">
      Thread Scaling Benchmark
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-benchmark-analysis-and-reporting" class="md-nav__link">
    <span class="md-ellipsis">
      6. Benchmark Analysis and Reporting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Benchmark Analysis and Reporting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#performance-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generating-reports" class="md-nav__link">
    <span class="md-ellipsis">
      Generating Reports
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-benchmarking-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      7. Benchmarking Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-examples" class="md-nav__link">
    <span class="md-ellipsis">
      Real-World Examples
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Real-World Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#high-performance-logging" class="md-nav__link">
    <span class="md-ellipsis">
      High-Performance Logging
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#efficient-time-series-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Efficient Time Series Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-usage" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Usage
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#thread-safety" class="md-nav__link">
    <span class="md-ellipsis">
      Thread Safety
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#profiling-tips" class="md-nav__link">
    <span class="md-ellipsis">
      Profiling Tips
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="performance-optimization-guide">Performance Optimization Guide</h1>
<p>This guide provides best practices and techniques for optimizing the performance of applications using Chronovyan. Following these guidelines will help you write efficient and scalable time-handling code.</p>
<pre><code class="language-mermaid">graph TD
    A[Performance Considerations] --&gt; B[Clock Selection]
    A --&gt; C[Time Point Arithmetic]
    A --&gt; D[Time Zone Optimization]
    A --&gt; E[String Operations]
    A --&gt; F[Memory Management]
    B --&gt; G[system_clock, steady_clock, high_resolution_clock]
    C --&gt; H[Duration Types, Batch Operations]
    D --&gt; I[Cache Lookups, Batch Conversions]
    E --&gt; J[Pre-allocation, String Views]
    F --&gt; K[Avoid Copies, Smart Pointers]
</code></pre>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#clock-selection">Clock Selection</a></li>
<li><a href="#time-point-arithmetic">Time Point Arithmetic</a></li>
<li><a href="#time-zone-optimization">Time Zone Optimization</a></li>
<li><a href="#string-operations">String Operations</a></li>
<li><a href="#duration-types">Duration Types</a></li>
<li><a href="#memory-management">Memory Management</a></li>
<li><a href="#thread-safety">Thread Safety</a></li>
<li><a href="#compile-time-optimization">Compile-Time Optimization</a></li>
<li><a href="#benchmarking">Benchmarking</a></li>
<li><a href="#real-world-examples">Real-World Examples</a></li>
</ul>
<h2 id="performance-cheat-sheet">Performance Cheat Sheet</h2>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Fast ✅</th>
<th>Slow ❌</th>
</tr>
</thead>
<tbody>
<tr>
<td>Clock Access</td>
<td><code>steady_clock::now()</code></td>
<td><code>system_clock::now()</code></td>
</tr>
<tr>
<td>Time Zone</td>
<td>Cached lookup</td>
<td>Repeated lookups</td>
</tr>
<tr>
<td>String Ops</td>
<td><code>format_to</code> with buffer</td>
<td>Multiple allocations</td>
</tr>
<tr>
<td>Duration</td>
<td>Fixed-size types</td>
<td>Floating-point</td>
</tr>
<tr>
<td>Memory</td>
<td>Stack allocation</td>
<td>Unnecessary copies</td>
</tr>
</tbody>
</table>
<h2 id="clock-selection">Clock Selection</h2>
<pre><code class="language-mermaid">pie
    title Clock Characteristics
    &quot;Monotonic&quot; : 2
    &quot;Adjustable&quot; : 1
    &quot;High Precision&quot; : 1
</code></pre>
<p>Choose the most appropriate clock for your use case:</p>
<table>
<thead>
<tr>
<th>Clock Type</th>
<th>Characteristics</th>
<th>Best For</th>
<th>Performance</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>system_clock</code></td>
<td>Wall clock time, can be adjusted</td>
<td>Timestamps, logging</td>
<td>⚡ Fast</td>
</tr>
<tr>
<td><code>steady_clock</code></td>
<td>Monotonic, never adjusted</td>
<td>Measuring intervals, timeouts</td>
<td>⚡⚡ Very Fast</td>
</tr>
<tr>
<td><code>high_resolution_clock</code></td>
<td>Shortest tick period available</td>
<td>Precise measurements</td>
<td>⚡⚡⚡ Fastest</td>
</tr>
</tbody>
</table>
<h3 id="when-to-use-each-clock">When to Use Each Clock</h3>
<pre><code class="language-mermaid">flowchart LR
    A[Need Timestamp?] --&gt;|Yes| B[system_clock]
    A --&gt;|No| C[Measuring Time?]
    C --&gt;|Yes| D[steady_clock]
    C --&gt;|No| E[Need Max Precision?]
    E --&gt;|Yes| F[high_resolution_clock]
    E --&gt;|No| G[steady_clock]
</code></pre>
<h3 id="example-usage">Example Usage</h3>
<pre><code class="language-cpp">// For timestamps (can be affected by system time changes)
auto timestamp = chronovyan::system_clock::now();

// For measuring intervals (monotonic)
auto start = chronovyan::steady_clock::now();
// ... operation ...
auto end = chronovyan::steady_clock::now();
auto duration = end - start;

// For high-precision timing
auto precise_start = chronovyan::high_resolution_clock::now();
// ... precision-sensitive operation ...
auto precise_end = chronovyan::high_resolution_clock::now();
</code></pre>
<h3 id="performance-characteristics">Performance Characteristics</h3>
<pre><code class="language-mermaid">bar
    title Clock Access Latency (lower is better)
    system_clock: 15
    steady_clock: 12
    high_resolution_clock: 10
</code></pre>
<h2 id="time-point-arithmetic">Time Point Arithmetic</h2>
<h3 id="prefer-duration-types">Prefer Duration Types</h3>
<pre><code class="language-cpp">// Good: Using duration literals
using namespace std::chrono_literals;
auto timeout = 500ms;

// Better: Compile-time constants when possible
constexpr auto TIMEOUT = 500ms;
constexpr auto CACHE_TTL = 24h;
</code></pre>
<h3 id="batch-operations">Batch Operations</h3>
<p>For operations on multiple time points, process them in batches to improve cache locality:</p>
<pre><code class="language-cpp">struct Event {
    chronovyan::system_clock::time_point when;
    // ... other data ...
};

// Process events in batches
void process_events(const std::vector&lt;Event&gt;&amp; events) {
    constexpr size_t BATCH_SIZE = 64;
    for (size_t i = 0; i &lt; events.size(); i += BATCH_SIZE) {
        auto batch_end = std::min(i + BATCH_SIZE, events.size());
        // Process batch...
    }
}
</code></pre>
<h2 id="time-zone-optimization">Time Zone Optimization</h2>
<pre><code class="language-mermaid">pie
    title Time Zone Operation Costs
    &quot;Lookup&quot; : 40
    &quot;Conversion&quot; : 35
    &quot;Cached Lookup&quot; : 5
    &quot;Cached Conversion&quot; : 20
</code></pre>
<p>Time zone operations can be performance bottlenecks. Here's how to optimize them:</p>
<h3 id="1-cache-time-zone-lookups">1. Cache Time Zone Lookups</h3>
<p>Time zone lookups are expensive operations. Always cache them when possible.</p>
<h4 id="inefficient-repeated-lookups">❌ Inefficient - Repeated Lookups</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Loop Start] --&gt; B[Lookup Time Zone]
    B --&gt; C[Use Time Zone]
    C --&gt; D[Next Iteration]
    D --&gt; B
</code></pre>
<pre><code class="language-cpp">for (const auto&amp; city : cities) {
    auto tz = chronovyan::locate_zone(city.time_zone);  // Expensive!
    // ...
}
</code></pre>
<h4 id="better-cached-lookups">✅ Better - Cached Lookups</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Create Cache] --&gt; B[Loop Start]
    B --&gt; C{In Cache?}
    C --&gt;|No| D[Lookup &amp; Cache]
    C --&gt;|Yes| E[Use Cached]
    D --&gt; E
    E --&gt; F[Next Iteration]
    F --&gt; C
</code></pre>
<pre><code class="language-cpp">std::unordered_map&lt;std::string, const chronovyan::time_zone*&gt; tz_cache;
for (const auto&amp; city : cities) {
    auto it = tz_cache.find(city.time_zone);
    if (it == tz_cache.end()) {
        it = tz_cache.emplace(city.time_zone, 
                             chronovyan::locate_zone(city.time_zone)).first;
    }
    const auto* tz = it-&gt;second;
    // Use tz...
}
</code></pre>
<h3 id="2-batch-time-zone-conversions">2. Batch Time Zone Conversions</h3>
<p>When converting multiple time points, process them in batches to improve cache locality.</p>
<h4 id="single-vs-batch-conversion">Single vs Batch Conversion</h4>
<pre><code class="language-mermaid">gantt
    title Time Zone Conversion Strategies
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Single Conversion
    Lookup TZ       :a1, 0s, 1s
    Convert Time 1  :a2, after a1, 2s
    Convert Time 2  :a3, after a2, 2s

    section Batch Conversion
    Single Lookup   :b1, 0s, 1s
    Convert All     :b2, after b1, 3s
</code></pre>
<h4 id="implementation">Implementation</h4>
<pre><code class="language-cpp">void convert_times(
    const std::vector&lt;system_clock::time_point&gt;&amp; utc_times,
    const time_zone* tz,
    std::vector&lt;zoned_time&lt;system_clock::duration&gt;&gt;&amp; results) {

    results.clear();
    results.reserve(utc_times.size());

    // Single time zone lookup, multiple conversions
    for (const auto&amp; utc : utc_times) {
        results.emplace_back(tz, utc);
    }
}
</code></pre>
<h3 id="3-time-zone-conversion-performance-tips">3. Time Zone Conversion Performance Tips</h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Cost</th>
<th>Optimization</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time Zone Lookup</td>
<td>High</td>
<td>Cache results</td>
</tr>
<tr>
<td>First Conversion</td>
<td>High</td>
<td>Warm up cache early</td>
</tr>
<tr>
<td>Subsequent Conversions</td>
<td>Medium</td>
<td>Batch process</td>
</tr>
<tr>
<td>DST Transitions</td>
<td>Variable</td>
<td>Pre-calculate transitions</td>
</tr>
</tbody>
</table>
<h3 id="4-thread-safety">4. Thread Safety</h3>
<pre><code class="language-mermaid">classDiagram
    class time_zone {
        &lt;&lt;singleton&gt;&gt;
        +static const time_zone* locate_zone(string_view)
        +static const time_zone* current_zone()
    }

    class zoned_time {
        -const time_zone* zone_
        -sys_time time_
        +zoned_time()
        +zoned_time(const time_zone*, const sys_time&amp;)
    }

    time_zone &lt;|-- zoned_time
</code></pre>
<ul>
<li><code>time_zone</code> lookups are thread-safe after program startup</li>
<li><code>zoned_time</code> objects are immutable and thread-safe for concurrent reads</li>
<li>For write operations, use synchronization primitives</li>
</ul>
<h2 id="string-operations">String Operations</h2>
<pre><code class="language-mermaid">pie
    title String Operation Costs
    &quot;Allocation&quot; : 45
    &quot;Formatting&quot; : 35
    &quot;Parsing&quot; : 20
</code></pre>
<p>String operations can be a significant bottleneck in time-related code. Here's how to optimize them:</p>
<h3 id="1-avoid-formatting-in-tight-loops">1. Avoid Formatting in Tight Loops</h3>
<h4 id="inefficient-multiple-allocations">❌ Inefficient - Multiple Allocations</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Loop Start] --&gt; B[Allocate String]
    B --&gt; C[Format to String]
    C --&gt; D[Process String]
    D --&gt; E[Deallocate String]
    E --&gt; F[Next Iteration]
    F --&gt; B
</code></pre>
<pre><code class="language-cpp">for (const auto&amp; tp : time_points) {
    // New allocation on each iteration!
    std::string formatted = chronovyan::format(&quot;%Y-%m-%d %H:%M:%S&quot;, tp);
    process(formatted);
}
</code></pre>
<h4 id="better-reuse-buffer">✅ Better - Reuse Buffer</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Allocate Buffer] --&gt; B[Loop Start]
    B --&gt; C[Clear Buffer]
    C --&gt; D[Format to Buffer]
    D --&gt; E[Process Buffer]
    E --&gt; F[Next Iteration]
    F --&gt; C
</code></pre>
<pre><code class="language-cpp">std::string buffer;
// Pre-allocate to avoid reallocations
buffer.reserve(32);  // Sufficient for most date-time formats

for (const auto&amp; tp : time_points) {
    buffer.clear();
    // Reuse the same buffer
    chronovyan::format_to(std::back_inserter(buffer), &quot;%Y-%m-%d %H:%M:%S&quot;, tp);
    process(buffer);
}
</code></pre>
<h3 id="2-use-string-views-for-parsing">2. Use String Views for Parsing</h3>
<p>Avoid unnecessary string copies by using <code>std::string_view</code>:</p>
<pre><code class="language-mermaid">classDiagram
    class string_view {
        +size_t size()
        +const char* data()
        +string_view substr()
    }

    class string {
        +string(const char*)
        +const char* c_str()
    }

    string_view &lt;|-- string
</code></pre>
<h4 id="implementation_1">Implementation</h4>
<pre><code class="language-cpp">std::optional&lt;system_clock::time_point&gt; parse_timestamp(std::string_view str) {
    system_clock::time_point tp;
    std::istringstream ss{std::string(str)};  // One allocation
    ss &gt;&gt; parse(&quot;%Y-%m-%d %H:%M:%S&quot;, tp);
    if (ss.fail()) return std::nullopt;
    return tp;
}
</code></pre>
<h3 id="3-performance-comparison">3. Performance Comparison</h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Time (ms)</th>
<th>Relative</th>
</tr>
</thead>
<tbody>
<tr>
<td>Naive Formatting</td>
<td>100</td>
<td>1.0x</td>
</tr>
<tr>
<td>Reused Buffer</td>
<td>35</td>
<td>2.9x</td>
</tr>
<tr>
<td>String View Parsing</td>
<td>25</td>
<td>4.0x</td>
</tr>
<tr>
<td>Cached Format String</td>
<td>15</td>
<td>6.7x</td>
</tr>
</tbody>
</table>
<h3 id="4-format-string-optimization">4. Format String Optimization</h3>
<p>Pre-compile format strings when possible:</p>
<pre><code class="language-cpp">// Compile-time format string
constexpr auto fmt_string = &quot;%Y-%m-%d %H:%M:%S&quot;;

// At usage:
chronovyan::format_to(back_inserter(buffer), 
                     fmt_string, 
                     time_point);
</code></pre>
<h3 id="5-memory-allocation-strategies">5. Memory Allocation Strategies</h3>
<pre><code class="language-mermaid">gantt
    title Memory Allocation Strategies
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Multiple Allocations
    Alloc 1 :a1, 0s, 1s
    Alloc 2 :a2, after a1, 1s
    Alloc 3 :a3, after a2, 1s

    section Single Allocation
    Large Alloc :b1, 0s, 1s
    Reuse       :b2, after b1, 2s
</code></pre>
<ul>
<li><strong>Avoid</strong> multiple small allocations in performance-critical code</li>
<li><strong>Pre-allocate</strong> buffers when the maximum size is known</li>
<li><strong>Reserve</strong> capacity for containers when the size is predictable</li>
</ul>
<h2 id="duration-types">Duration Types</h2>
<pre><code class="language-mermaid">pie
    title Duration Type Usage
    &quot;seconds&quot; : 40
    &quot;milliseconds&quot; : 30
    &quot;microseconds&quot; : 15
    &quot;nanoseconds&quot; : 10
    &quot;minutes&quot; : 3
    &quot;hours&quot; : 2
</code></pre>
<h3 id="duration-type-selection-guide">Duration Type Selection Guide</h3>
<pre><code class="language-mermaid">flowchart TD
    A[Need Sub-millisecond?] --&gt;|Yes| B[Use nanoseconds/microseconds]
    A --&gt;|No| C[Human-readable?]
    C --&gt;|Yes| D[Use seconds/minutes/hours]
    C --&gt;|No| E[Need exact ms?]
    E --&gt;|Yes| F[Use milliseconds]
    E --&gt;|No| G[Use seconds]
</code></pre>
<h3 id="duration-type-comparison">Duration Type Comparison</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Precision</th>
<th>Range</th>
<th>Memory</th>
<th>Performance</th>
<th>Best For</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>nanoseconds</code></td>
<td>1ns</td>
<td>±292 years</td>
<td>8 bytes</td>
<td>⚡⚡⚡</td>
<td>High-precision timing, benchmarks</td>
</tr>
<tr>
<td><code>microseconds</code></td>
<td>1µs</td>
<td>±292,000 years</td>
<td>8 bytes</td>
<td>⚡⚡⚡</td>
<td>General timing, I/O operations</td>
</tr>
<tr>
<td><code>milliseconds</code></td>
<td>1ms</td>
<td>±292M years</td>
<td>8 bytes</td>
<td>⚡⚡</td>
<td>UI updates, networking timeouts</td>
</tr>
<tr>
<td><code>seconds</code></td>
<td>1s</td>
<td>±292B years</td>
<td>8 bytes</td>
<td>⚡</td>
<td>General purpose, timestamps</td>
</tr>
<tr>
<td><code>minutes</code></td>
<td>1min</td>
<td>±5.5e18 years</td>
<td>8 bytes</td>
<td>⚡</td>
<td>Human intervals, scheduling</td>
</tr>
<tr>
<td><code>hours</code></td>
<td>1h</td>
<td>±3.3e17 years</td>
<td>8 bytes</td>
<td>⚡</td>
<td>Long durations, calendar events</td>
</tr>
</tbody>
</table>
<h3 id="memory-layout">Memory Layout</h3>
<pre><code class="language-mermaid">classDiagram
    class duration {
        +rep_ count_
        +period period_
        +rep count()
        +static duration zero()
        +duration operator+()
        +duration operator-()
    }

    duration &lt;|-- seconds
    duration &lt;|-- milliseconds
    duration &lt;|-- microseconds
    duration &lt;|-- nanoseconds
    duration &lt;|-- minutes
    duration &lt;|-- hours
</code></pre>
<h3 id="example-usage_1">Example Usage</h3>
<pre><code class="language-cpp">// High-precision timing
auto start = chronovyan::high_resolution_clock::now();
// ... operation ...
auto end = chronovyan::high_resolution_clock::now();
auto ns = chronovyan::duration_cast&lt;chronovyan::nanoseconds&gt;(end - start);

// Network timeout (human-readable)
constexpr auto timeout = 500ms;  // More readable than 0.5s or 500'000µs

// Calendar event
auto meeting_duration = 1h + 30min;  // Self-documenting

// Frame timing (60 FPS)
constexpr auto frame_time = 16.666ms;  // 1/60 second
</code></pre>
<h3 id="performance-considerations">Performance Considerations</h3>
<pre><code class="language-mermaid">gantt
    title Duration Conversion Overhead
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section No Conversion
    Operation :a1, 0s, 1s

    section With Conversion
    Convert :b1, 0s, 1s
    Operation :b2, after b1, 1s
</code></pre>
<ul>
<li><strong>Prefer</strong> using the natural duration type for your operations</li>
<li><strong>Avoid</strong> unnecessary <code>duration_cast</code> operations</li>
<li><strong>Use</strong> floating-point durations for division/multiplication when exact precision isn't critical</li>
<li><strong>Consider</strong> integer durations for exact arithmetic and comparisons</li>
</ul>
<h3 id="common-pitfalls">Common Pitfalls</h3>
<ol>
<li><strong>Mixing Duration Types</strong>
   ```cpp
   // ❌ Error: Can't add different duration types
   auto total = 1s + 500ms;  // Error</li>
</ol>
<p>// ✅ Correct: Explicit conversion
   auto total = 1s + chrono::duration_cast<seconds>(500ms);
   ```</p>
<ol>
<li><strong>Loss of Precision</strong>
   ```cpp
   // ❌ Loses sub-second precision
   seconds s = 1500ms;  // s.count() == 1</li>
</ol>
<p>// ✅ Preserves precision
   auto ms = 1500ms;    // 1.5 seconds exactly
   ```</p>
<ol>
<li><strong>Floating-point Durations</strong>
   ```cpp
   // Good for calculations requiring division
   using fsec = duration<double>;</li>
</ol>
<p>std::sort(time_series.begin(), time_series.end());</p>
<p>// For lookups by time
std::map<time_point\<system_clock>, Event> events;
auto it = events.lower_bound(some_time);</p>
<pre><code>
### 6. Memory Pooling

For high-frequency time point allocations:

```cpp
class TimePointPool {
    std::vector&lt;std::unique_ptr&lt;time_point&lt;system_clock&gt;&gt;&gt; pool_;

public:
    time_point&lt;system_clock&gt;* acquire() {
        if (pool_.empty()) {
            return new time_point&lt;system_clock&gt;();
        }
        auto ptr = std::move(pool_.back());
        pool_.pop_back();
        return ptr.release();
    }

    void release(time_point&lt;system_clock&gt;* tp) {
        pool_.push_back(std::unique_ptr&lt;time_point&lt;system_clock&gt;&gt;(tp));
    }
};

## Thread Safety

```mermaid
pie
    title Thread Safety Concerns
    &quot;Race Conditions&quot; : 45
    &quot;Deadlocks&quot; : 25
    &quot;False Sharing&quot; : 20
    &quot;Cache Invalidation&quot; : 10
</code></pre>
<h3 id="1-thread-local-caching">1. Thread-Local Caching</h3>
<h4 id="inefficient-global-cache-with-locks">❌ Inefficient - Global Cache with Locks</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Thread 1] --&gt;|Lock| B[Global Cache]
    C[Thread 2] --&gt;|Wait| B
    D[Thread 3] --&gt;|Wait| B
</code></pre>
<pre><code class="language-cpp">// Global cache with mutex protection
std::mutex cache_mutex;
std::unordered_map&lt;std::string, const time_zone*&gt; global_cache;

const time_zone* get_time_zone_slow(const std::string&amp; name) {
    std::lock_guard&lt;std::mutex&gt; lock(cache_mutex);
    auto it = global_cache.find(name);
    if (it == global_cache.end()) {
        it = global_cache.emplace(name, locate_zone(name)).first;
    }
    return it-&gt;second;
}
</code></pre>
<h4 id="better-thread-local-storage">✅ Better - Thread-Local Storage</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Thread 1] --&gt; B[Thread 1 Cache]
    C[Thread 2] --&gt; D[Thread 2 Cache]
    E[Thread 3] --&gt; F[Thread 3 Cache]
</code></pre>
<pre><code class="language-cpp">// Each thread gets its own cache
const time_zone* get_cached_time_zone(const std::string&amp; name) {
    thread_local std::unordered_map&lt;std::string, const time_zone*&gt; cache;

    auto it = cache.find(name);
    if (it == cache.end()) {
        it = cache.emplace(name, locate_zone(name)).first;
    }
    return it-&gt;second;
}
</code></pre>
<h3 id="2-immutable-time-objects">2. Immutable Time Objects</h3>
<pre><code class="language-mermaid">classDiagram
    class time_point {
        +duration time_since_epoch()
        +time_point&amp; operator+=(const duration&amp;)
        +static time_point min()
        +static time_point max()
    }

    class zoned_time {
        -const time_zone* zone_
        -sys_time time_
        +zoned_time()
        +zoned_time(const time_zone*, const sys_time&amp;)
        +sys_time get_sys_time()
        +local_time get_local_time()
    }

    time_point &lt;|-- zoned_time
</code></pre>
<ul>
<li><code>time_point</code> and <code>zoned_time</code> are thread-safe for concurrent reads</li>
<li>No synchronization needed for const operations</li>
<li>For modifications, external synchronization is required</li>
</ul>
<h3 id="3-thread-safety-patterns">3. Thread Safety Patterns</h3>
<h4 id="read-copy-update-rcu">Read-Copy-Update (RCU)</h4>
<pre><code class="language-mermaid">sequenceDiagram
    participant Reader1
    participant Reader2
    participant Writer
    participant Data

    Reader1-&gt;&gt;Data: Read (no lock)
    Reader2-&gt;&gt;Data: Read (no lock)
    Writer-&gt;&gt;Data: Create new copy
    Writer-&gt;&gt;Data: Atomic swap
    Reader1-&gt;&gt;Data: Read new version
</code></pre>
<h4 id="implementation-with-stdshared_ptr">Implementation with <code>std::shared_ptr</code></h4>
<pre><code class="language-cpp">class TimeZoneCache {
    std::shared_ptr&lt;const std::unordered_map&lt;std::string, const time_zone*&gt;&gt; cache_;

public:
    TimeZoneCache() : cache_(std::make_shared&lt;std::unordered_map&lt;std::string, const time_zone*&gt;&gt;()) {}

    void update() {
        auto new_cache = std::make_shared&lt;std::unordered_map&lt;std::string, const time_zone*&gt;&gt;(*cache_);
        // Update new_cache...
        std::atomic_store(&amp;cache_, new_cache);
    }

    const time_zone* get(const std::string&amp; name) const {
        auto cache = std::atomic_load(&amp;cache_);
        auto it = cache-&gt;find(name);
        return it != cache-&gt;end() ? it-&gt;second : nullptr;
    }
};
</code></pre>
<h3 id="4-false-sharing-prevention">4. False Sharing Prevention</h3>
<pre><code class="language-mermaid">gantt
    title False Sharing Impact
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section With False Sharing
    Thread 1 :a1, 0s, 2s
    Thread 2 :a2, 0s, 2s

    section Without False Sharing
    Thread 1 :b1, 3s, 1s
    Thread 2 :b2, 3s, 1s
</code></pre>
<h4 id="cache-line-alignment">Cache Line Alignment</h4>
<pre><code class="language-cpp">struct alignas(64) PaddedCounter {
    std::atomic&lt;int&gt; counter;
    char padding[64 - sizeof(std::atomic&lt;int&gt;)];  // Pad to cache line size
};

// Array of counters, each on its own cache line
PaddedCounter counters[std::thread::hardware_concurrency()];
</code></pre>
<h3 id="5-thread-safe-factory-pattern">5. Thread-Safe Factory Pattern</h3>
<pre><code class="language-mermaid">flowchart TD
    A[Get Time Zone] --&gt; B{In Cache?}
    B --&gt;|Yes| C[Return Cached]
    B --&gt;|No| D[Create New]
    D --&gt; E[Add to Cache]
    E --&gt; C
</code></pre>
<h4 id="implementation_2">Implementation</h4>
<pre><code class="language-cpp">class TimeZoneFactory {
    mutable std::mutex mutex_;
    std::unordered_map&lt;std::string, std::weak_ptr&lt;const time_zone&gt;&gt; cache_;

public:
    std::shared_ptr&lt;const time_zone&gt; get_time_zone(const std::string&amp; name) {
        std::lock_guard&lt;std::mutex&gt; lock(mutex_);

        // Check if we have a valid entry in cache
        if (auto it = cache_.find(name); it != cache_.end()) {
            if (auto sp = it-&gt;second.lock()) {
                return sp;  // Return existing shared_ptr
            }
            // Entry exists but expired, remove it
            cache_.erase(it);
        }

        // Create new entry
        auto tz = std::shared_ptr&lt;const time_zone&gt;(
            locate_zone(name),
            [this, name](const time_zone* tz) {
                std::lock_guard&lt;std::mutex&gt; lock(mutex_);
                cache_.erase(name);
                delete tz;
            }
        );

        cache_[name] = tz;
        return tz;
    }
};
</code></pre>
<h2 id="compile-time-optimization">Compile-Time Optimization</h2>
<pre><code class="language-mermaid">pie
    title Compile-Time Benefits
    &quot;Faster Runtime&quot; : 40
    &quot;Smaller Binary&quot; : 30
    &quot;Better Optimizations&quot; : 30
</code></pre>
<h3 id="1-compile-time-calculations">1. Compile-Time Calculations</h3>
<h4 id="runtime-calculation">❌ Runtime Calculation</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Program Start] --&gt; B[Calculate at Runtime]
    B --&gt; C[Use Result]
    C --&gt; D[Program End]
</code></pre>
<pre><code class="language-cpp">// Calculated every time the function is called
auto get_week_later() {
    return system_clock::now() + 7 * 24h;
}
</code></pre>
<h4 id="compile-time-calculation">✅ Compile-Time Calculation</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Compile Time] --&gt; B[Calculate Value]
    C[Runtime] --&gt; D[Use Precomputed Value]
</code></pre>
<pre><code class="language-cpp">// Compile-time duration calculations
constexpr auto one_day = 24h;
constexpr auto one_week = 7 * one_day;
constexpr auto one_year = 365 * one_day;

// Compile-time time point calculations
constexpr auto epoch = system_clock::time_point{};
constexpr auto year_2000 = epoch + 946'684'800s;  // 2000-01-01 00:00:00 UTC

// Known at compile time
template&lt;typename Clock&gt;
constexpr auto get_week_later() {
    return Clock::now() + one_week;
}
</code></pre>
<h3 id="2-type-aliases-and-constants">2. Type Aliases and Constants</h3>
<h4 id="type-aliases">Type Aliases</h4>
<pre><code class="language-mermaid">classDiagram
    class duration {
        &lt;&lt;templated&gt;&gt;
        +rep count()
        +static duration zero()
    }

    class time_point {
        &lt;&lt;templated&gt;&gt;
        +duration time_since_epoch()
    }

    duration &lt;|-- seconds
    duration &lt;|-- milliseconds
    time_point &lt;|-- sys_time
    time_point &lt;|-- local_time

    note for time_point &quot;Commonly used aliases:\n- sys_time: System clock time\n- local_time: Local time&quot;
</code></pre>
<h4 id="common-aliases">Common Aliases</h4>
<pre><code class="language-cpp">// Duration types
using days = duration&lt;int, std::ratio&lt;86400&gt;&gt;;
using weeks = duration&lt;int, std::ratio&lt;604800&gt;&gt;;
using months = duration&lt;int, std::ratio&lt;2629746&gt;&gt;;  // 30.44 days
using years = duration&lt;int, std::ratio&lt;31556952&gt;&gt;;  // 365.24 days

// Time point types
using sys_time = time_point&lt;system_clock&gt;;
using steady_time = time_point&lt;steady_clock&gt;;
using highres_time = time_point&lt;high_resolution_clock&gt;;
</code></pre>
<h3 id="3-compile-time-string-processing">3. Compile-Time String Processing</h3>
<h4 id="format-string-validation">Format String Validation</h4>
<pre><code class="language-mermaid">flowchart TD
    A[Compile Time] --&gt; B[Validate Format String]
    B --&gt;|Valid| C[Compile Success]
    B --&gt;|Invalid| D[Compile Error]
</code></pre>
<pre><code class="language-cpp">template&lt;typename... Args&gt;
constexpr void validate_format_string(const char* fmt) {
    // Compile-time format string validation
    // Will fail to compile if format string is invalid
    chronovyan::parse(fmt, Args{}...);
}

// Usage:
// validate_format_string&lt;year, month, day&gt;(&quot;%Y-%m-%d&quot;);  // OK
// validate_format_string&lt;year, month, day&gt;(&quot;%Y-%m&quot;);    // Compile error
</code></pre>
<h3 id="4-compile-time-date-calculations">4. Compile-Time Date Calculations</h3>
<h4 id="date-algorithms">Date Algorithms</h4>
<pre><code class="language-mermaid">flowchart LR
    A[Year] --&gt; B{Is Leap Year?}
    B --&gt;|Yes| C[366 Days]
    B --&gt;|No| D[365 Days]
</code></pre>
<pre><code class="language-cpp">constexpr bool is_leap_year(int y) {
    return (y % 4 == 0 &amp;&amp; y % 100 != 0) || (y % 400 == 0);
}

constexpr int days_in_month(int y, unsigned m) {
    if (m == 2) return is_leap_year(y) ? 29 : 28;
    constexpr int days[] = {31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
    return days[m - 1];
}

// Compile-time validation
static_assert(days_in_month(2020, 2) == 29, &quot;2020 was a leap year&quot;);
static_assert(days_in_month(2021, 2) == 28, &quot;2021 is not a leap year&quot;);
</code></pre>
<h3 id="5-compile-time-performance-benefits">5. Compile-Time Performance Benefits</h3>
<pre><code class="language-mermaid">gantt
    title Runtime vs Compile-Time Calculation
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Runtime
    Calculate :a1, 0s, 5s

    section Compile-Time
    Use Value :b1, 0s, 1s
</code></pre>
<ul>
<li><strong>Zero runtime overhead</strong> for compile-time calculations</li>
<li><strong>Better optimization</strong> opportunities for the compiler</li>
<li><strong>Smaller binary size</strong> due to constant folding</li>
<li><strong>Early error detection</strong> at compile time</li>
</ul>
<h3 id="6-type-safe-units">6. Type-Safe Units</h3>
<pre><code class="language-cpp">// Type-safe duration units
template&lt;typename Rep, typename Period&gt;
class duration {
    Rep rep_;
public:
    constexpr explicit duration(const Rep&amp; r) : rep_(r) {}
    constexpr Rep count() const { return rep_; }
    // ...
};

// User-defined literals
constexpr auto operator&quot;&quot;_days(unsigned long long d) {
    return duration&lt;int, std::ratio&lt;86400&gt;&gt;(d);
}

// Usage:
constexpr auto two_weeks = 14_days;  // Type-safe, checked at compile time
</code></pre>
<h3 id="7-compile-time-formatting">7. Compile-Time Formatting</h3>
<pre><code class="language-cpp">// Compile-time format string processing
template&lt;typename... Args&gt;
constexpr auto make_format_string() {
    constexpr const char* fmt = &quot;%Y-%m-%d %H:%M:%S&quot;;
    // Validate format string at compile time
    static_assert(validate_format_string&lt;Args...&gt;(fmt), &quot;Invalid format string&quot;);
    return fmt;
}

// Usage:
auto fmt = make_format_string&lt;year, month, day, hours, minutes, seconds&gt;();
</code></pre>
<h2 id="benchmarking">Benchmarking</h2>
<pre><code class="language-mermaid">pie
    title Benchmarking Focus Areas
    &quot;CPU Time&quot; : 40
    &quot;Memory Usage&quot; : 30
    &quot;Cache Behavior&quot; : 20
    &quot;Thread Contention&quot; : 10
</code></pre>
<h3 id="1-benchmarking-with-google-benchmark">1. Benchmarking with Google Benchmark</h3>
<h4 id="basic-benchmark-structure">Basic Benchmark Structure</h4>
<pre><code class="language-mermaid">flowchart TD
    A[Setup] --&gt; B[Start Timer]
    B --&gt; C[Run Test Code]
    C --&gt; D[Stop Timer]
    D --&gt; E[Report Results]
</code></pre>
<h4 id="time-formatting-benchmark">Time Formatting Benchmark</h4>
<pre><code class="language-cpp">#include &lt;benchmark/benchmark.h&gt;

// Benchmark time formatting
static void BM_TimeFormatting(benchmark::State&amp; state) {
    // Setup (not measured)
    auto now = chronovyan::system_clock::now();
    std::string buffer;
    buffer.reserve(32);

    // Benchmark loop
    for (auto _ : state) {
        buffer.clear();
        // Format time to string
        chronovyan::format_to(
            std::back_inserter(buffer), 
            &quot;%Y-%m-%d %H:%M:%S&quot;, 
            now
        );
        // Prevent compiler optimizations
        benchmark::DoNotOptimize(buffer);
    }

    // Optional: Set custom metrics
    state.SetBytesProcessed(
        int64_t(state.iterations()) * buffer.size()
    );
}

// Register benchmark
BENCHMARK(BM_TimeFormatting);
</code></pre>
<h3 id="2-benchmarking-different-approaches">2. Benchmarking Different Approaches</h3>
<h4 id="comparing-multiple-implementations">Comparing Multiple Implementations</h4>
<pre><code class="language-mermaid">gantt
    title Benchmark Comparison
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Implementation A
    Run 1 :a1, 0s, 2s
    Run 2 :a2, after a1, 2s

    section Implementation B
    Run 1 :b1, 0s, 1s
    Run 2 :b2, after b1, 1s
</code></pre>
<pre><code class="language-cpp">// Compare different formatting approaches
static void BM_Format_vs_Manual(benchmark::State&amp; state) {
    auto now = chronovyan::system_clock::now();
    std::string buffer;
    buffer.reserve(32);

    for (auto _ : state) {
        // Method 1: Using format_to
        buffer.clear();
        chronovyan::format_to(
            std::back_inserter(buffer), 
            &quot;%Y-%m-%d %H:%M:%S&quot;, 
            now
        );
        benchmark::DoNotOptimize(buffer);
    }
}

static void BM_Format_Manual(benchmark::State&amp; state) {
    auto now = chronovyan::system_clock::now();
    std::string buffer;
    buffer.reserve(32);

    for (auto _ : state) {
        // Method 2: Manual formatting
        buffer.clear();
        auto dp = chronovyan::floor&lt;chronovyan::days&gt;(now);
        chronovyan::year_month_weekday ymd{chronovyan::sys_days{dp}};
        // ... manual formatting ...
        benchmark::DoNotOptimize(buffer);
    }
}

BENCHMARK(BM_Format_vs_Manual);
BENCHMARK(BM_Format_Manual);
</code></pre>
<h3 id="3-memory-benchmarking">3. Memory Benchmarking</h3>
<h4 id="memory-usage-analysis">Memory Usage Analysis</h4>
<pre><code class="language-mermaid">classDiagram
    class MemoryTracker {
        +size_t current_usage()
        +size_t peak_usage()
        +void reset_peak()
    }

    class BenchmarkState {
        +size_t bytes_processed()
        +size_t items_processed()
        +void SetBytesProcessed(int64_t)
    }

    MemoryTracker &lt;|-- BenchmarkState
</code></pre>
<h4 id="memory-benchmark-example">Memory Benchmark Example</h4>
<pre><code class="language-cpp">#include &lt;benchmark/benchmark.h&gt;

static void BM_TimeParsing_Memory(benchmark::State&amp; state) {
    const char* time_str = &quot;2023-01-15 14:30:00&quot;;

    // Track memory allocations
    auto start_mem = GetCurrentRSS();  // Platform-specific memory function

    for (auto _ : state) {
        chronovyan::sys_seconds tp;
        std::istringstream ss(time_str);
        ss &gt;&gt; chronovyan::parse(&quot;%Y-%m-%d %H:%M:%S&quot;, tp);
        benchmark::DoNotOptimize(tp);
    }

    auto end_mem = GetCurrentRSS();
    state.counters[&quot;Memory&quot;] = end_mem - start_mem;
}

BENCHMARK(BM_TimeParsing_Memory);
</code></pre>
<h3 id="4-cache-behavior-analysis">4. Cache Behavior Analysis</h3>
<h4 id="cache-performance">Cache Performance</h4>
<pre><code class="language-mermaid">gantt
    title Cache Miss Impact
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section L1 Cache
    Access :a1, 0s, 1s

    section L2 Cache
    Access :a2, after a1, 2s

    section RAM
    Access :a3, after a2, 10s
</code></pre>
<h4 id="cache-aware-benchmark">Cache-Aware Benchmark</h4>
<pre><code class="language-cpp">static void BM_CacheBehavior(benchmark::State&amp; state) {
    // Create a large vector of time points
    std::vector&lt;chronovyan::system_clock::time_point&gt; times(state.range(0));
    auto now = chronovyan::system_clock::now();

    // Initialize with sequential times
    for (size_t i = 0; i &lt; times.size(); ++i) {
        times[i] = now + chronovyan::seconds(i);
    }

    // Shuffle for random access pattern
    std::random_device rd;
    std::mt19937 g(rd());
    std::shuffle(times.begin(), times.end(), g);

    // Benchmark random access
    size_t sum = 0;
    for (auto _ : state) {
        for (const auto&amp; t : times) {
            sum += t.time_since_epoch().count();
        }
    }

    state.counters[&quot;TimePerItem&quot;] = 
        benchmark::Counter(
            state.iterations() * times.size(),
            benchmark::Counter::kIsRate
        );
}

// Test with different container sizes
BENCHMARK(BM_CacheBehavior)-&gt;RangeMultiplier(2)-&gt;Range(1&lt;&lt;10, 1&lt;&lt;20);
</code></pre>
<h3 id="5-thread-scaling-benchmarks">5. Thread Scaling Benchmarks</h3>
<h4 id="multi-threaded-performance">Multi-threaded Performance</h4>
<pre><code class="language-mermaid">flowchart TD
    A[Single Thread] --&gt;|2x Cores| B[2x Speedup?]
    B --&gt;|No| C[Bottleneck Found]
    B --&gt;|Yes| D[Continue Scaling]
</code></pre>
<h4 id="thread-scaling-benchmark">Thread Scaling Benchmark</h4>
<pre><code class="language-cpp">static void BM_ThreadScaling(benchmark::State&amp; state) {
    const size_t num_times = 1'000'000;
    std::vector&lt;chronovyan::system_clock::time_point&gt; times(num_times);
    auto now = chronovyan::system_clock::now();

    // Initialize test data
    for (size_t i = 0; i &lt; num_times; ++i) {
        times[i] = now + chronovyan::milliseconds(i % 1000);
    }

    // Process times in parallel
    auto process_times = [&amp;]() {
        for (auto _ : state) {
            for (const auto&amp; t : times) {
                auto value = t.time_since_epoch().count();
                benchmark::DoNotOptimize(value);
            }
        }
    };

    // Execute with different thread counts
    if (state.thread_index() == 0) {
        // Single-threaded baseline
        process_times();
    } else {
        // Multi-threaded
        std::vector&lt;std::thread&gt; threads;
        for (int i = 0; i &lt; state.threads() - 1; ++i) {
            threads.emplace_back(process_times);
        }
        process_times();  // Use main thread too
        for (auto&amp; t : threads) t.join();
    }
}

// Test with 1-8 threads
BENCHMARK(BM_ThreadScaling)-&gt;ThreadRange(1, 8);
</code></pre>
<h3 id="6-benchmark-analysis-and-reporting">6. Benchmark Analysis and Reporting</h3>
<h4 id="performance-metrics">Performance Metrics</h4>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Description</th>
<th>Importance</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time/Op</td>
<td>Time per operation</td>
<td>Primary performance indicator</td>
</tr>
<tr>
<td>Ops/sec</td>
<td>Operations per second</td>
<td>Throughput measurement</td>
</tr>
<tr>
<td>CPU %</td>
<td>CPU utilization</td>
<td>Efficiency indicator</td>
</tr>
<tr>
<td>Mem/Op</td>
<td>Memory per operation</td>
<td>Memory efficiency</td>
</tr>
<tr>
<td>Cache-misses</td>
<td>Cache miss rate</td>
<td>Memory access pattern</td>
</tr>
</tbody>
</table>
<h4 id="generating-reports">Generating Reports</h4>
<pre><code class="language-bash"># Run all benchmarks with statistics
./benchmark --benchmark_format=console \
            --benchmark_out=results.json \
            --benchmark_out_format=json

# Generate report
python3 -m pip install pandas matplotlib
python3 -c &quot;
import pandas as pd
import matplotlib.pyplot as plt

# Load benchmark results
df = pd.read_json('results.json', lines=True)
df = df[df['name'].str.contains('BM_')]

# Plot results
plt.figure(figsize=(12, 6))
for name, group in df.groupby('name'):
    plt.plot(
        group['threads'], 
        group['real_time'], 
        'o-', 
        label=name
    )

plt.xlabel('Threads')
plt.ylabel('Time (ns)')
plt.title('Thread Scaling Performance')
plt.legend()
plt.grid(True)
plt.savefig('benchmark_results.png')
&quot;
</code></pre>
<h3 id="7-benchmarking-best-practices">7. Benchmarking Best Practices</h3>
<ol>
<li>
<p><strong>Warm-up Runs</strong>
   <code>cpp
   // First few iterations might be slower due to cache warming
   BENCHMARK(BM_Test)-&gt;MinWarmUpTime(1.0);</code></p>
</li>
<li>
<p><strong>Iteration Count</strong>
   <code>cpp
   // Run enough iterations for stable measurements
   BENCHMARK(BM_Test)-&gt;MinTime(5.0);  // Run for at least 5 seconds</code></p>
</li>
<li>
<p><strong>Parameterized Tests</strong>
   <code>cpp
   static void BM_Parameterized(benchmark::State&amp; state) {
       auto size = state.range(0);
       // Test with different container sizes
   }
   BENCHMARK(BM_Parameterized)-&gt;RangeMultiplier(2)-&gt;Range(8, 8&lt;&lt;10);</code></p>
</li>
<li>
<p><strong>Memory Access Patterns</strong>
   <code>mermaid
   flowchart LR
       A[Sequential] --&gt;|Best| B[Cache Friendly]
       C[Random] --&gt;|Worst| D[Cache Thrashing]
       E[Strided] --&gt;|Depends| F[Stride Length]</code></p>
</li>
<li>
<p><strong>Avoiding Optimization</strong>
   ```cpp
   // Prevent dead code elimination
   benchmark::DoNotOptimize(value);</p>
</li>
</ol>
<p>// Force memory writes
   benchmark::ClobberMemory();
   ```</p>
<ol>
<li><strong>Measuring Real-world Scenarios</strong>
   <code>cpp
   // Simulate real-world access patterns
   std::vector&lt;TimePoint&gt; times = generate_realistic_workload();
   BENCHMARK_CAPTURE(BM_RealWorld, workload1, std::move(times));</code>
}
BENCHMARK(BM_TimeFormatting);</li>
</ol>
<p>BENCHMARK_MAIN();</p>
<pre><code>
### Measuring Time Zone Conversion Performance

```cpp
static void BM_TimeZoneConversion(benchmark::State&amp; state) {
    auto tz = chronovyan::locate_zone(&quot;America/New_York&quot;);
    auto now = chronovyan::system_clock::now();

    for (auto _ : state) {
        auto zt = chronovyan::zoned_time{tz, now};
        benchmark::DoNotOptimize(zt);
    }

    state.SetItemsProcessed(state.iterations());
}
BENCHMARK(BM_TimeZoneConversion);
</code></pre>
<h2 id="real-world-examples">Real-World Examples</h2>
<h3 id="high-performance-logging">High-Performance Logging</h3>
<pre><code class="language-cpp">class Logger {
    std::ofstream log_file;
    std::string buffer;

public:
    void log(std::string_view message) {
        buffer.clear();
        auto now = system_clock::now();

        // Format timestamp
        format_to(std::back_inserter(buffer), 
                 &quot;[%Y-%m-%d %H:%M:%S] &quot;, 
                 zoned_time{current_zone(), now});

        // Append message
        buffer.append(message);
        buffer.push_back('\n');

        // Write to file
        log_file.write(buffer.data(), buffer.size());
    }
};
</code></pre>
<h3 id="efficient-time-series-processing">Efficient Time Series Processing</h3>
<pre><code class="language-cpp">struct TimeSeries {
    struct Point {
        system_clock::time_point time;
        double value;
    };

    std::vector&lt;Point&gt; points;

    // Find all points in a time range [start, end)
    auto find_in_range(system_clock::time_point start,
                      system_clock::time_point end) const {
        return std::equal_range(
            points.begin(), points.end(),
            start,
            [](const Point&amp; p, system_clock::time_point t) {
                return p.time &lt; t;
            });
    }

    // Resample to a fixed interval
    TimeSeries resample(seconds interval) const {
        if (points.empty()) return {};

        TimeSeries result;
        auto current = points.front().time;
        const auto end_time = points.back().time;

        while (current &lt;= end_time) {
            auto next = current + interval;
            auto [first, last] = find_in_range(current, next);

            if (first != last) {
                // Simple average of values in the interval
                double sum = 0;
                size_t count = 0;
                for (; first != last; ++first) {
                    sum += first-&gt;value;
                    ++count;
                }
                result.points.push_back({current, sum / count});
            }

            current = next;
        }

        return result;
    }
};
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Optimizing time-related code requires careful consideration of both algorithmic efficiency and practical constraints. By following these guidelines and measuring performance in your specific use case, you can achieve optimal performance with Chronovyan.</p>
<p>Remember to always profile your application to identify actual bottlenecks before optimizing. In many cases, the biggest performance gains come from higher-level architectural decisions rather than micro-optimizations of time operations.
    }
}
BENCHMARK(BM_TimeFormatting);</p>
<p>BENCHMARK_MAIN();
```</p>
<h2 id="memory-usage">Memory Usage</h2>
<p>Be aware of the memory footprint:</p>
<ul>
<li><code>time_point&lt;system_clock&gt;</code>: Typically 8 bytes (64-bit)</li>
<li><code>time_point&lt;system_clock, nanoseconds&gt;</code>: 16 bytes (for higher precision)</li>
<li><code>zoned_time</code>: Larger due to time zone data</li>
</ul>
<h2 id="thread-safety">Thread Safety</h2>
<ul>
<li><strong>Thread-safe</strong>: All const operations on time points and durations</li>
<li><strong>Not thread-safe</strong>: Time zone database operations (use locks if modifying)</li>
</ul>
<h2 id="profiling-tips">Profiling Tips</h2>
<ol>
<li>Profile your application to identify time-related bottlenecks</li>
<li>Look for:</li>
<li>Excessive time zone conversions</li>
<li>String formatting in tight loops</li>
<li>Unnecessary time point copies</li>
<li>Suboptimal duration types</li>
</ol>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "search.highlight"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>