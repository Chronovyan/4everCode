
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for source_location_guidelines.md">
      
      
      
        <link rel="canonical" href="https://chronovyan.github.io/source_location_guidelines/">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Source Location Guidelines - Chronovyan</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#source-location-guidelines" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Chronovyan" class="md-header__button md-logo" aria-label="Chronovyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chronovyan
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Source Location Guidelines
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="blue"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Chronovyan/Chronovyan" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Chronovyan/Chronovyan
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../getting-started/installation/" class="md-tabs__link">
          
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../api/index.md" class="md-tabs__link">
        
  
    
  
  API Reference

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../CONTRIBUTING.md" class="md-tabs__link">
        
  
    
  
  Contributing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Chronovyan" class="md-nav__button md-logo" aria-label="Chronovyan" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Chronovyan
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Chronovyan/Chronovyan" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Chronovyan/Chronovyan
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Start
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../CONTRIBUTING.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-components" class="md-nav__link">
    <span class="md-ellipsis">
      Key Components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sourcelocation-usage" class="md-nav__link">
    <span class="md-ellipsis">
      SourceLocation Usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SourceLocation Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-source-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Source Locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checking-validity" class="md-nav__link">
    <span class="md-ellipsis">
      Checking Validity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-location-ranges" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Location Ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparing-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Comparing Locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-detailed-information" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Detailed Information
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-always-propagate-source-locations" class="md-nav__link">
    <span class="md-ellipsis">
      1. Always Propagate Source Locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-use-mergelocations-for-compound-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      2. Use mergeLocations for Compound Expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-never-use-default-locations-for-errors" class="md-nav__link">
    <span class="md-ellipsis">
      3. Never Use Default Locations for Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-use-detailed-locations-for-important-errors" class="md-nav__link">
    <span class="md-ellipsis">
      4. Use Detailed Locations for Important Errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-create-helper-methods-for-common-location-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      5. Create Helper Methods for Common Location Patterns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#losing-location-information" class="md-nav__link">
    <span class="md-ellipsis">
      Losing Location Information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-invalid-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Using Invalid Locations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#not-handling-exceptions" class="md-nav__link">
    <span class="md-ellipsis">
      Not Handling Exceptions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-error-handler" class="md-nav__link">
    <span class="md-ellipsis">
      Integration with Error Handler
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extending-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      Extending the System
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="source-location-guidelines">Source Location Guidelines</h1>
<h2 id="overview">Overview</h2>
<p>The SourceLocation system in Chronovyan is a fundamental component for error reporting, debugging, and code analysis. It provides the spatial coordinates within source code that enable precise error messages, stack traces, and debugging information.</p>
<p>This document outlines the best practices for using the SourceLocation system to ensure consistent and accurate source location tracking throughout the codebase.</p>
<h2 id="key-components">Key Components</h2>
<p>The source location system consists of the following main components:</p>
<ol>
<li><strong>SourceLocation</strong>: A struct representing a location in the source code (file, line, column, position).</li>
<li><strong>SourceFile</strong>: A class representing a source file with utility methods for line/column tracking.</li>
<li><strong>Helper Functions</strong>: Utility functions for creating and manipulating source locations.</li>
</ol>
<h2 id="sourcelocation-usage">SourceLocation Usage</h2>
<h3 id="creating-source-locations">Creating Source Locations</h3>
<p>When creating a SourceLocation, always prefer using actual locations from the source when available:</p>
<pre><code class="language-cpp">// Create a location with known coordinates
SourceLocation location(sourceFile, line, column, position);

// Use helper function to create the best possible location
SourceLocation bestLocation = createBestLocation(sourceFile, line, column, position);
</code></pre>
<p>Only use the default constructor when the location is genuinely unknown:</p>
<pre><code class="language-cpp">// Only use this when the location is truly unknown
SourceLocation unknownLocation;
</code></pre>
<h3 id="checking-validity">Checking Validity</h3>
<p>Always check if a source location is valid before using it in critical operations:</p>
<pre><code class="language-cpp">if (location.isValid()) {
    // Use the location
} else {
    // Fall back to a default behavior
}
</code></pre>
<h3 id="creating-location-ranges">Creating Location Ranges</h3>
<p>Use the <code>createRange</code> method to create a location that spans from one location to another:</p>
<pre><code class="language-cpp">try {
    SourceLocation range = startLocation.createRange(endLocation);
    // Use the range
} catch (const std::invalid_argument&amp; e) {
    // Handle the error (locations from different files, etc.)
}
</code></pre>
<p>Or use the <code>mergeLocations</code> helper function for a safer approach:</p>
<pre><code class="language-cpp">SourceLocation range = mergeLocations(startLocation, endLocation);
// This will never throw, even if the locations are invalid or from different files
</code></pre>
<h3 id="comparing-locations">Comparing Locations</h3>
<p>Use the comparison methods to determine the order of locations:</p>
<pre><code class="language-cpp">if (location1.isBefore(location2)) {
    // location1 is before location2 in the source code
}

if (location1.isAfter(location2)) {
    // location1 is after location2 in the source code
}

if (location1 == location2) {
    // Locations are the same
}
</code></pre>
<h3 id="getting-detailed-information">Getting Detailed Information</h3>
<p>Use the <code>toDetailedString</code> method to get a more detailed representation of a location:</p>
<pre><code class="language-cpp">// Get a detailed string with the line content
std::string detailed = location.toDetailedString(true);
std::cout &lt;&lt; detailed &lt;&lt; std::endl;
/* Output example:
file.chv:10:15
some code here
              ^
*/
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-always-propagate-source-locations">1. Always Propagate Source Locations</h3>
<p>When creating AST nodes, tokens, or other syntax elements, always propagate the source location information:</p>
<pre><code class="language-cpp">// Good: Propagate the location from child to parent
ExprNode::ExprNode(const SourceLocation&amp; location) : ASTNode(location) {}

// Better: Use child's location if available, otherwise default
BinaryExprNode::BinaryExprNode(
    std::unique_ptr&lt;ExprNode&gt; left,
    Token op,
    std::unique_ptr&lt;ExprNode&gt; right
) : ExprNode(op.location), // Use the operator's location as the base
    m_left(std::move(left)),
    m_operator(std::move(op)),
    m_right(std::move(right)) {}
</code></pre>
<h3 id="2-use-mergelocations-for-compound-expressions">2. Use mergeLocations for Compound Expressions</h3>
<p>When creating nodes that span multiple tokens or expressions, use <code>mergeLocations</code> to create a location that covers the entire range:</p>
<pre><code class="language-cpp">// Create a location that spans from the start of the condition to the end of the else branch
SourceLocation ifStmtLocation = mergeLocations(
    condition-&gt;getLocation(),
    elseBranch ? elseBranch-&gt;getLocation() : thenBranch-&gt;getLocation()
);

// Create the if statement node with the merged location
return std::make_unique&lt;IfStmtNode&gt;(ifStmtLocation, std::move(condition), std::move(thenBranch), std::move(elseBranch));
</code></pre>
<h3 id="3-never-use-default-locations-for-errors">3. Never Use Default Locations for Errors</h3>
<p>Always provide a valid source location when reporting errors:</p>
<pre><code class="language-cpp">// Bad: Using default location loses context
ErrorHandler::getInstance().reportError(
    SourceLocation(),
    &quot;Something went wrong&quot;
);

// Good: Using the actual location
ErrorHandler::getInstance().reportError(
    node-&gt;getLocation(),
    &quot;Something went wrong&quot;
);
</code></pre>
<h3 id="4-use-detailed-locations-for-important-errors">4. Use Detailed Locations for Important Errors</h3>
<p>For important errors, use detailed location information:</p>
<pre><code class="language-cpp">// Provide detailed context for important errors
std::string errorMessage = &quot;Invalid type conversion from &quot; + sourceType + &quot; to &quot; + targetType;
ErrorHandler::getInstance().reportError(
    node-&gt;getLocation(),
    errorMessage
);

// Log detailed location for debugging
std::cerr &lt;&lt; &quot;Error at &quot; &lt;&lt; node-&gt;getLocation().toDetailedString(true) &lt;&lt; std::endl;
</code></pre>
<h3 id="5-create-helper-methods-for-common-location-patterns">5. Create Helper Methods for Common Location Patterns</h3>
<p>If you find yourself repeatedly creating locations in a certain way, consider adding helper methods:</p>
<pre><code class="language-cpp">// Helper to create a location for a binary operation
SourceLocation createBinaryOpLocation(
    const ExprNode* left,
    const Token&amp; op,
    const ExprNode* right
) {
    return mergeLocations(left-&gt;getLocation(), right-&gt;getLocation());
}
</code></pre>
<h2 id="common-pitfalls">Common Pitfalls</h2>
<h3 id="losing-location-information">Losing Location Information</h3>
<p>A common pitfall is losing source location information when creating new AST nodes or tokens:</p>
<pre><code class="language-cpp">// Bad: Using default location loses information
std::unique_ptr&lt;ExprNode&gt; expr = std::make_unique&lt;LiteralExprNode&gt;(
    SourceLocation(),
    value
);

// Good: Propagating the location
std::unique_ptr&lt;ExprNode&gt; expr = std::make_unique&lt;LiteralExprNode&gt;(
    token.location,
    value
);
</code></pre>
<h3 id="using-invalid-locations">Using Invalid Locations</h3>
<p>Another common issue is using invalid locations without checking:</p>
<pre><code class="language-cpp">// Bad: Might crash if location is invalid
std::string locationStr = location.toString();
ErrorHandler::getInstance().reportError(location, &quot;Error message&quot;);

// Good: Check validity
if (location.isValid()) {
    ErrorHandler::getInstance().reportError(location, &quot;Error message&quot;);
} else {
    ErrorHandler::getInstance().reportError(
        createBestLocation(currentFile), 
        &quot;Error message (location unknown)&quot;
    );
}
</code></pre>
<h3 id="not-handling-exceptions">Not Handling Exceptions</h3>
<p>Some SourceLocation methods can throw exceptions. Always handle them appropriately:</p>
<pre><code class="language-cpp">// Bad: Might throw
SourceLocation range = location1.createRange(location2);

// Good: Handle exceptions
try {
    SourceLocation range = location1.createRange(location2);
    // Use the range
} catch (const std::invalid_argument&amp; e) {
    // Fall back to a simpler approach
    SourceLocation fallback = location1;
    // Use the fallback
}

// Alternative: Use the safer helper function
SourceLocation range = mergeLocations(location1, location2);
// This will never throw
</code></pre>
<h2 id="integration-with-error-handler">Integration with Error Handler</h2>
<p>The SourceLocation system is designed to work seamlessly with the ErrorHandler class. When reporting errors, always provide the most specific source location available:</p>
<pre><code class="language-cpp">// Report an error with a specific location
ErrorHandler::getInstance().reportError(
    node-&gt;getLocation(),
    &quot;Invalid operation for type &quot; + typeStr
);

// Report a warning with a specific location
ErrorHandler::getInstance().reportWarning(
    token.location,
    &quot;Deprecated syntax - use the new form instead&quot;
);

// Report a fatal error with a specific location
ErrorHandler::getInstance().reportFatalError(
    expr-&gt;getLocation(),
    &quot;Unrecoverable type mismatch&quot;
);
</code></pre>
<h2 id="extending-the-system">Extending the System</h2>
<p>If you need to extend the SourceLocation system, consider:</p>
<ol>
<li>Adding new helper methods to create locations for specific syntax constructs.</li>
<li>Enhancing the <code>toDetailedString</code> method to provide more context.</li>
<li>Adding support for multi-file ranges (for include/import scenarios).</li>
<li>Integrating with an IDE or debugging tool for visual highlighting.</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>The SourceLocation system is a critical component of the Chronovyan codebase, enabling precise error reporting and debugging. By following these guidelines, you can ensure that source locations are tracked consistently and accurately throughout the codebase, leading to better error messages and debugging experience for users.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "search.highlight"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>