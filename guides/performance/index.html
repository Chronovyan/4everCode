<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Best practices and techniques for optimizing Chronovyan performance"><meta name=author content="Chronovyan Team"><link href=https://forevercode.chronovyan.com/guides/performance/ rel=canonical><link href=../timezones/ rel=prev><link href=../choosing_optimization_strategies/ rel=next><link rel=alternate type=application/rss+xml title="RSS feed" href=../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../../feed_rss_updated.xml><link rel=icon href=../../docs/assets/images/favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.14"><!-- Preload Fonts --><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Montserrat:wght@700;800&family=Fira+Code:wght@400;700&display=swap" rel=stylesheet><!-- Custom CSS --><link rel=stylesheet href=../../assets/css/forever-code-theme.css><title>Performance Optimization - Chronovyan</title><link rel=stylesheet href=../../assets/stylesheets/main.342714a4.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Code:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"Fira Code"}</style><link rel=stylesheet href=../../css/timeago.css><link rel=stylesheet href=../../assets/stylesheets/custom.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=#1A0033 data-md-color-accent=#8E24AA> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#performance-optimization-guide class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <!-- Custom header with logo --> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=header.title> <!-- Logo --> <a href=https://forevercode.chronovyan.com/ class="md-header__button md-logo" aria-label=Chronovyan data-md-component=logo> <svg class=logo-svg viewbox="0 0 64 64" fill=none xmlns=http://www.w3.org/2000/svg> <path stroke=url(#navGrad) stroke-width=2 stroke-linecap=round stroke-linejoin=round d="M12 24L32 12L52 24L32 36L12 24Z"/> <path stroke=url(#navGrad) stroke-width=2 stroke-linecap=round stroke-linejoin=round d="M12 40L32 52L52 40L32 28L12 40Z"/> <path stroke=url(#navGrad) stroke-width=2 stroke-linecap=round stroke-linejoin=round d="M32 12V52"/> <defs> <lineargradient id=navGrad x1=0% y1=0% x2=100% y2=100%> <stop offset=0% style=stop-color:#1A0033;stop-opacity:1 /> <stop offset=100% style=stop-color:#8E24AA;stop-opacity:1 /> </lineargradient> </defs> </svg> <span class=logo-text>FOREVER<span class=logo-version>.4e</span></span> </a> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Chronovyan </span> </div> </div> </div> <!-- Navigation --> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/installation/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../core/ class=md-tabs__link> Core </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../Path%20of%20the%20Conformist%20-%20Foundational%20Guide/ class=md-tabs__link> Guides </a> </li> <li class=md-tabs__item> <a href=../../reference/language/specification/ class=md-tabs__link> Reference </a> </li> <li class=md-tabs__item> <a href=../../tutorials/Interactive%20Tutorials%20-%20The%20Hands-on%20Path%20to%20Mastery/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../../roadmap/ class=md-tabs__link> Roadmap </a> </li> </ul> </div> </nav> <!-- Search --> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/Chronovyan/ForeverCode title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Chronovyan/ForeverCode </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Chronovyan class="md-nav__button md-logo" aria-label=Chronovyan data-md-component=logo> <img src=../../docs/assets/images/logo.svg alt=logo> </a> Chronovyan </label> <div class=md-nav__source> <a href=https://github.com/Chronovyan/ForeverCode title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> Chronovyan/ForeverCode </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class=md-nav__item> <a href=../../core/ class=md-nav__link> <span class=md-ellipsis> Core </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Path%20of%20the%20Conformist%20-%20Foundational%20Guide/ class=md-nav__link> <span class=md-ellipsis> Path of the Conformist </span> </a> </li> <li class=md-nav__item> <a href=../The%20Rebel%27s%20Handbook%20-%20Advanced%20Temporal%20Weaving/ class=md-nav__link> <span class=md-ellipsis> The Rebel's Handbook </span> </a> </li> <li class=md-nav__item> <a href=../Style%20Guide%20-%20The%20Art%20of%20Temporal%20Expression/ class=md-nav__link> <span class=md-ellipsis> Style Guide </span> </a> </li> <li class=md-nav__item> <a href=../Temporal%20Synchronization%20-%20The%20Art%20of%20Temporal%20Harmony/ class=md-nav__link> <span class=md-ellipsis> Temporal Synchronization </span> </a> </li> <li class=md-nav__item> <a href=../standard_library_guide/ class=md-nav__link> <span class=md-ellipsis> Standard Library Guide </span> </a> </li> <li class=md-nav__item> <a href=../timezones/ class=md-nav__link> <span class=md-ellipsis> Timezones </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Performance </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Performance </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#table-of-contents class=md-nav__link> <span class=md-ellipsis> Table of Contents </span> </a> </li> <li class=md-nav__item> <a href=#performance-cheat-sheet class=md-nav__link> <span class=md-ellipsis> Performance Cheat Sheet </span> </a> </li> <li class=md-nav__item> <a href=#clock-selection class=md-nav__link> <span class=md-ellipsis> Clock Selection </span> </a> <nav class=md-nav aria-label="Clock Selection"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#when-to-use-each-clock class=md-nav__link> <span class=md-ellipsis> When to Use Each Clock </span> </a> </li> <li class=md-nav__item> <a href=#example-usage class=md-nav__link> <span class=md-ellipsis> Example Usage </span> </a> </li> <li class=md-nav__item> <a href=#performance-characteristics class=md-nav__link> <span class=md-ellipsis> Performance Characteristics </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#time-point-arithmetic class=md-nav__link> <span class=md-ellipsis> Time Point Arithmetic </span> </a> <nav class=md-nav aria-label="Time Point Arithmetic"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prefer-duration-types class=md-nav__link> <span class=md-ellipsis> Prefer Duration Types </span> </a> </li> <li class=md-nav__item> <a href=#batch-operations class=md-nav__link> <span class=md-ellipsis> Batch Operations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#time-zone-optimization class=md-nav__link> <span class=md-ellipsis> Time Zone Optimization </span> </a> <nav class=md-nav aria-label="Time Zone Optimization"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-cache-time-zone-lookups class=md-nav__link> <span class=md-ellipsis> 1. Cache Time Zone Lookups </span> </a> <nav class=md-nav aria-label="1. Cache Time Zone Lookups"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#inefficient-repeated-lookups class=md-nav__link> <span class=md-ellipsis> ❌ Inefficient - Repeated Lookups </span> </a> </li> <li class=md-nav__item> <a href=#better-cached-lookups class=md-nav__link> <span class=md-ellipsis> ✅ Better - Cached Lookups </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-batch-time-zone-conversions class=md-nav__link> <span class=md-ellipsis> 2. Batch Time Zone Conversions </span> </a> <nav class=md-nav aria-label="2. Batch Time Zone Conversions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#single-vs-batch-conversion class=md-nav__link> <span class=md-ellipsis> Single vs Batch Conversion </span> </a> </li> <li class=md-nav__item> <a href=#implementation class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-time-zone-conversion-performance-tips class=md-nav__link> <span class=md-ellipsis> 3. Time Zone Conversion Performance Tips </span> </a> </li> <li class=md-nav__item> <a href=#4-thread-safety class=md-nav__link> <span class=md-ellipsis> 4. Thread Safety </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#string-operations class=md-nav__link> <span class=md-ellipsis> String Operations </span> </a> <nav class=md-nav aria-label="String Operations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-avoid-formatting-in-tight-loops class=md-nav__link> <span class=md-ellipsis> 1. Avoid Formatting in Tight Loops </span> </a> <nav class=md-nav aria-label="1. Avoid Formatting in Tight Loops"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#inefficient-multiple-allocations class=md-nav__link> <span class=md-ellipsis> ❌ Inefficient - Multiple Allocations </span> </a> </li> <li class=md-nav__item> <a href=#better-reuse-buffer class=md-nav__link> <span class=md-ellipsis> ✅ Better - Reuse Buffer </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-use-string-views-for-parsing class=md-nav__link> <span class=md-ellipsis> 2. Use String Views for Parsing </span> </a> <nav class=md-nav aria-label="2. Use String Views for Parsing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation_1 class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-performance-comparison class=md-nav__link> <span class=md-ellipsis> 3. Performance Comparison </span> </a> </li> <li class=md-nav__item> <a href=#4-format-string-optimization class=md-nav__link> <span class=md-ellipsis> 4. Format String Optimization </span> </a> </li> <li class=md-nav__item> <a href=#5-memory-allocation-strategies class=md-nav__link> <span class=md-ellipsis> 5. Memory Allocation Strategies </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#memory-management class=md-nav__link> <span class=md-ellipsis> Memory Management </span> </a> <nav class=md-nav aria-label="Memory Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#avoid-unnecessary-copies class=md-nav__link> <span class=md-ellipsis> Avoid Unnecessary Copies </span> </a> </li> <li class=md-nav__item> <a href=#use-stack-allocation-when-possible class=md-nav__link> <span class=md-ellipsis> Use Stack Allocation When Possible </span> </a> </li> <li class=md-nav__item> <a href=#smart-pointers-for-resource-management class=md-nav__link> <span class=md-ellipsis> Smart Pointers for Resource Management </span> </a> </li> <li class=md-nav__item> <a href=#memory-pools-for-frequent-allocations class=md-nav__link> <span class=md-ellipsis> Memory Pools for Frequent Allocations </span> </a> </li> <li class=md-nav__item> <a href=#memory-layout-optimization class=md-nav__link> <span class=md-ellipsis> Memory Layout Optimization </span> </a> </li> <li class=md-nav__item> <a href=#memory-mapped-files-for-large-datasets class=md-nav__link> <span class=md-ellipsis> Memory-Mapped Files for Large Datasets </span> </a> </li> <li class=md-nav__item> <a href=#custom-allocators class=md-nav__link> <span class=md-ellipsis> Custom Allocators </span> </a> </li> <li class=md-nav__item> <a href=#memory-leak-detection class=md-nav__link> <span class=md-ellipsis> Memory Leak Detection </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#duration-types class=md-nav__link> <span class=md-ellipsis> Duration Types </span> </a> <nav class=md-nav aria-label="Duration Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#duration-type-selection-guide class=md-nav__link> <span class=md-ellipsis> Duration Type Selection Guide </span> </a> </li> <li class=md-nav__item> <a href=#duration-type-comparison class=md-nav__link> <span class=md-ellipsis> Duration Type Comparison </span> </a> </li> <li class=md-nav__item> <a href=#memory-layout class=md-nav__link> <span class=md-ellipsis> Memory Layout </span> </a> </li> <li class=md-nav__item> <a href=#example-usage_1 class=md-nav__link> <span class=md-ellipsis> Example Usage </span> </a> </li> <li class=md-nav__item> <a href=#performance-considerations class=md-nav__link> <span class=md-ellipsis> Performance Considerations </span> </a> </li> <li class=md-nav__item> <a href=#common-pitfalls class=md-nav__link> <span class=md-ellipsis> Common Pitfalls </span> </a> </li> <li class=md-nav__item> <a href=#1-thread-local-caching class=md-nav__link> <span class=md-ellipsis> 1. Thread-Local Caching </span> </a> <nav class=md-nav aria-label="1. Thread-Local Caching"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#inefficient-global-cache-with-locks class=md-nav__link> <span class=md-ellipsis> ❌ Inefficient - Global Cache with Locks </span> </a> </li> <li class=md-nav__item> <a href=#better-thread-local-storage class=md-nav__link> <span class=md-ellipsis> ✅ Better - Thread-Local Storage </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-immutable-time-objects class=md-nav__link> <span class=md-ellipsis> 2. Immutable Time Objects </span> </a> </li> <li class=md-nav__item> <a href=#3-thread-safety-patterns class=md-nav__link> <span class=md-ellipsis> 3. Thread Safety Patterns </span> </a> <nav class=md-nav aria-label="3. Thread Safety Patterns"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#read-copy-update-rcu class=md-nav__link> <span class=md-ellipsis> Read-Copy-Update (RCU) </span> </a> </li> <li class=md-nav__item> <a href=#implementation-with-stdshared_ptr class=md-nav__link> <span class=md-ellipsis> Implementation with std::shared_ptr </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-false-sharing-prevention class=md-nav__link> <span class=md-ellipsis> 4. False Sharing Prevention </span> </a> <nav class=md-nav aria-label="4. False Sharing Prevention"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cache-line-alignment class=md-nav__link> <span class=md-ellipsis> Cache Line Alignment </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-thread-safe-factory-pattern class=md-nav__link> <span class=md-ellipsis> 5. Thread-Safe Factory Pattern </span> </a> <nav class=md-nav aria-label="5. Thread-Safe Factory Pattern"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implementation_2 class=md-nav__link> <span class=md-ellipsis> Implementation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#compile-time-optimization class=md-nav__link> <span class=md-ellipsis> Compile-Time Optimization </span> </a> <nav class=md-nav aria-label="Compile-Time Optimization"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-compile-time-calculations class=md-nav__link> <span class=md-ellipsis> 1. Compile-Time Calculations </span> </a> <nav class=md-nav aria-label="1. Compile-Time Calculations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#runtime-calculation class=md-nav__link> <span class=md-ellipsis> ❌ Runtime Calculation </span> </a> </li> <li class=md-nav__item> <a href=#compile-time-calculation class=md-nav__link> <span class=md-ellipsis> ✅ Compile-Time Calculation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-type-aliases-and-constants class=md-nav__link> <span class=md-ellipsis> 2. Type Aliases and Constants </span> </a> <nav class=md-nav aria-label="2. Type Aliases and Constants"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#type-aliases class=md-nav__link> <span class=md-ellipsis> Type Aliases </span> </a> </li> <li class=md-nav__item> <a href=#common-aliases class=md-nav__link> <span class=md-ellipsis> Common Aliases </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-compile-time-string-processing class=md-nav__link> <span class=md-ellipsis> 3. Compile-Time String Processing </span> </a> <nav class=md-nav aria-label="3. Compile-Time String Processing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#format-string-validation class=md-nav__link> <span class=md-ellipsis> Format String Validation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-compile-time-date-calculations class=md-nav__link> <span class=md-ellipsis> 4. Compile-Time Date Calculations </span> </a> <nav class=md-nav aria-label="4. Compile-Time Date Calculations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#date-algorithms class=md-nav__link> <span class=md-ellipsis> Date Algorithms </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-compile-time-performance-benefits class=md-nav__link> <span class=md-ellipsis> 5. Compile-Time Performance Benefits </span> </a> </li> <li class=md-nav__item> <a href=#6-type-safe-units class=md-nav__link> <span class=md-ellipsis> 6. Type-Safe Units </span> </a> </li> <li class=md-nav__item> <a href=#7-compile-time-formatting class=md-nav__link> <span class=md-ellipsis> 7. Compile-Time Formatting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#benchmarking class=md-nav__link> <span class=md-ellipsis> Benchmarking </span> </a> <nav class=md-nav aria-label=Benchmarking> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-benchmarking-with-google-benchmark class=md-nav__link> <span class=md-ellipsis> 1. Benchmarking with Google Benchmark </span> </a> <nav class=md-nav aria-label="1. Benchmarking with Google Benchmark"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#basic-benchmark-structure class=md-nav__link> <span class=md-ellipsis> Basic Benchmark Structure </span> </a> </li> <li class=md-nav__item> <a href=#time-formatting-benchmark class=md-nav__link> <span class=md-ellipsis> Time Formatting Benchmark </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-benchmarking-different-approaches class=md-nav__link> <span class=md-ellipsis> 2. Benchmarking Different Approaches </span> </a> <nav class=md-nav aria-label="2. Benchmarking Different Approaches"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#comparing-multiple-implementations class=md-nav__link> <span class=md-ellipsis> Comparing Multiple Implementations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-memory-benchmarking class=md-nav__link> <span class=md-ellipsis> 3. Memory Benchmarking </span> </a> <nav class=md-nav aria-label="3. Memory Benchmarking"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#memory-usage-analysis class=md-nav__link> <span class=md-ellipsis> Memory Usage Analysis </span> </a> </li> <li class=md-nav__item> <a href=#memory-benchmark-example class=md-nav__link> <span class=md-ellipsis> Memory Benchmark Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4-cache-behavior-analysis class=md-nav__link> <span class=md-ellipsis> 4. Cache Behavior Analysis </span> </a> <nav class=md-nav aria-label="4. Cache Behavior Analysis"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cache-performance class=md-nav__link> <span class=md-ellipsis> Cache Performance </span> </a> </li> <li class=md-nav__item> <a href=#cache-aware-benchmark class=md-nav__link> <span class=md-ellipsis> Cache-Aware Benchmark </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-thread-scaling-benchmarks class=md-nav__link> <span class=md-ellipsis> 5. Thread Scaling Benchmarks </span> </a> <nav class=md-nav aria-label="5. Thread Scaling Benchmarks"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#multi-threaded-performance class=md-nav__link> <span class=md-ellipsis> Multi-threaded Performance </span> </a> </li> <li class=md-nav__item> <a href=#thread-scaling-benchmark class=md-nav__link> <span class=md-ellipsis> Thread Scaling Benchmark </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-benchmark-analysis-and-reporting class=md-nav__link> <span class=md-ellipsis> 6. Benchmark Analysis and Reporting </span> </a> <nav class=md-nav aria-label="6. Benchmark Analysis and Reporting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#performance-metrics class=md-nav__link> <span class=md-ellipsis> Performance Metrics </span> </a> </li> <li class=md-nav__item> <a href=#generating-reports class=md-nav__link> <span class=md-ellipsis> Generating Reports </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-benchmarking-best-practices class=md-nav__link> <span class=md-ellipsis> 7. Benchmarking Best Practices </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#real-world-examples class=md-nav__link> <span class=md-ellipsis> Real-World Examples </span> </a> <nav class=md-nav aria-label="Real-World Examples"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#high-performance-logging class=md-nav__link> <span class=md-ellipsis> High-Performance Logging </span> </a> </li> <li class=md-nav__item> <a href=#efficient-time-series-processing class=md-nav__link> <span class=md-ellipsis> Efficient Time Series Processing </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#conclusion class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> <li class=md-nav__item> <a href=#memory-usage class=md-nav__link> <span class=md-ellipsis> Memory Usage </span> </a> </li> <li class=md-nav__item> <a href=#thread-safety class=md-nav__link> <span class=md-ellipsis> Thread Safety </span> </a> </li> <li class=md-nav__item> <a href=#profiling-tips class=md-nav__link> <span class=md-ellipsis> Profiling Tips </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../choosing_optimization_strategies/ class=md-nav__link> <span class=md-ellipsis> Choosing Optimization Strategies </span> </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4_9> <label class=md-nav__link for=__nav_4_9 id=__nav_4_9_label tabindex> <span class=md-ellipsis> Advanced </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_9_label aria-expanded=false> <label class=md-nav__title for=__nav_4_9> <span class="md-nav__icon md-icon"></span> Advanced </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../advanced/primer/ class=md-nav__link> <span class=md-ellipsis> Primer </span> </a> </li> <li class=md-nav__item> <a href=../advanced/advanced-mechanics/ class=md-nav__link> <span class=md-ellipsis> Advanced Mechanics </span> </a> </li> <li class=md-nav__item> <a href=../advanced/optimization-algorithms/ class=md-nav__link> <span class=md-ellipsis> Optimization Algorithms </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../reference/language/specification/ class=md-nav__link> <span class=md-ellipsis> Reference </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../tutorials/Interactive%20Tutorials%20-%20The%20Hands-on%20Path%20to%20Mastery/ class=md-nav__link> <span class=md-ellipsis> Tutorials </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../../roadmap/ class=md-nav__link> <span class=md-ellipsis> Roadmap </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/Chronovyan/ForeverCode/edit/main/docs/guides/performance.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/Chronovyan/ForeverCode/raw/main/docs/guides/performance.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <h1 id=performance-optimization-guide>Performance Optimization Guide<a class=headerlink href=#performance-optimization-guide title="Permanent link">&para;</a></h1> <p>This guide provides best practices and techniques for optimizing the performance of applications using Chronovyan. Following these guidelines will help you write efficient and scalable time-handling code.</p> <pre class=mermaid><code>graph TD
    A[Performance Considerations] --&gt; B[Clock Selection]
    A --&gt; C[Time Point Arithmetic]
    A --&gt; D[Time Zone Optimization]
    A --&gt; E[String Operations]
    A --&gt; F[Memory Management]
    B --&gt; G[system_clock, steady_clock, high_resolution_clock]
    C --&gt; H[Duration Types, Batch Operations]
    D --&gt; I[Cache Lookups, Batch Conversions]
    E --&gt; J[Pre-allocation, String Views]
    F --&gt; K[Avoid Copies, Smart Pointers]</code></pre> <h2 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h2> <ul> <li><a href=#clock-selection>Clock Selection</a></li> <li><a href=#time-point-arithmetic>Time Point Arithmetic</a></li> <li><a href=#time-zone-optimization>Time Zone Optimization</a></li> <li><a href=#string-operations>String Operations</a></li> <li><a href=#duration-types>Duration Types</a></li> <li><a href=#memory-management>Memory Management</a></li> <li><a href=#thread-safety>Thread Safety</a></li> <li><a href=#compile-time-optimization>Compile-Time Optimization</a></li> <li><a href=#benchmarking>Benchmarking</a></li> <li><a href=#real-world-examples>Real-World Examples</a></li> </ul> <h2 id=performance-cheat-sheet>Performance Cheat Sheet<a class=headerlink href=#performance-cheat-sheet title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Operation</th> <th>Fast ✅</th> <th>Slow ❌</th> </tr> </thead> <tbody> <tr> <td>Clock Access</td> <td><code>steady_clock::now()</code></td> <td><code>system_clock::now()</code></td> </tr> <tr> <td>Time Zone</td> <td>Cached lookup</td> <td>Repeated lookups</td> </tr> <tr> <td>String Ops</td> <td><code>format_to</code> with buffer</td> <td>Multiple allocations</td> </tr> <tr> <td>Duration</td> <td>Fixed-size types</td> <td>Floating-point</td> </tr> <tr> <td>Memory</td> <td>Stack allocation</td> <td>Unnecessary copies</td> </tr> </tbody> </table> <h2 id=clock-selection>Clock Selection<a class=headerlink href=#clock-selection title="Permanent link">&para;</a></h2> <pre class=mermaid><code>pie
    title Clock Characteristics
    "Monotonic" : 2
    "Adjustable" : 1
    "High Precision" : 1</code></pre> <p>Choose the most appropriate clock for your use case:</p> <table> <thead> <tr> <th>Clock Type</th> <th>Characteristics</th> <th>Best For</th> <th>Performance</th> </tr> </thead> <tbody> <tr> <td><code>system_clock</code></td> <td>Wall clock time, can be adjusted</td> <td>Timestamps, logging</td> <td>⚡ Fast</td> </tr> <tr> <td><code>steady_clock</code></td> <td>Monotonic, never adjusted</td> <td>Measuring intervals, timeouts</td> <td>⚡⚡ Very Fast</td> </tr> <tr> <td><code>high_resolution_clock</code></td> <td>Shortest tick period available</td> <td>Precise measurements</td> <td>⚡⚡⚡ Fastest</td> </tr> </tbody> </table> <h3 id=when-to-use-each-clock>When to Use Each Clock<a class=headerlink href=#when-to-use-each-clock title="Permanent link">&para;</a></h3> <pre class=mermaid><code>flowchart LR
    A[Need Timestamp?] --&gt;|Yes| B[system_clock]
    A --&gt;|No| C[Measuring Time?]
    C --&gt;|Yes| D[steady_clock]
    C --&gt;|No| E[Need Max Precision?]
    E --&gt;|Yes| F[high_resolution_clock]
    E --&gt;|No| G[steady_clock]</code></pre> <h3 id=example-usage>Example Usage<a class=headerlink href=#example-usage title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=c1>// For timestamps (can be affected by system time changes)</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=k>auto</span><span class=w> </span><span class=n>timestamp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=c1>// For measuring intervals (monotonic)</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=k>auto</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=c1>// ... operation ...</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=k>auto</span><span class=w> </span><span class=n>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=k>auto</span><span class=w> </span><span class=n>duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start</span><span class=p>;</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=c1>// For high-precision timing</span>
</span><span id=__span-0-11><a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a><span class=k>auto</span><span class=w> </span><span class=n>precise_start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-0-12><a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=c1>// ... precision-sensitive operation ...</span>
</span><span id=__span-0-13><a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=k>auto</span><span class=w> </span><span class=n>precise_end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></code></pre></div> <h3 id=performance-characteristics>Performance Characteristics<a class=headerlink href=#performance-characteristics title="Permanent link">&para;</a></h3> <pre class=mermaid><code>bar
    title Clock Access Latency (lower is better)
    system_clock: 15
    steady_clock: 12
    high_resolution_clock: 10</code></pre> <h2 id=time-point-arithmetic>Time Point Arithmetic<a class=headerlink href=#time-point-arithmetic title="Permanent link">&para;</a></h2> <h3 id=prefer-duration-types>Prefer Duration Types<a class=headerlink href=#prefer-duration-types title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1>// Good: Using duration literals</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>std</span><span class=o>::</span><span class=nn>chrono_literals</span><span class=p>;</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=k>auto</span><span class=w> </span><span class=n>timeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>500</span><span class=n>ms</span><span class=p>;</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1>// Better: Compile-time constants when possible</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>TIMEOUT</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>500</span><span class=n>ms</span><span class=p>;</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>CACHE_TTL</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>24</span><span class=n>h</span><span class=p>;</span>
</span></code></pre></div> <h3 id=batch-operations>Batch Operations<a class=headerlink href=#batch-operations title="Permanent link">&para;</a></h3> <p>For operations on multiple time points, process them in batches to improve cache locality:</p> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=k>struct</span><span class=w> </span><span class=nc>Event</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=w>    </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=w> </span><span class=n>when</span><span class=p>;</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=w>    </span><span class=c1>// ... other data ...</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=p>};</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=c1>// Process events in batches</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=kt>void</span><span class=w> </span><span class=nf>process_events</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Event</span><span class=o>&gt;&amp;</span><span class=w> </span><span class=n>events</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=w>    </span><span class=k>constexpr</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>BATCH_SIZE</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>64</span><span class=p>;</span>
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>events</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>BATCH_SIZE</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>batch_end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>min</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>BATCH_SIZE</span><span class=p>,</span><span class=w> </span><span class=n>events</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a><span class=w>        </span><span class=c1>// Process batch...</span>
</span><span id=__span-2-12><a id=__codelineno-2-12 name=__codelineno-2-12 href=#__codelineno-2-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-2-13><a id=__codelineno-2-13 name=__codelineno-2-13 href=#__codelineno-2-13></a><span class=p>}</span>
</span></code></pre></div> <h2 id=time-zone-optimization>Time Zone Optimization<a class=headerlink href=#time-zone-optimization title="Permanent link">&para;</a></h2> <pre class=mermaid><code>pie
    title Time Zone Operation Costs
    "Lookup" : 40
    "Conversion" : 35
    "Cached Lookup" : 5
    "Cached Conversion" : 20</code></pre> <p>Time zone operations can be performance bottlenecks. Here's how to optimize them:</p> <h3 id=1-cache-time-zone-lookups>1. Cache Time Zone Lookups<a class=headerlink href=#1-cache-time-zone-lookups title="Permanent link">&para;</a></h3> <p>Time zone lookups are expensive operations. Always cache them when possible.</p> <h4 id=inefficient-repeated-lookups>❌ Inefficient - Repeated Lookups<a class=headerlink href=#inefficient-repeated-lookups title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Loop Start] --&gt; B[Lookup Time Zone]
    B --&gt; C[Use Time Zone]
    C --&gt; D[Next Iteration]
    D --&gt; B</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>city</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>cities</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>tz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>locate_zone</span><span class=p>(</span><span class=n>city</span><span class=p>.</span><span class=n>time_zone</span><span class=p>);</span><span class=w>  </span><span class=c1>// Expensive!</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=p>}</span>
</span></code></pre></div> <h4 id=better-cached-lookups>✅ Better - Cached Lookups<a class=headerlink href=#better-cached-lookups title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Create Cache] --&gt; B[Loop Start]
    B --&gt; C{In Cache?}
    C --&gt;|No| D[Lookup &amp; Cache]
    C --&gt;|Yes| E[Use Cached]
    D --&gt; E
    E --&gt; F[Next Iteration]
    F --&gt; C</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>time_zone</span><span class=o>*&gt;</span><span class=w> </span><span class=n>tz_cache</span><span class=p>;</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>city</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>cities</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tz_cache</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>city</span><span class=p>.</span><span class=n>time_zone</span><span class=p>);</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>it</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>tz_cache</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>        </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tz_cache</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>city</span><span class=p>.</span><span class=n>time_zone</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>                             </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>locate_zone</span><span class=p>(</span><span class=n>city</span><span class=p>.</span><span class=n>time_zone</span><span class=p>)).</span><span class=n>first</span><span class=p>;</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>*</span><span class=w> </span><span class=n>tz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>it</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>;</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>    </span><span class=c1>// Use tz...</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=p>}</span>
</span></code></pre></div> <h3 id=2-batch-time-zone-conversions>2. Batch Time Zone Conversions<a class=headerlink href=#2-batch-time-zone-conversions title="Permanent link">&para;</a></h3> <p>When converting multiple time points, process them in batches to improve cache locality.</p> <h4 id=single-vs-batch-conversion>Single vs Batch Conversion<a class=headerlink href=#single-vs-batch-conversion title="Permanent link">&para;</a></h4> <pre class=mermaid><code>gantt
    title Time Zone Conversion Strategies
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Single Conversion
    Lookup TZ       :a1, 0s, 1s
    Convert Time 1  :a2, after a1, 2s
    Convert Time 2  :a3, after a2, 2s

    section Batch Conversion
    Single Lookup   :b1, 0s, 1s
    Convert All     :b2, after b1, 3s</code></pre> <h4 id=implementation>Implementation<a class=headerlink href=#implementation title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kt>void</span><span class=w> </span><span class=nf>convert_times</span><span class=p>(</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=o>&gt;&amp;</span><span class=w> </span><span class=n>utc_times</span><span class=p>,</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*</span><span class=w> </span><span class=n>tz</span><span class=p>,</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>zoned_time</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>::</span><span class=n>duration</span><span class=o>&gt;&gt;&amp;</span><span class=w> </span><span class=n>results</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=w>    </span><span class=n>results</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=w>    </span><span class=n>results</span><span class=p>.</span><span class=n>reserve</span><span class=p>(</span><span class=n>utc_times</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=w>    </span><span class=c1>// Single time zone lookup, multiple conversions</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>utc</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>utc_times</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=w>        </span><span class=n>results</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>tz</span><span class=p>,</span><span class=w> </span><span class=n>utc</span><span class=p>);</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a><span class=p>}</span>
</span></code></pre></div> <h3 id=3-time-zone-conversion-performance-tips>3. Time Zone Conversion Performance Tips<a class=headerlink href=#3-time-zone-conversion-performance-tips title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Operation</th> <th>Cost</th> <th>Optimization</th> </tr> </thead> <tbody> <tr> <td>Time Zone Lookup</td> <td>High</td> <td>Cache results</td> </tr> <tr> <td>First Conversion</td> <td>High</td> <td>Warm up cache early</td> </tr> <tr> <td>Subsequent Conversions</td> <td>Medium</td> <td>Batch process</td> </tr> <tr> <td>DST Transitions</td> <td>Variable</td> <td>Pre-calculate transitions</td> </tr> </tbody> </table> <h3 id=4-thread-safety>4. Thread Safety<a class=headerlink href=#4-thread-safety title="Permanent link">&para;</a></h3> <pre class=mermaid><code>classDiagram
    class time_zone {
        &lt;&lt;singleton&gt;&gt;
        +static const time_zone* locate_zone(string_view)
        +static const time_zone* current_zone()
    }

    class zoned_time {
        -const time_zone* zone_
        -sys_time time_
        +zoned_time()
        +zoned_time(const time_zone*, const sys_time&amp;)
    }

    time_zone &lt;|-- zoned_time</code></pre> <ul> <li><code>time_zone</code> lookups are thread-safe after program startup</li> <li><code>zoned_time</code> objects are immutable and thread-safe for concurrent reads</li> <li>For write operations, use synchronization primitives</li> </ul> <h2 id=string-operations>String Operations<a class=headerlink href=#string-operations title="Permanent link">&para;</a></h2> <pre class=mermaid><code>pie
    title String Operation Costs
    "Allocation" : 45
    "Formatting" : 35
    "Parsing" : 20</code></pre> <p>String operations can be a significant bottleneck in time-related code. Here's how to optimize them:</p> <h3 id=1-avoid-formatting-in-tight-loops>1. Avoid Formatting in Tight Loops<a class=headerlink href=#1-avoid-formatting-in-tight-loops title="Permanent link">&para;</a></h3> <h4 id=inefficient-multiple-allocations>❌ Inefficient - Multiple Allocations<a class=headerlink href=#inefficient-multiple-allocations title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Loop Start] --&gt; B[Allocate String]
    B --&gt; C[Format to String]
    C --&gt; D[Process String]
    D --&gt; E[Deallocate String]
    E --&gt; F[Next Iteration]
    F --&gt; B</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>tp</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>time_points</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=w>    </span><span class=c1>// New allocation on each iteration!</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>formatted</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>format</span><span class=p>(</span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=w>    </span><span class=n>process</span><span class=p>(</span><span class=n>formatted</span><span class=p>);</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=p>}</span>
</span></code></pre></div> <h4 id=better-reuse-buffer>✅ Better - Reuse Buffer<a class=headerlink href=#better-reuse-buffer title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Allocate Buffer] --&gt; B[Loop Start]
    B --&gt; C[Clear Buffer]
    C --&gt; D[Format to Buffer]
    D --&gt; E[Process Buffer]
    E --&gt; F[Next Iteration]
    F --&gt; C</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>buffer</span><span class=p>;</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=c1>// Pre-allocate to avoid reallocations</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>buffer</span><span class=p>.</span><span class=n>reserve</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span><span class=w>  </span><span class=c1>// Sufficient for most date-time formats</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>tp</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>time_points</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=w>    </span><span class=n>buffer</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=w>    </span><span class=c1>// Reuse the same buffer</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=w>    </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>format_to</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>back_inserter</span><span class=p>(</span><span class=n>buffer</span><span class=p>),</span><span class=w> </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>    </span><span class=n>process</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a><span class=p>}</span>
</span></code></pre></div> <h3 id=2-use-string-views-for-parsing>2. Use String Views for Parsing<a class=headerlink href=#2-use-string-views-for-parsing title="Permanent link">&para;</a></h3> <p>Avoid unnecessary string copies by using <code>std::string_view</code>:</p> <pre class=mermaid><code>classDiagram
    class string_view {
        +size_t size()
        +const char* data()
        +string_view substr()
    }

    class string {
        +string(const char*)
        +const char* c_str()
    }

    string_view &lt;|-- string</code></pre> <h4 id=implementation_1>Implementation<a class=headerlink href=#implementation_1 title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=n>std</span><span class=o>::</span><span class=n>optional</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=o>&gt;</span><span class=w> </span><span class=n>parse_timestamp</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string_view</span><span class=w> </span><span class=n>str</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=w>    </span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=w> </span><span class=n>tp</span><span class=p>;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>istringstream</span><span class=w> </span><span class=n>ss</span><span class=p>{</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=n>str</span><span class=p>)};</span><span class=w>  </span><span class=c1>// One allocation</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=w>    </span><span class=n>ss</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>parse</span><span class=p>(</span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>ss</span><span class=p>.</span><span class=n>fail</span><span class=p>())</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>nullopt</span><span class=p>;</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>tp</span><span class=p>;</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=p>}</span>
</span></code></pre></div> <h3 id=3-performance-comparison>3. Performance Comparison<a class=headerlink href=#3-performance-comparison title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Operation</th> <th>Time (ms)</th> <th>Relative</th> </tr> </thead> <tbody> <tr> <td>Naive Formatting</td> <td>100</td> <td>1.0x</td> </tr> <tr> <td>Reused Buffer</td> <td>35</td> <td>2.9x</td> </tr> <tr> <td>String View Parsing</td> <td>25</td> <td>4.0x</td> </tr> <tr> <td>Cached Format String</td> <td>15</td> <td>6.7x</td> </tr> </tbody> </table> <h3 id=4-format-string-optimization>4. Format String Optimization<a class=headerlink href=#4-format-string-optimization title="Permanent link">&para;</a></h3> <p>Pre-compile format strings when possible:</p> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1>// Compile-time format string</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>fmt_string</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>;</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=c1>// At usage:</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=n>chronovyan</span><span class=o>::</span><span class=n>format_to</span><span class=p>(</span><span class=n>back_inserter</span><span class=p>(</span><span class=n>buffer</span><span class=p>),</span><span class=w> </span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>                     </span><span class=n>fmt_string</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>                     </span><span class=n>time_point</span><span class=p>);</span>
</span></code></pre></div> <h3 id=5-memory-allocation-strategies>5. Memory Allocation Strategies<a class=headerlink href=#5-memory-allocation-strategies title="Permanent link">&para;</a></h3> <pre class=mermaid><code>gantt
    title Memory Allocation Strategies
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Multiple Allocations
    Alloc 1 :a1, 0s, 1s
    Alloc 2 :a2, after a1, 1s
    Alloc 3 :a3, after a2, 1s

    section Single Allocation
    Large Alloc :b1, 0s, 1s
    Reuse       :b2, after b1, 2s</code></pre> <ul> <li><strong>Avoid</strong> multiple small allocations in performance-critical code</li> <li><strong>Pre-allocate</strong> buffers when the maximum size is known</li> <li><strong>Reserve</strong> capacity for containers when the size is predictable</li> </ul> <h2 id=memory-management>Memory Management<a class=headerlink href=#memory-management title="Permanent link">&para;</a></h2> <p>Efficient memory management is crucial for high-performance time handling. Here are some key strategies:</p> <h3 id=avoid-unnecessary-copies>Avoid Unnecessary Copies<a class=headerlink href=#avoid-unnecessary-copies title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1>// ❌ Inefficient: Creates multiple string copies</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=nf>format_time</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;&amp;</span><span class=w> </span><span class=n>tp</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>tm</span><span class=w> </span><span class=n>tm</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>*</span><span class=n>std</span><span class=o>::</span><span class=n>localtime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>t</span><span class=p>);</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>ostringstream</span><span class=w> </span><span class=n>ss</span><span class=p>;</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>    </span><span class=n>ss</span><span class=w> </span><span class=o>&lt;&lt;</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>put_time</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tm</span><span class=p>,</span><span class=w> </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>);</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>ss</span><span class=p>.</span><span class=n>str</span><span class=p>();</span><span class=w>  </span><span class=c1>// Returns a new string</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=p>}</span>
</span><span id=__span-10-9><a id=__codelineno-10-9 name=__codelineno-10-9 href=#__codelineno-10-9></a>
</span><span id=__span-10-10><a id=__codelineno-10-10 name=__codelineno-10-10 href=#__codelineno-10-10></a><span class=c1>// ✅ More efficient: Use string views and pre-allocate</span>
</span><span id=__span-10-11><a id=__codelineno-10-11 name=__codelineno-10-11 href=#__codelineno-10-11></a><span class=kt>void</span><span class=w> </span><span class=nf>format_time_to</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;&amp;</span><span class=w> </span><span class=n>tp</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=w> </span><span class=n>out</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-10-12><a id=__codelineno-10-12 name=__codelineno-10-12 href=#__codelineno-10-12></a><span class=w>    </span><span class=k>thread_local</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>tm</span><span class=w> </span><span class=n>tm</span><span class=p>;</span>
</span><span id=__span-10-13><a id=__codelineno-10-13 name=__codelineno-10-13 href=#__codelineno-10-13></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-10-14><a id=__codelineno-10-14 name=__codelineno-10-14 href=#__codelineno-10-14></a><span class=w>    </span><span class=n>localtime_r</span><span class=p>(</span><span class=o>&amp;</span><span class=n>t</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>tm</span><span class=p>);</span><span class=w>  </span><span class=c1>// Thread-safe version</span>
</span><span id=__span-10-15><a id=__codelineno-10-15 name=__codelineno-10-15 href=#__codelineno-10-15></a>
</span><span id=__span-10-16><a id=__codelineno-10-16 name=__codelineno-10-16 href=#__codelineno-10-16></a><span class=w>    </span><span class=n>out</span><span class=p>.</span><span class=n>resize</span><span class=p>(</span><span class=mi>20</span><span class=p>);</span><span class=w>  </span><span class=c1>// Pre-allocate sufficient space</span>
</span><span id=__span-10-17><a id=__codelineno-10-17 name=__codelineno-10-17 href=#__codelineno-10-17></a><span class=w>    </span><span class=n>strftime</span><span class=p>(</span><span class=n>out</span><span class=p>.</span><span class=n>data</span><span class=p>(),</span><span class=w> </span><span class=n>out</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span><span class=w> </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>tm</span><span class=p>);</span>
</span><span id=__span-10-18><a id=__codelineno-10-18 name=__codelineno-10-18 href=#__codelineno-10-18></a><span class=p>}</span>
</span></code></pre></div> <h3 id=use-stack-allocation-when-possible>Use Stack Allocation When Possible<a class=headerlink href=#use-stack-allocation-when-possible title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1>// Stack allocation is faster than heap allocation</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=kt>void</span><span class=w> </span><span class=nf>process_timestamp</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;&amp;</span><span class=w> </span><span class=n>tp</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>buffer</span><span class=p>[</span><span class=mi>64</span><span class=p>];</span><span class=w>  </span><span class=c1>// Stack-allocated buffer</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>strftime</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>buffer</span><span class=p>),</span><span class=w> </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>localtime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>t</span><span class=p>));</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a><span class=w>    </span><span class=c1>// Use buffer...</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=p>}</span>
</span></code></pre></div> <h3 id=smart-pointers-for-resource-management>Smart Pointers for Resource Management<a class=headerlink href=#smart-pointers-for-resource-management title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1>// Use unique_ptr for exclusive ownership of time zone data</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=k>struct</span><span class=w> </span><span class=nc>TimeZoneCache</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>time_zone</span><span class=o>&gt;</span><span class=w> </span><span class=n>tz</span><span class=p>;</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=p>};</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=c1>// Use shared_ptr for shared ownership when needed</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=k>auto</span><span class=w> </span><span class=n>create_shared_time_zone</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>time_zone</span><span class=o>&gt;</span><span class=p>(</span><span class=cm>/* ... */</span><span class=p>);</span>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=p>}</span>
</span></code></pre></div> <h3 id=memory-pools-for-frequent-allocations>Memory Pools for Frequent Allocations<a class=headerlink href=#memory-pools-for-frequent-allocations title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=c1>// Use a memory pool for frequent small allocations</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=k>class</span><span class=w> </span><span class=nc>TimePointPool</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>unique_ptr</span><span class=o>&lt;</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;&gt;&gt;</span><span class=w> </span><span class=n>pool_</span><span class=p>;</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=k>public</span><span class=o>:</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>    </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;*</span><span class=w> </span><span class=n>acquire</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>pool_</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>            </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;</span><span class=p>();</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>ptr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>pool_</span><span class=p>.</span><span class=n>back</span><span class=p>());</span>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>        </span><span class=n>pool_</span><span class=p>.</span><span class=n>pop_back</span><span class=p>();</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>ptr</span><span class=p>.</span><span class=n>release</span><span class=p>();</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>release</span><span class=p>(</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;*</span><span class=w> </span><span class=n>tp</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>        </span><span class=n>pool_</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=p>};</span>
</span></code></pre></div> <h3 id=memory-layout-optimization>Memory Layout Optimization<a class=headerlink href=#memory-layout-optimization title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1>// Optimize memory layout for temporal data</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=k>struct</span><span class=w> </span><span class=nc>TemporalData</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a><span class=w>    </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;</span><span class=w> </span><span class=n>timestamp</span><span class=p>;</span><span class=w>  </span><span class=c1>// 8 bytes</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=w>    </span><span class=kt>double</span><span class=w> </span><span class=n>value</span><span class=p>;</span><span class=w>                        </span><span class=c1>// 8 bytes</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=w>    </span><span class=c1>// Total: 16 bytes (good for cache lines)</span>
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a><span class=p>};</span>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a><span class=c1>// Avoid padding and cache line issues</span>
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a><span class=k>struct</span><span class=w> </span><span class=nc>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w> </span><span class=n>CacheAlignedTemporalData</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=w>    </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;</span><span class=w> </span><span class=n>timestamp</span><span class=p>;</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a><span class=w>    </span><span class=kt>double</span><span class=w> </span><span class=n>value</span><span class=p>;</span>
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>padding</span><span class=p>[</span><span class=mi>64</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;</span><span class=p>)</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=kt>double</span><span class=p>)];</span>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=p>};</span>
</span></code></pre></div> <h3 id=memory-mapped-files-for-large-datasets>Memory-Mapped Files for Large Datasets<a class=headerlink href=#memory-mapped-files-for-large-datasets title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;boost/interprocess/file_mapping.hpp&gt;</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;boost/interprocess/mapped_region.hpp&gt;</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=kt>void</span><span class=w> </span><span class=nf>process_large_temporal_data</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=w> </span><span class=n>filename</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=k>using</span><span class=w> </span><span class=k>namespace</span><span class=w> </span><span class=nn>boost</span><span class=o>::</span><span class=nn>interprocess</span><span class=p>;</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span><span class=c1>// Map the file to memory</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>    </span><span class=n>file_mapping</span><span class=w> </span><span class=nf>m_file</span><span class=p>(</span><span class=n>filename</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span><span class=w> </span><span class=n>read_only</span><span class=p>);</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>    </span><span class=n>mapped_region</span><span class=w> </span><span class=nf>region</span><span class=p>(</span><span class=n>m_file</span><span class=p>,</span><span class=w> </span><span class=n>read_only</span><span class=p>);</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>    </span><span class=c1>// Access the data directly</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>*</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>static_cast</span><span class=o>&lt;</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=o>*&gt;</span><span class=p>(</span><span class=n>region</span><span class=p>.</span><span class=n>get_address</span><span class=p>());</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>region</span><span class=p>.</span><span class=n>get_size</span><span class=p>();</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=w>    </span><span class=c1>// Process the memory-mapped data...</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a><span class=p>}</span>
</span></code></pre></div> <h3 id=custom-allocators>Custom Allocators<a class=headerlink href=#custom-allocators title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=k>template</span><span class=w> </span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>T</span><span class=o>&gt;</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=k>class</span><span class=w> </span><span class=nc>TemporalAllocator</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=w>    </span><span class=c1>// Implementation of a custom allocator optimized for temporal data</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=w>    </span><span class=c1>// with specific alignment and allocation patterns</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=p>};</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=c1>// Usage</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=k>using</span><span class=w> </span><span class=n>TemporalVector</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;</span><span class=p>,</span><span class=w> </span><span class=n>TemporalAllocator</span><span class=o>&lt;</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;&gt;&gt;</span><span class=p>;</span>
</span></code></pre></div> <h3 id=memory-leak-detection>Memory Leak Detection<a class=headerlink href=#memory-leak-detection title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=c1>// Use tools like Valgrind, AddressSanitizer, or custom tracking</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=cp>#ifdef _DEBUG</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=cp>#define TRACK_ALLOCATIONS</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=cp>#endif</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=cp>#ifdef TRACK_ALLOCATIONS</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=k>struct</span><span class=w> </span><span class=nc>AllocationTracker</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>size_t</span><span class=o>&gt;</span><span class=w> </span><span class=n>allocations</span><span class=p>;</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>size_t</span><span class=o>&gt;</span><span class=w> </span><span class=n>deallocations</span><span class=p>;</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=nf>allocate</span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>size</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>        </span><span class=o>++</span><span class=n>allocations</span><span class=p>;</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>malloc</span><span class=p>(</span><span class=n>size</span><span class=p>);</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a><span class=w>    </span><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>deallocate</span><span class=p>(</span><span class=kt>void</span><span class=o>*</span><span class=w> </span><span class=n>ptr</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>        </span><span class=o>++</span><span class=n>deallocations</span><span class=p>;</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>free</span><span class=p>(</span><span class=n>ptr</span><span class=p>);</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=p>};</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>size_t</span><span class=o>&gt;</span><span class=w> </span><span class=n>AllocationTracker</span><span class=o>::</span><span class=n>allocations</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>size_t</span><span class=o>&gt;</span><span class=w> </span><span class=n>AllocationTracker</span><span class=o>::</span><span class=n>deallocations</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=cp>#endif</span>
</span></code></pre></div> <h2 id=duration-types>Duration Types<a class=headerlink href=#duration-types title="Permanent link">&para;</a></h2> <pre class=mermaid><code>pie
    title Duration Type Usage
    "seconds" : 40
    "milliseconds" : 30
    "microseconds" : 15
    "nanoseconds" : 10
    "minutes" : 3
    "hours" : 2</code></pre> <h3 id=duration-type-selection-guide>Duration Type Selection Guide<a class=headerlink href=#duration-type-selection-guide title="Permanent link">&para;</a></h3> <pre class=mermaid><code>flowchart TD
    A[Need Sub-millisecond?] --&gt;|Yes| B[Use nanoseconds/microseconds]
    A --&gt;|No| C[Human-readable?]
    C --&gt;|Yes| D[Use seconds/minutes/hours]
    C --&gt;|No| E[Need exact ms?]
    E --&gt;|Yes| F[Use milliseconds]
    E --&gt;|No| G[Use seconds]</code></pre> <h3 id=duration-type-comparison>Duration Type Comparison<a class=headerlink href=#duration-type-comparison title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Type</th> <th>Precision</th> <th>Range</th> <th>Memory</th> <th>Performance</th> <th>Best For</th> </tr> </thead> <tbody> <tr> <td><code>nanoseconds</code></td> <td>1ns</td> <td>±292 years</td> <td>8 bytes</td> <td>⚡⚡⚡</td> <td>High-precision timing, benchmarks</td> </tr> <tr> <td><code>microseconds</code></td> <td>1µs</td> <td>±292,000 years</td> <td>8 bytes</td> <td>⚡⚡⚡</td> <td>General timing, I/O operations</td> </tr> <tr> <td><code>milliseconds</code></td> <td>1ms</td> <td>±292M years</td> <td>8 bytes</td> <td>⚡⚡</td> <td>UI updates, networking timeouts</td> </tr> <tr> <td><code>seconds</code></td> <td>1s</td> <td>±292B years</td> <td>8 bytes</td> <td>⚡</td> <td>General purpose, timestamps</td> </tr> <tr> <td><code>minutes</code></td> <td>1min</td> <td>±5.5e18 years</td> <td>8 bytes</td> <td>⚡</td> <td>Human intervals, scheduling</td> </tr> <tr> <td><code>hours</code></td> <td>1h</td> <td>±3.3e17 years</td> <td>8 bytes</td> <td>⚡</td> <td>Long durations, calendar events</td> </tr> </tbody> </table> <h3 id=memory-layout>Memory Layout<a class=headerlink href=#memory-layout title="Permanent link">&para;</a></h3> <pre class=mermaid><code>classDiagram
    class duration {
        +rep_ count_
        +period period_
        +rep count()
        +static duration zero()
        +duration operator+()
        +duration operator-()
    }

    duration &lt;|-- seconds
    duration &lt;|-- milliseconds
    duration &lt;|-- microseconds
    duration &lt;|-- nanoseconds
    duration &lt;|-- minutes
    duration &lt;|-- hours</code></pre> <h3 id=example-usage_1>Example Usage<a class=headerlink href=#example-usage_1 title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1>// High-precision timing</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=k>auto</span><span class=w> </span><span class=n>start</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=c1>// ... operation ...</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=k>auto</span><span class=w> </span><span class=n>end</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=k>auto</span><span class=w> </span><span class=n>ns</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>duration_cast</span><span class=o>&lt;</span><span class=n>chronovyan</span><span class=o>::</span><span class=n>nanoseconds</span><span class=o>&gt;</span><span class=p>(</span><span class=n>end</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start</span><span class=p>);</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=c1>// Network timeout (human-readable)</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>timeout</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>500</span><span class=n>ms</span><span class=p>;</span><span class=w>  </span><span class=c1>// More readable than 0.5s or 500&#39;000µs</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=c1>// Calendar event</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=k>auto</span><span class=w> </span><span class=n>meeting_duration</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=n>h</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>30</span><span class=n>min</span><span class=p>;</span><span class=w>  </span><span class=c1>// Self-documenting</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=c1>// Frame timing (60 FPS)</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>frame_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>16.666</span><span class=n>ms</span><span class=p>;</span><span class=w>  </span><span class=c1>// 1/60 second</span>
</span></code></pre></div> <h3 id=performance-considerations>Performance Considerations<a class=headerlink href=#performance-considerations title="Permanent link">&para;</a></h3> <pre class=mermaid><code>gantt
    title Duration Conversion Overhead
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section No Conversion
    Operation :a1, 0s, 1s

    section With Conversion
    Convert :b1, 0s, 1s
    Operation :b2, after b1, 1s</code></pre> <ul> <li><strong>Prefer</strong> using the natural duration type for your operations</li> <li><strong>Avoid</strong> unnecessary <code>duration_cast</code> operations</li> <li><strong>Use</strong> floating-point durations for division/multiplication when exact precision isn't critical</li> <li><strong>Consider</strong> integer durations for exact arithmetic and comparisons</li> </ul> <h3 id=common-pitfalls>Common Pitfalls<a class=headerlink href=#common-pitfalls title="Permanent link">&para;</a></h3> <ol> <li> <p><strong>Mixing Duration Types</strong> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=c1>// ❌ Error: Can&#39;t add different duration types</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=k>auto</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=n>s</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>500</span><span class=n>ms</span><span class=p>;</span><span class=w>  </span><span class=c1>// Error</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a><span class=c1>// ✅ Correct: Explicit conversion</span>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=k>auto</span><span class=w> </span><span class=n>total</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=n>s</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>chrono</span><span class=o>::</span><span class=n>duration_cast</span><span class=o>&lt;</span><span class=n>seconds</span><span class=o>&gt;</span><span class=p>(</span><span class=mi>500</span><span class=n>ms</span><span class=p>);</span>
</span></code></pre></div></p> </li> <li> <p><strong>Loss of Precision</strong> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=c1>// ❌ Loses sub-second precision</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>seconds</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1500</span><span class=n>ms</span><span class=p>;</span><span class=w>  </span><span class=c1>// s.count() == 1</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=c1>// ✅ Preserves precision</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=k>auto</span><span class=w> </span><span class=n>ms</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1500</span><span class=n>ms</span><span class=p>;</span><span class=w>    </span><span class=c1>// 1.5 seconds exactly</span>
</span></code></pre></div></p> </li> <li> <p><strong>Floating-point Durations</strong> ```cpp // Good for calculations requiring division using fsec = duration<double>;</p> </li> </ol> <p>std::sort(time_series.begin(), time_series.end());</p> <p>// For lookups by time std::map<time_point\&lt;system_clock>, Event> events; auto it = events.lower_bound(some_time); <div class="language-text highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a>### 6. Memory Pooling
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>For high-frequency time point allocations:
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>```cpp
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>class TimePointPool {
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>    std::vector&lt;std::unique_ptr&lt;time_point&lt;system_clock&gt;&gt;&gt; pool_;
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>public:
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>    time_point&lt;system_clock&gt;* acquire() {
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>        if (pool_.empty()) {
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>            return new time_point&lt;system_clock&gt;();
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>        }
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a>        auto ptr = std::move(pool_.back());
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>        pool_.pop_back();
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a>        return ptr.release();
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a>    }
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>    void release(time_point&lt;system_clock&gt;* tp) {
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a>        pool_.push_back(std::unique_ptr&lt;time_point&lt;system_clock&gt;&gt;(tp));
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a>    }
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a>};
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a>## Thread Safety
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a>
</span><span id=__span-21-26><a id=__codelineno-21-26 name=__codelineno-21-26 href=#__codelineno-21-26></a>```mermaid
</span><span id=__span-21-27><a id=__codelineno-21-27 name=__codelineno-21-27 href=#__codelineno-21-27></a>pie
</span><span id=__span-21-28><a id=__codelineno-21-28 name=__codelineno-21-28 href=#__codelineno-21-28></a>    title Thread Safety Concerns
</span><span id=__span-21-29><a id=__codelineno-21-29 name=__codelineno-21-29 href=#__codelineno-21-29></a>    &quot;Race Conditions&quot; : 45
</span><span id=__span-21-30><a id=__codelineno-21-30 name=__codelineno-21-30 href=#__codelineno-21-30></a>    &quot;Deadlocks&quot; : 25
</span><span id=__span-21-31><a id=__codelineno-21-31 name=__codelineno-21-31 href=#__codelineno-21-31></a>    &quot;False Sharing&quot; : 20
</span><span id=__span-21-32><a id=__codelineno-21-32 name=__codelineno-21-32 href=#__codelineno-21-32></a>    &quot;Cache Invalidation&quot; : 10
</span></code></pre></div></p> <h3 id=1-thread-local-caching>1. Thread-Local Caching<a class=headerlink href=#1-thread-local-caching title="Permanent link">&para;</a></h3> <h4 id=inefficient-global-cache-with-locks>❌ Inefficient - Global Cache with Locks<a class=headerlink href=#inefficient-global-cache-with-locks title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Thread 1] --&gt;|Lock| B[Global Cache]
    C[Thread 2] --&gt;|Wait| B
    D[Thread 3] --&gt;|Wait| B</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1>// Global cache with mutex protection</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=n>std</span><span class=o>::</span><span class=n>mutex</span><span class=w> </span><span class=n>cache_mutex</span><span class=p>;</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*&gt;</span><span class=w> </span><span class=n>global_cache</span><span class=p>;</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*</span><span class=w> </span><span class=nf>get_time_zone_slow</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>lock_guard</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>mutex</span><span class=o>&gt;</span><span class=w> </span><span class=n>lock</span><span class=p>(</span><span class=n>cache_mutex</span><span class=p>);</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>global_cache</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>name</span><span class=p>);</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>it</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>global_cache</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>        </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>global_cache</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>locate_zone</span><span class=p>(</span><span class=n>name</span><span class=p>)).</span><span class=n>first</span><span class=p>;</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>it</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>;</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a><span class=p>}</span>
</span></code></pre></div> <h4 id=better-thread-local-storage>✅ Better - Thread-Local Storage<a class=headerlink href=#better-thread-local-storage title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Thread 1] --&gt; B[Thread 1 Cache]
    C[Thread 2] --&gt; D[Thread 2 Cache]
    E[Thread 3] --&gt; F[Thread 3 Cache]</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1>// Each thread gets its own cache</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*</span><span class=w> </span><span class=nf>get_cached_time_zone</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=w>    </span><span class=k>thread_local</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*&gt;</span><span class=w> </span><span class=n>cache</span><span class=p>;</span>
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cache</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>name</span><span class=p>);</span>
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>it</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>cache</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=w>        </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cache</span><span class=p>.</span><span class=n>emplace</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>locate_zone</span><span class=p>(</span><span class=n>name</span><span class=p>)).</span><span class=n>first</span><span class=p>;</span>
</span><span id=__span-23-8><a id=__codelineno-23-8 name=__codelineno-23-8 href=#__codelineno-23-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-23-9><a id=__codelineno-23-9 name=__codelineno-23-9 href=#__codelineno-23-9></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>it</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>;</span>
</span><span id=__span-23-10><a id=__codelineno-23-10 name=__codelineno-23-10 href=#__codelineno-23-10></a><span class=p>}</span>
</span></code></pre></div> <h3 id=2-immutable-time-objects>2. Immutable Time Objects<a class=headerlink href=#2-immutable-time-objects title="Permanent link">&para;</a></h3> <pre class=mermaid><code>classDiagram
    class time_point {
        +duration time_since_epoch()
        +time_point&amp; operator+=(const duration&amp;)
        +static time_point min()
        +static time_point max()
    }

    class zoned_time {
        -const time_zone* zone_
        -sys_time time_
        +zoned_time()
        +zoned_time(const time_zone*, const sys_time&amp;)
        +sys_time get_sys_time()
        +local_time get_local_time()
    }

    time_point &lt;|-- zoned_time</code></pre> <ul> <li><code>time_point</code> and <code>zoned_time</code> are thread-safe for concurrent reads</li> <li>No synchronization needed for const operations</li> <li>For modifications, external synchronization is required</li> </ul> <h3 id=3-thread-safety-patterns>3. Thread Safety Patterns<a class=headerlink href=#3-thread-safety-patterns title="Permanent link">&para;</a></h3> <h4 id=read-copy-update-rcu>Read-Copy-Update (RCU)<a class=headerlink href=#read-copy-update-rcu title="Permanent link">&para;</a></h4> <pre class=mermaid><code>sequenceDiagram
    participant Reader1
    participant Reader2
    participant Writer
    participant Data

    Reader1-&gt;&gt;Data: Read (no lock)
    Reader2-&gt;&gt;Data: Read (no lock)
    Writer-&gt;&gt;Data: Create new copy
    Writer-&gt;&gt;Data: Atomic swap
    Reader1-&gt;&gt;Data: Read new version</code></pre> <h4 id=implementation-with-stdshared_ptr>Implementation with <code>std::shared_ptr</code><a class=headerlink href=#implementation-with-stdshared_ptr title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>class</span><span class=w> </span><span class=nc>TimeZoneCache</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*&gt;&gt;</span><span class=w> </span><span class=n>cache_</span><span class=p>;</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=k>public</span><span class=o>:</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=w>    </span><span class=n>TimeZoneCache</span><span class=p>()</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>cache_</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*&gt;&gt;</span><span class=p>())</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>update</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>new_cache</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>make_shared</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*&gt;&gt;</span><span class=p>(</span><span class=o>*</span><span class=n>cache_</span><span class=p>);</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=w>        </span><span class=c1>// Update new_cache...</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>atomic_store</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cache_</span><span class=p>,</span><span class=w> </span><span class=n>new_cache</span><span class=p>);</span>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*</span><span class=w> </span><span class=n>get</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>cache</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>atomic_load</span><span class=p>(</span><span class=o>&amp;</span><span class=n>cache_</span><span class=p>);</span>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cache</span><span class=o>-&gt;</span><span class=n>find</span><span class=p>(</span><span class=n>name</span><span class=p>);</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>cache</span><span class=o>-&gt;</span><span class=n>end</span><span class=p>()</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=n>it</span><span class=o>-&gt;</span><span class=n>second</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=k>nullptr</span><span class=p>;</span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-24-18><a id=__codelineno-24-18 name=__codelineno-24-18 href=#__codelineno-24-18></a><span class=p>};</span>
</span></code></pre></div> <h3 id=4-false-sharing-prevention>4. False Sharing Prevention<a class=headerlink href=#4-false-sharing-prevention title="Permanent link">&para;</a></h3> <pre class=mermaid><code>gantt
    title False Sharing Impact
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section With False Sharing
    Thread 1 :a1, 0s, 2s
    Thread 2 :a2, 0s, 2s

    section Without False Sharing
    Thread 1 :b1, 3s, 1s
    Thread 2 :b2, 3s, 1s</code></pre> <h4 id=cache-line-alignment>Cache Line Alignment<a class=headerlink href=#cache-line-alignment title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=k>struct</span><span class=w> </span><span class=nc>alignas</span><span class=p>(</span><span class=mi>64</span><span class=p>)</span><span class=w> </span><span class=n>PaddedCounter</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=w> </span><span class=n>counter</span><span class=p>;</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>    </span><span class=kt>char</span><span class=w> </span><span class=n>padding</span><span class=p>[</span><span class=mi>64</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=k>sizeof</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>atomic</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>)];</span><span class=w>  </span><span class=c1>// Pad to cache line size</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=p>};</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=c1>// Array of counters, each on its own cache line</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=n>PaddedCounter</span><span class=w> </span><span class=n>counters</span><span class=p>[</span><span class=n>std</span><span class=o>::</span><span class=kr>thread</span><span class=o>::</span><span class=n>hardware_concurrency</span><span class=p>()];</span>
</span></code></pre></div> <h3 id=5-thread-safe-factory-pattern>5. Thread-Safe Factory Pattern<a class=headerlink href=#5-thread-safe-factory-pattern title="Permanent link">&para;</a></h3> <pre class=mermaid><code>flowchart TD
    A[Get Time Zone] --&gt; B{In Cache?}
    B --&gt;|Yes| C[Return Cached]
    B --&gt;|No| D[Create New]
    D --&gt; E[Add to Cache]
    E --&gt; C</code></pre> <h4 id=implementation_2>Implementation<a class=headerlink href=#implementation_2 title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=k>class</span><span class=w> </span><span class=nc>TimeZoneFactory</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=w>    </span><span class=k>mutable</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>mutex</span><span class=w> </span><span class=n>mutex_</span><span class=p>;</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>unordered_map</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>weak_ptr</span><span class=o>&lt;</span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>cache_</span><span class=p>;</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=k>public</span><span class=o>:</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>&gt;</span><span class=w> </span><span class=n>get_time_zone</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&amp;</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>lock_guard</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>mutex</span><span class=o>&gt;</span><span class=w> </span><span class=n>lock</span><span class=p>(</span><span class=n>mutex_</span><span class=p>);</span>
</span><span id=__span-26-8><a id=__codelineno-26-8 name=__codelineno-26-8 href=#__codelineno-26-8></a>
</span><span id=__span-26-9><a id=__codelineno-26-9 name=__codelineno-26-9 href=#__codelineno-26-9></a><span class=w>        </span><span class=c1>// Check if we have a valid entry in cache</span>
</span><span id=__span-26-10><a id=__codelineno-26-10 name=__codelineno-26-10 href=#__codelineno-26-10></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cache_</span><span class=p>.</span><span class=n>find</span><span class=p>(</span><span class=n>name</span><span class=p>);</span><span class=w> </span><span class=n>it</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>cache_</span><span class=p>.</span><span class=n>end</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-11><a id=__codelineno-26-11 name=__codelineno-26-11 href=#__codelineno-26-11></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>sp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>it</span><span class=o>-&gt;</span><span class=n>second</span><span class=p>.</span><span class=n>lock</span><span class=p>())</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-12><a id=__codelineno-26-12 name=__codelineno-26-12 href=#__codelineno-26-12></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>sp</span><span class=p>;</span><span class=w>  </span><span class=c1>// Return existing shared_ptr</span>
</span><span id=__span-26-13><a id=__codelineno-26-13 name=__codelineno-26-13 href=#__codelineno-26-13></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-26-14><a id=__codelineno-26-14 name=__codelineno-26-14 href=#__codelineno-26-14></a><span class=w>            </span><span class=c1>// Entry exists but expired, remove it</span>
</span><span id=__span-26-15><a id=__codelineno-26-15 name=__codelineno-26-15 href=#__codelineno-26-15></a><span class=w>            </span><span class=n>cache_</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>it</span><span class=p>);</span>
</span><span id=__span-26-16><a id=__codelineno-26-16 name=__codelineno-26-16 href=#__codelineno-26-16></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-26-17><a id=__codelineno-26-17 name=__codelineno-26-17 href=#__codelineno-26-17></a>
</span><span id=__span-26-18><a id=__codelineno-26-18 name=__codelineno-26-18 href=#__codelineno-26-18></a><span class=w>        </span><span class=c1>// Create new entry</span>
</span><span id=__span-26-19><a id=__codelineno-26-19 name=__codelineno-26-19 href=#__codelineno-26-19></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>tz</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>shared_ptr</span><span class=o>&lt;</span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>&gt;</span><span class=p>(</span>
</span><span id=__span-26-20><a id=__codelineno-26-20 name=__codelineno-26-20 href=#__codelineno-26-20></a><span class=w>            </span><span class=n>locate_zone</span><span class=p>(</span><span class=n>name</span><span class=p>),</span>
</span><span id=__span-26-21><a id=__codelineno-26-21 name=__codelineno-26-21 href=#__codelineno-26-21></a><span class=w>            </span><span class=p>[</span><span class=k>this</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>](</span><span class=k>const</span><span class=w> </span><span class=n>time_zone</span><span class=o>*</span><span class=w> </span><span class=n>tz</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-26-22><a id=__codelineno-26-22 name=__codelineno-26-22 href=#__codelineno-26-22></a><span class=w>                </span><span class=n>std</span><span class=o>::</span><span class=n>lock_guard</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>mutex</span><span class=o>&gt;</span><span class=w> </span><span class=n>lock</span><span class=p>(</span><span class=n>mutex_</span><span class=p>);</span>
</span><span id=__span-26-23><a id=__codelineno-26-23 name=__codelineno-26-23 href=#__codelineno-26-23></a><span class=w>                </span><span class=n>cache_</span><span class=p>.</span><span class=n>erase</span><span class=p>(</span><span class=n>name</span><span class=p>);</span>
</span><span id=__span-26-24><a id=__codelineno-26-24 name=__codelineno-26-24 href=#__codelineno-26-24></a><span class=w>                </span><span class=k>delete</span><span class=w> </span><span class=n>tz</span><span class=p>;</span>
</span><span id=__span-26-25><a id=__codelineno-26-25 name=__codelineno-26-25 href=#__codelineno-26-25></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-26-26><a id=__codelineno-26-26 name=__codelineno-26-26 href=#__codelineno-26-26></a><span class=w>        </span><span class=p>);</span>
</span><span id=__span-26-27><a id=__codelineno-26-27 name=__codelineno-26-27 href=#__codelineno-26-27></a>
</span><span id=__span-26-28><a id=__codelineno-26-28 name=__codelineno-26-28 href=#__codelineno-26-28></a><span class=w>        </span><span class=n>cache_</span><span class=p>[</span><span class=n>name</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tz</span><span class=p>;</span>
</span><span id=__span-26-29><a id=__codelineno-26-29 name=__codelineno-26-29 href=#__codelineno-26-29></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>tz</span><span class=p>;</span>
</span><span id=__span-26-30><a id=__codelineno-26-30 name=__codelineno-26-30 href=#__codelineno-26-30></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-26-31><a id=__codelineno-26-31 name=__codelineno-26-31 href=#__codelineno-26-31></a><span class=p>};</span>
</span></code></pre></div> <h2 id=compile-time-optimization>Compile-Time Optimization<a class=headerlink href=#compile-time-optimization title="Permanent link">&para;</a></h2> <pre class=mermaid><code>pie
    title Compile-Time Benefits
    "Faster Runtime" : 40
    "Smaller Binary" : 30
    "Better Optimizations" : 30</code></pre> <h3 id=1-compile-time-calculations>1. Compile-Time Calculations<a class=headerlink href=#1-compile-time-calculations title="Permanent link">&para;</a></h3> <h4 id=runtime-calculation>❌ Runtime Calculation<a class=headerlink href=#runtime-calculation title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Program Start] --&gt; B[Calculate at Runtime]
    B --&gt; C[Use Result]
    C --&gt; D[Program End]</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1>// Calculated every time the function is called</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=k>auto</span><span class=w> </span><span class=n>get_week_later</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=mi>24</span><span class=n>h</span><span class=p>;</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=p>}</span>
</span></code></pre></div> <h4 id=compile-time-calculation>✅ Compile-Time Calculation<a class=headerlink href=#compile-time-calculation title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Compile Time] --&gt; B[Calculate Value]
    C[Runtime] --&gt; D[Use Precomputed Value]</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1>// Compile-time duration calculations</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>one_day</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>24</span><span class=n>h</span><span class=p>;</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>one_week</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>7</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>one_day</span><span class=p>;</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>one_year</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>365</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>one_day</span><span class=p>;</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=c1>// Compile-time time point calculations</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>epoch</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=p>{};</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>year_2000</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>epoch</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>946&#39;684&#39;800</span><span class=n>s</span><span class=p>;</span><span class=w>  </span><span class=c1>// 2000-01-01 00:00:00 UTC</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=c1>// Known at compile time</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>Clock</span><span class=o>&gt;</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>get_week_later</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>Clock</span><span class=o>::</span><span class=n>now</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>one_week</span><span class=p>;</span>
</span><span id=__span-28-14><a id=__codelineno-28-14 name=__codelineno-28-14 href=#__codelineno-28-14></a><span class=p>}</span>
</span></code></pre></div> <h3 id=2-type-aliases-and-constants>2. Type Aliases and Constants<a class=headerlink href=#2-type-aliases-and-constants title="Permanent link">&para;</a></h3> <h4 id=type-aliases>Type Aliases<a class=headerlink href=#type-aliases title="Permanent link">&para;</a></h4> <pre class=mermaid><code>classDiagram
    class duration {
        &lt;&lt;templated&gt;&gt;
        +rep count()
        +static duration zero()
    }

    class time_point {
        &lt;&lt;templated&gt;&gt;
        +duration time_since_epoch()
    }

    duration &lt;|-- seconds
    duration &lt;|-- milliseconds
    time_point &lt;|-- sys_time
    time_point &lt;|-- local_time

    note for time_point "Commonly used aliases:\n- sys_time: System clock time\n- local_time: Local time"</code></pre> <h4 id=common-aliases>Common Aliases<a class=headerlink href=#common-aliases title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1>// Duration types</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=k>using</span><span class=w> </span><span class=n>days</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>86400</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=k>using</span><span class=w> </span><span class=n>weeks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>604800</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=k>using</span><span class=w> </span><span class=n>months</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>2629746</span><span class=o>&gt;&gt;</span><span class=p>;</span><span class=w>  </span><span class=c1>// 30.44 days</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=k>using</span><span class=w> </span><span class=n>years</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>31556952</span><span class=o>&gt;&gt;</span><span class=p>;</span><span class=w>  </span><span class=c1>// 365.24 days</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=c1>// Time point types</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=k>using</span><span class=w> </span><span class=n>sys_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a><span class=k>using</span><span class=w> </span><span class=n>steady_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>steady_clock</span><span class=o>&gt;</span><span class=p>;</span>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=k>using</span><span class=w> </span><span class=n>highres_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>high_resolution_clock</span><span class=o>&gt;</span><span class=p>;</span>
</span></code></pre></div> <h3 id=3-compile-time-string-processing>3. Compile-Time String Processing<a class=headerlink href=#3-compile-time-string-processing title="Permanent link">&para;</a></h3> <h4 id=format-string-validation>Format String Validation<a class=headerlink href=#format-string-validation title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart TD
    A[Compile Time] --&gt; B[Validate Format String]
    B --&gt;|Valid| C[Compile Success]
    B --&gt;|Invalid| D[Compile Error]</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=w> </span><span class=n>Args</span><span class=o>&gt;</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=k>constexpr</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=n>validate_format_string</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>fmt</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>    </span><span class=c1>// Compile-time format string validation</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>    </span><span class=c1>// Will fail to compile if format string is invalid</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=w>    </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>parse</span><span class=p>(</span><span class=n>fmt</span><span class=p>,</span><span class=w> </span><span class=n>Args</span><span class=p>{}...);</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=p>}</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=c1>// Usage:</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=c1>// validate_format_string&lt;year, month, day&gt;(&quot;%Y-%m-%d&quot;);  // OK</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=c1>// validate_format_string&lt;year, month, day&gt;(&quot;%Y-%m&quot;);    // Compile error</span>
</span></code></pre></div> <h3 id=4-compile-time-date-calculations>4. Compile-Time Date Calculations<a class=headerlink href=#4-compile-time-date-calculations title="Permanent link">&para;</a></h3> <h4 id=date-algorithms>Date Algorithms<a class=headerlink href=#date-algorithms title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart LR
    A[Year] --&gt; B{Is Leap Year?}
    B --&gt;|Yes| C[366 Days]
    B --&gt;|No| D[365 Days]</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=k>constexpr</span><span class=w> </span><span class=kt>bool</span><span class=w> </span><span class=nf>is_leap_year</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>4</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>100</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=p>(</span><span class=n>y</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>400</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=p>}</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=k>constexpr</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=nf>days_in_month</span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>y</span><span class=p>,</span><span class=w> </span><span class=kt>unsigned</span><span class=w> </span><span class=n>m</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>m</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>is_leap_year</span><span class=p>(</span><span class=n>y</span><span class=p>)</span><span class=w> </span><span class=o>?</span><span class=w> </span><span class=mi>29</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=mi>28</span><span class=p>;</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>    </span><span class=k>constexpr</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>days</span><span class=p>[]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=mi>31</span><span class=p>,</span><span class=w> </span><span class=mi>28</span><span class=p>,</span><span class=w> </span><span class=mi>31</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>31</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>31</span><span class=p>,</span><span class=w> </span><span class=mi>31</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>31</span><span class=p>,</span><span class=w> </span><span class=mi>30</span><span class=p>,</span><span class=w> </span><span class=mi>31</span><span class=p>};</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>days</span><span class=p>[</span><span class=n>m</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>];</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=p>}</span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=c1>// Compile-time validation</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=k>static_assert</span><span class=p>(</span><span class=n>days_in_month</span><span class=p>(</span><span class=mi>2020</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>29</span><span class=p>,</span><span class=w> </span><span class=s>&quot;2020 was a leap year&quot;</span><span class=p>);</span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=k>static_assert</span><span class=p>(</span><span class=n>days_in_month</span><span class=p>(</span><span class=mi>2021</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>28</span><span class=p>,</span><span class=w> </span><span class=s>&quot;2021 is not a leap year&quot;</span><span class=p>);</span>
</span></code></pre></div> <h3 id=5-compile-time-performance-benefits>5. Compile-Time Performance Benefits<a class=headerlink href=#5-compile-time-performance-benefits title="Permanent link">&para;</a></h3> <pre class=mermaid><code>gantt
    title Runtime vs Compile-Time Calculation
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Runtime
    Calculate :a1, 0s, 5s

    section Compile-Time
    Use Value :b1, 0s, 1s</code></pre> <ul> <li><strong>Zero runtime overhead</strong> for compile-time calculations</li> <li><strong>Better optimization</strong> opportunities for the compiler</li> <li><strong>Smaller binary size</strong> due to constant folding</li> <li><strong>Early error detection</strong> at compile time</li> </ul> <h3 id=6-type-safe-units>6. Type-Safe Units<a class=headerlink href=#6-type-safe-units title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1>// Type-safe duration units</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=w> </span><span class=nc>Rep</span><span class=p>,</span><span class=w> </span><span class=k>typename</span><span class=w> </span><span class=nc>Period</span><span class=o>&gt;</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=k>class</span><span class=w> </span><span class=nc>duration</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=n>Rep</span><span class=w> </span><span class=n>rep_</span><span class=p>;</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=k>public</span><span class=o>:</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>    </span><span class=k>constexpr</span><span class=w> </span><span class=k>explicit</span><span class=w> </span><span class=n>duration</span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=n>Rep</span><span class=o>&amp;</span><span class=w> </span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>rep_</span><span class=p>(</span><span class=n>r</span><span class=p>)</span><span class=w> </span><span class=p>{}</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>    </span><span class=k>constexpr</span><span class=w> </span><span class=n>Rep</span><span class=w> </span><span class=n>count</span><span class=p>()</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=n>rep_</span><span class=p>;</span><span class=w> </span><span class=p>}</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>    </span><span class=c1>// ...</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=p>};</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=c1>// User-defined literals</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=k>operator</span><span class=s>&quot;&quot;</span><span class=n>_days</span><span class=p>(</span><span class=kt>unsigned</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=kt>long</span><span class=w> </span><span class=n>d</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>86400</span><span class=o>&gt;&gt;</span><span class=p>(</span><span class=n>d</span><span class=p>);</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=p>}</span>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a>
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=c1>// Usage:</span>
</span><span id=__span-32-17><a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>two_weeks</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>14</span><span class=n>_days</span><span class=p>;</span><span class=w>  </span><span class=c1>// Type-safe, checked at compile time</span>
</span></code></pre></div> <h3 id=7-compile-time-formatting>7. Compile-Time Formatting<a class=headerlink href=#7-compile-time-formatting title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1>// Compile-time format string processing</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span><span class=w> </span><span class=n>Args</span><span class=o>&gt;</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=k>constexpr</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>make_format_string</span><span class=p>()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>    </span><span class=k>constexpr</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>fmt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>;</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>    </span><span class=c1>// Validate format string at compile time</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=w>    </span><span class=k>static_assert</span><span class=p>(</span><span class=n>validate_format_string</span><span class=o>&lt;</span><span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span><span class=p>(</span><span class=n>fmt</span><span class=p>),</span><span class=w> </span><span class=s>&quot;Invalid format string&quot;</span><span class=p>);</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>fmt</span><span class=p>;</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=p>}</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=c1>// Usage:</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=k>auto</span><span class=w> </span><span class=n>fmt</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>make_format_string</span><span class=o>&lt;</span><span class=n>year</span><span class=p>,</span><span class=w> </span><span class=n>month</span><span class=p>,</span><span class=w> </span><span class=n>day</span><span class=p>,</span><span class=w> </span><span class=n>hours</span><span class=p>,</span><span class=w> </span><span class=n>minutes</span><span class=p>,</span><span class=w> </span><span class=n>seconds</span><span class=o>&gt;</span><span class=p>();</span>
</span></code></pre></div> <h2 id=benchmarking>Benchmarking<a class=headerlink href=#benchmarking title="Permanent link">&para;</a></h2> <pre class=mermaid><code>pie
    title Benchmarking Focus Areas
    "CPU Time" : 40
    "Memory Usage" : 30
    "Cache Behavior" : 20
    "Thread Contention" : 10</code></pre> <h3 id=1-benchmarking-with-google-benchmark>1. Benchmarking with Google Benchmark<a class=headerlink href=#1-benchmarking-with-google-benchmark title="Permanent link">&para;</a></h3> <h4 id=basic-benchmark-structure>Basic Benchmark Structure<a class=headerlink href=#basic-benchmark-structure title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart TD
    A[Setup] --&gt; B[Start Timer]
    B --&gt; C[Run Test Code]
    C --&gt; D[Stop Timer]
    D --&gt; E[Report Results]</code></pre> <h4 id=time-formatting-benchmark>Time Formatting Benchmark<a class=headerlink href=#time-formatting-benchmark title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;benchmark/benchmark.h&gt;</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a><span class=c1>// Benchmark time formatting</span>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>BM_TimeFormatting</span><span class=p>(</span><span class=n>benchmark</span><span class=o>::</span><span class=n>State</span><span class=o>&amp;</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=w>    </span><span class=c1>// Setup (not measured)</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>buffer</span><span class=p>;</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a><span class=w>    </span><span class=n>buffer</span><span class=p>.</span><span class=n>reserve</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=w>    </span><span class=c1>// Benchmark loop</span>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-34-12><a id=__codelineno-34-12 name=__codelineno-34-12 href=#__codelineno-34-12></a><span class=w>        </span><span class=n>buffer</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span><span id=__span-34-13><a id=__codelineno-34-13 name=__codelineno-34-13 href=#__codelineno-34-13></a><span class=w>        </span><span class=c1>// Format time to string</span>
</span><span id=__span-34-14><a id=__codelineno-34-14 name=__codelineno-34-14 href=#__codelineno-34-14></a><span class=w>        </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>format_to</span><span class=p>(</span>
</span><span id=__span-34-15><a id=__codelineno-34-15 name=__codelineno-34-15 href=#__codelineno-34-15></a><span class=w>            </span><span class=n>std</span><span class=o>::</span><span class=n>back_inserter</span><span class=p>(</span><span class=n>buffer</span><span class=p>),</span><span class=w> </span>
</span><span id=__span-34-16><a id=__codelineno-34-16 name=__codelineno-34-16 href=#__codelineno-34-16></a><span class=w>            </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-34-17><a id=__codelineno-34-17 name=__codelineno-34-17 href=#__codelineno-34-17></a><span class=w>            </span><span class=n>now</span>
</span><span id=__span-34-18><a id=__codelineno-34-18 name=__codelineno-34-18 href=#__codelineno-34-18></a><span class=w>        </span><span class=p>);</span>
</span><span id=__span-34-19><a id=__codelineno-34-19 name=__codelineno-34-19 href=#__codelineno-34-19></a><span class=w>        </span><span class=c1>// Prevent compiler optimizations</span>
</span><span id=__span-34-20><a id=__codelineno-34-20 name=__codelineno-34-20 href=#__codelineno-34-20></a><span class=w>        </span><span class=n>benchmark</span><span class=o>::</span><span class=n>DoNotOptimize</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span>
</span><span id=__span-34-21><a id=__codelineno-34-21 name=__codelineno-34-21 href=#__codelineno-34-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-34-22><a id=__codelineno-34-22 name=__codelineno-34-22 href=#__codelineno-34-22></a>
</span><span id=__span-34-23><a id=__codelineno-34-23 name=__codelineno-34-23 href=#__codelineno-34-23></a><span class=w>    </span><span class=c1>// Optional: Set custom metrics</span>
</span><span id=__span-34-24><a id=__codelineno-34-24 name=__codelineno-34-24 href=#__codelineno-34-24></a><span class=w>    </span><span class=n>state</span><span class=p>.</span><span class=n>SetBytesProcessed</span><span class=p>(</span>
</span><span id=__span-34-25><a id=__codelineno-34-25 name=__codelineno-34-25 href=#__codelineno-34-25></a><span class=w>        </span><span class=kt>int64_t</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=n>iterations</span><span class=p>())</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>buffer</span><span class=p>.</span><span class=n>size</span><span class=p>()</span>
</span><span id=__span-34-26><a id=__codelineno-34-26 name=__codelineno-34-26 href=#__codelineno-34-26></a><span class=w>    </span><span class=p>);</span>
</span><span id=__span-34-27><a id=__codelineno-34-27 name=__codelineno-34-27 href=#__codelineno-34-27></a><span class=p>}</span>
</span><span id=__span-34-28><a id=__codelineno-34-28 name=__codelineno-34-28 href=#__codelineno-34-28></a>
</span><span id=__span-34-29><a id=__codelineno-34-29 name=__codelineno-34-29 href=#__codelineno-34-29></a><span class=c1>// Register benchmark</span>
</span><span id=__span-34-30><a id=__codelineno-34-30 name=__codelineno-34-30 href=#__codelineno-34-30></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_TimeFormatting</span><span class=p>);</span>
</span></code></pre></div> <h3 id=2-benchmarking-different-approaches>2. Benchmarking Different Approaches<a class=headerlink href=#2-benchmarking-different-approaches title="Permanent link">&para;</a></h3> <h4 id=comparing-multiple-implementations>Comparing Multiple Implementations<a class=headerlink href=#comparing-multiple-implementations title="Permanent link">&para;</a></h4> <pre class=mermaid><code>gantt
    title Benchmark Comparison
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section Implementation A
    Run 1 :a1, 0s, 2s
    Run 2 :a2, after a1, 2s

    section Implementation B
    Run 1 :b1, 0s, 1s
    Run 2 :b2, after b1, 1s</code></pre> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=c1>// Compare different formatting approaches</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>BM_Format_vs_Manual</span><span class=p>(</span><span class=n>benchmark</span><span class=o>::</span><span class=n>State</span><span class=o>&amp;</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>buffer</span><span class=p>;</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>    </span><span class=n>buffer</span><span class=p>.</span><span class=n>reserve</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>        </span><span class=c1>// Method 1: Using format_to</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=w>        </span><span class=n>buffer</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=w>        </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>format_to</span><span class=p>(</span>
</span><span id=__span-35-11><a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a><span class=w>            </span><span class=n>std</span><span class=o>::</span><span class=n>back_inserter</span><span class=p>(</span><span class=n>buffer</span><span class=p>),</span><span class=w> </span>
</span><span id=__span-35-12><a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a><span class=w>            </span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-35-13><a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a><span class=w>            </span><span class=n>now</span>
</span><span id=__span-35-14><a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a><span class=w>        </span><span class=p>);</span>
</span><span id=__span-35-15><a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a><span class=w>        </span><span class=n>benchmark</span><span class=o>::</span><span class=n>DoNotOptimize</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span>
</span><span id=__span-35-16><a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-17><a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=p>}</span>
</span><span id=__span-35-18><a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a>
</span><span id=__span-35-19><a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>BM_Format_Manual</span><span class=p>(</span><span class=n>benchmark</span><span class=o>::</span><span class=n>State</span><span class=o>&amp;</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-20><a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-35-21><a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>buffer</span><span class=p>;</span>
</span><span id=__span-35-22><a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a><span class=w>    </span><span class=n>buffer</span><span class=p>.</span><span class=n>reserve</span><span class=p>(</span><span class=mi>32</span><span class=p>);</span>
</span><span id=__span-35-23><a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a>
</span><span id=__span-35-24><a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-35-25><a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=w>        </span><span class=c1>// Method 2: Manual formatting</span>
</span><span id=__span-35-26><a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a><span class=w>        </span><span class=n>buffer</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span><span id=__span-35-27><a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>dp</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>floor</span><span class=o>&lt;</span><span class=n>chronovyan</span><span class=o>::</span><span class=n>days</span><span class=o>&gt;</span><span class=p>(</span><span class=n>now</span><span class=p>);</span>
</span><span id=__span-35-28><a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a><span class=w>        </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>year_month_weekday</span><span class=w> </span><span class=n>ymd</span><span class=p>{</span><span class=n>chronovyan</span><span class=o>::</span><span class=n>sys_days</span><span class=p>{</span><span class=n>dp</span><span class=p>}};</span>
</span><span id=__span-35-29><a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a><span class=w>        </span><span class=c1>// ... manual formatting ...</span>
</span><span id=__span-35-30><a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a><span class=w>        </span><span class=n>benchmark</span><span class=o>::</span><span class=n>DoNotOptimize</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span>
</span><span id=__span-35-31><a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-35-32><a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a><span class=p>}</span>
</span><span id=__span-35-33><a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a>
</span><span id=__span-35-34><a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_Format_vs_Manual</span><span class=p>);</span>
</span><span id=__span-35-35><a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_Format_Manual</span><span class=p>);</span>
</span></code></pre></div> <h3 id=3-memory-benchmarking>3. Memory Benchmarking<a class=headerlink href=#3-memory-benchmarking title="Permanent link">&para;</a></h3> <h4 id=memory-usage-analysis>Memory Usage Analysis<a class=headerlink href=#memory-usage-analysis title="Permanent link">&para;</a></h4> <pre class=mermaid><code>classDiagram
    class MemoryTracker {
        +size_t current_usage()
        +size_t peak_usage()
        +void reset_peak()
    }

    class BenchmarkState {
        +size_t bytes_processed()
        +size_t items_processed()
        +void SetBytesProcessed(int64_t)
    }

    MemoryTracker &lt;|-- BenchmarkState</code></pre> <h4 id=memory-benchmark-example>Memory Benchmark Example<a class=headerlink href=#memory-benchmark-example title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=cp>#include</span><span class=w> </span><span class=cpf>&lt;benchmark/benchmark.h&gt;</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>BM_TimeParsing_Memory</span><span class=p>(</span><span class=n>benchmark</span><span class=o>::</span><span class=n>State</span><span class=o>&amp;</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>char</span><span class=o>*</span><span class=w> </span><span class=n>time_str</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&quot;2023-01-15 14:30:00&quot;</span><span class=p>;</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=w>    </span><span class=c1>// Track memory allocations</span>
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>start_mem</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GetCurrentRSS</span><span class=p>();</span><span class=w>  </span><span class=c1>// Platform-specific memory function</span>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a><span class=w>        </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>sys_seconds</span><span class=w> </span><span class=n>tp</span><span class=p>;</span>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>istringstream</span><span class=w> </span><span class=n>ss</span><span class=p>(</span><span class=n>time_str</span><span class=p>);</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a><span class=w>        </span><span class=n>ss</span><span class=w> </span><span class=o>&gt;&gt;</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>parse</span><span class=p>(</span><span class=s>&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class=p>,</span><span class=w> </span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a><span class=w>        </span><span class=n>benchmark</span><span class=o>::</span><span class=n>DoNotOptimize</span><span class=p>(</span><span class=n>tp</span><span class=p>);</span>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>end_mem</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GetCurrentRSS</span><span class=p>();</span>
</span><span id=__span-36-17><a id=__codelineno-36-17 name=__codelineno-36-17 href=#__codelineno-36-17></a><span class=w>    </span><span class=n>state</span><span class=p>.</span><span class=n>counters</span><span class=p>[</span><span class=s>&quot;Memory&quot;</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>end_mem</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>start_mem</span><span class=p>;</span>
</span><span id=__span-36-18><a id=__codelineno-36-18 name=__codelineno-36-18 href=#__codelineno-36-18></a><span class=p>}</span>
</span><span id=__span-36-19><a id=__codelineno-36-19 name=__codelineno-36-19 href=#__codelineno-36-19></a>
</span><span id=__span-36-20><a id=__codelineno-36-20 name=__codelineno-36-20 href=#__codelineno-36-20></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_TimeParsing_Memory</span><span class=p>);</span>
</span></code></pre></div> <h3 id=4-cache-behavior-analysis>4. Cache Behavior Analysis<a class=headerlink href=#4-cache-behavior-analysis title="Permanent link">&para;</a></h3> <h4 id=cache-performance>Cache Performance<a class=headerlink href=#cache-performance title="Permanent link">&para;</a></h4> <pre class=mermaid><code>gantt
    title Cache Miss Impact
    dateFormat  HH:mm:ss.SSS
    axisFormat %S.%Lms

    section L1 Cache
    Access :a1, 0s, 1s

    section L2 Cache
    Access :a2, after a1, 2s

    section RAM
    Access :a3, after a2, 10s</code></pre> <h4 id=cache-aware-benchmark>Cache-Aware Benchmark<a class=headerlink href=#cache-aware-benchmark title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>BM_CacheBehavior</span><span class=p>(</span><span class=n>benchmark</span><span class=o>::</span><span class=n>State</span><span class=o>&amp;</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=w>    </span><span class=c1>// Create a large vector of time points</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=o>&gt;</span><span class=w> </span><span class=n>times</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=n>range</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=w>    </span><span class=c1>// Initialize with sequential times</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>times</span><span class=p>.</span><span class=n>size</span><span class=p>();</span><span class=w> </span><span class=o>++</span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=w>        </span><span class=n>times</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>seconds</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=w>    </span><span class=c1>// Shuffle for random access pattern</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>random_device</span><span class=w> </span><span class=n>rd</span><span class=p>;</span>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>mt19937</span><span class=w> </span><span class=n>g</span><span class=p>(</span><span class=n>rd</span><span class=p>());</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>shuffle</span><span class=p>(</span><span class=n>times</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=w> </span><span class=n>times</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span><span class=w> </span><span class=n>g</span><span class=p>);</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a><span class=w>    </span><span class=c1>// Benchmark random access</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a><span class=w>    </span><span class=kt>size_t</span><span class=w> </span><span class=n>sum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>times</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a><span class=w>            </span><span class=n>sum</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>time_since_epoch</span><span class=p>().</span><span class=n>count</span><span class=p>();</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a><span class=w>    </span><span class=n>state</span><span class=p>.</span><span class=n>counters</span><span class=p>[</span><span class=s>&quot;TimePerItem&quot;</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class=w>        </span><span class=n>benchmark</span><span class=o>::</span><span class=n>Counter</span><span class=p>(</span>
</span><span id=__span-37-26><a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a><span class=w>            </span><span class=n>state</span><span class=p>.</span><span class=n>iterations</span><span class=p>()</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>times</span><span class=p>.</span><span class=n>size</span><span class=p>(),</span>
</span><span id=__span-37-27><a id=__codelineno-37-27 name=__codelineno-37-27 href=#__codelineno-37-27></a><span class=w>            </span><span class=n>benchmark</span><span class=o>::</span><span class=n>Counter</span><span class=o>::</span><span class=n>kIsRate</span>
</span><span id=__span-37-28><a id=__codelineno-37-28 name=__codelineno-37-28 href=#__codelineno-37-28></a><span class=w>        </span><span class=p>);</span>
</span><span id=__span-37-29><a id=__codelineno-37-29 name=__codelineno-37-29 href=#__codelineno-37-29></a><span class=p>}</span>
</span><span id=__span-37-30><a id=__codelineno-37-30 name=__codelineno-37-30 href=#__codelineno-37-30></a>
</span><span id=__span-37-31><a id=__codelineno-37-31 name=__codelineno-37-31 href=#__codelineno-37-31></a><span class=c1>// Test with different container sizes</span>
</span><span id=__span-37-32><a id=__codelineno-37-32 name=__codelineno-37-32 href=#__codelineno-37-32></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_CacheBehavior</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>RangeMultiplier</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>Range</span><span class=p>(</span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=o>&lt;&lt;</span><span class=mi>20</span><span class=p>);</span>
</span></code></pre></div> <h3 id=5-thread-scaling-benchmarks>5. Thread Scaling Benchmarks<a class=headerlink href=#5-thread-scaling-benchmarks title="Permanent link">&para;</a></h3> <h4 id=multi-threaded-performance>Multi-threaded Performance<a class=headerlink href=#multi-threaded-performance title="Permanent link">&para;</a></h4> <pre class=mermaid><code>flowchart TD
    A[Single Thread] --&gt;|2x Cores| B[2x Speedup?]
    B --&gt;|No| C[Bottleneck Found]
    B --&gt;|Yes| D[Continue Scaling]</code></pre> <h4 id=thread-scaling-benchmark>Thread Scaling Benchmark<a class=headerlink href=#thread-scaling-benchmark title="Permanent link">&para;</a></h4> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>BM_ThreadScaling</span><span class=p>(</span><span class=n>benchmark</span><span class=o>::</span><span class=n>State</span><span class=o>&amp;</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=w>    </span><span class=k>const</span><span class=w> </span><span class=kt>size_t</span><span class=w> </span><span class=n>num_times</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1&#39;000&#39;000</span><span class=p>;</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=o>&gt;</span><span class=w> </span><span class=n>times</span><span class=p>(</span><span class=n>num_times</span><span class=p>);</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>    </span><span class=c1>// Initialize test data</span>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>size_t</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>num_times</span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a><span class=w>        </span><span class=n>times</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>chronovyan</span><span class=o>::</span><span class=n>milliseconds</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>1000</span><span class=p>);</span>
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a><span class=w>    </span><span class=c1>// Process times in parallel</span>
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>process_times</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span><span class=o>&amp;</span><span class=p>]()</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a><span class=w>            </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>times</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a><span class=w>                </span><span class=k>auto</span><span class=w> </span><span class=n>value</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>time_since_epoch</span><span class=p>().</span><span class=n>count</span><span class=p>();</span>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=w>                </span><span class=n>benchmark</span><span class=o>::</span><span class=n>DoNotOptimize</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-38-18><a id=__codelineno-38-18 name=__codelineno-38-18 href=#__codelineno-38-18></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-38-19><a id=__codelineno-38-19 name=__codelineno-38-19 href=#__codelineno-38-19></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-38-20><a id=__codelineno-38-20 name=__codelineno-38-20 href=#__codelineno-38-20></a>
</span><span id=__span-38-21><a id=__codelineno-38-21 name=__codelineno-38-21 href=#__codelineno-38-21></a><span class=w>    </span><span class=c1>// Execute with different thread counts</span>
</span><span id=__span-38-22><a id=__codelineno-38-22 name=__codelineno-38-22 href=#__codelineno-38-22></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=n>thread_index</span><span class=p>()</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-23><a id=__codelineno-38-23 name=__codelineno-38-23 href=#__codelineno-38-23></a><span class=w>        </span><span class=c1>// Single-threaded baseline</span>
</span><span id=__span-38-24><a id=__codelineno-38-24 name=__codelineno-38-24 href=#__codelineno-38-24></a><span class=w>        </span><span class=n>process_times</span><span class=p>();</span>
</span><span id=__span-38-25><a id=__codelineno-38-25 name=__codelineno-38-25 href=#__codelineno-38-25></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-26><a id=__codelineno-38-26 name=__codelineno-38-26 href=#__codelineno-38-26></a><span class=w>        </span><span class=c1>// Multi-threaded</span>
</span><span id=__span-38-27><a id=__codelineno-38-27 name=__codelineno-38-27 href=#__codelineno-38-27></a><span class=w>        </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=kr>thread</span><span class=o>&gt;</span><span class=w> </span><span class=n>threads</span><span class=p>;</span>
</span><span id=__span-38-28><a id=__codelineno-38-28 name=__codelineno-38-28 href=#__codelineno-38-28></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>threads</span><span class=p>()</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>i</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-38-29><a id=__codelineno-38-29 name=__codelineno-38-29 href=#__codelineno-38-29></a><span class=w>            </span><span class=n>threads</span><span class=p>.</span><span class=n>emplace_back</span><span class=p>(</span><span class=n>process_times</span><span class=p>);</span>
</span><span id=__span-38-30><a id=__codelineno-38-30 name=__codelineno-38-30 href=#__codelineno-38-30></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-38-31><a id=__codelineno-38-31 name=__codelineno-38-31 href=#__codelineno-38-31></a><span class=w>        </span><span class=n>process_times</span><span class=p>();</span><span class=w>  </span><span class=c1>// Use main thread too</span>
</span><span id=__span-38-32><a id=__codelineno-38-32 name=__codelineno-38-32 href=#__codelineno-38-32></a><span class=w>        </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=k>auto</span><span class=o>&amp;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>threads</span><span class=p>)</span><span class=w> </span><span class=n>t</span><span class=p>.</span><span class=n>join</span><span class=p>();</span>
</span><span id=__span-38-33><a id=__codelineno-38-33 name=__codelineno-38-33 href=#__codelineno-38-33></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-38-34><a id=__codelineno-38-34 name=__codelineno-38-34 href=#__codelineno-38-34></a><span class=p>}</span>
</span><span id=__span-38-35><a id=__codelineno-38-35 name=__codelineno-38-35 href=#__codelineno-38-35></a>
</span><span id=__span-38-36><a id=__codelineno-38-36 name=__codelineno-38-36 href=#__codelineno-38-36></a><span class=c1>// Test with 1-8 threads</span>
</span><span id=__span-38-37><a id=__codelineno-38-37 name=__codelineno-38-37 href=#__codelineno-38-37></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_ThreadScaling</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>ThreadRange</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=p>);</span>
</span></code></pre></div> <h3 id=6-benchmark-analysis-and-reporting>6. Benchmark Analysis and Reporting<a class=headerlink href=#6-benchmark-analysis-and-reporting title="Permanent link">&para;</a></h3> <h4 id=performance-metrics>Performance Metrics<a class=headerlink href=#performance-metrics title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Metric</th> <th>Description</th> <th>Importance</th> </tr> </thead> <tbody> <tr> <td>Time/Op</td> <td>Time per operation</td> <td>Primary performance indicator</td> </tr> <tr> <td>Ops/sec</td> <td>Operations per second</td> <td>Throughput measurement</td> </tr> <tr> <td>CPU %</td> <td>CPU utilization</td> <td>Efficiency indicator</td> </tr> <tr> <td>Mem/Op</td> <td>Memory per operation</td> <td>Memory efficiency</td> </tr> <tr> <td>Cache-misses</td> <td>Cache miss rate</td> <td>Memory access pattern</td> </tr> </tbody> </table> <h4 id=generating-reports>Generating Reports<a class=headerlink href=#generating-reports title="Permanent link">&para;</a></h4> <div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1># Run all benchmarks with statistics</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>./benchmark<span class=w> </span>--benchmark_format<span class=o>=</span>console<span class=w> </span><span class=se>\</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=w>            </span>--benchmark_out<span class=o>=</span>results.json<span class=w> </span><span class=se>\</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>            </span>--benchmark_out_format<span class=o>=</span>json
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=c1># Generate report</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a>python3<span class=w> </span>-m<span class=w> </span>pip<span class=w> </span>install<span class=w> </span>pandas<span class=w> </span>matplotlib
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a>python3<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=s2>import pandas as pd</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=s2>import matplotlib.pyplot as plt</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=s2># Load benchmark results</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=s2>df = pd.read_json(&#39;results.json&#39;, lines=True)</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=s2>df = df[df[&#39;name&#39;].str.contains(&#39;BM_&#39;)]</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=s2># Plot results</span>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=s2>plt.figure(figsize=(12, 6))</span>
</span><span id=__span-39-18><a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=s2>for name, group in df.groupby(&#39;name&#39;):</span>
</span><span id=__span-39-19><a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=s2>    plt.plot(</span>
</span><span id=__span-39-20><a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=s2>        group[&#39;threads&#39;], </span>
</span><span id=__span-39-21><a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=s2>        group[&#39;real_time&#39;], </span>
</span><span id=__span-39-22><a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=s2>        &#39;o-&#39;, </span>
</span><span id=__span-39-23><a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=s2>        label=name</span>
</span><span id=__span-39-24><a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=s2>    )</span>
</span><span id=__span-39-25><a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a>
</span><span id=__span-39-26><a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=s2>plt.xlabel(&#39;Threads&#39;)</span>
</span><span id=__span-39-27><a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class=s2>plt.ylabel(&#39;Time (ns)&#39;)</span>
</span><span id=__span-39-28><a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=s2>plt.title(&#39;Thread Scaling Performance&#39;)</span>
</span><span id=__span-39-29><a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=s2>plt.legend()</span>
</span><span id=__span-39-30><a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=s2>plt.grid(True)</span>
</span><span id=__span-39-31><a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=s2>plt.savefig(&#39;benchmark_results.png&#39;)</span>
</span><span id=__span-39-32><a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class=s2>&quot;</span>
</span></code></pre></div> <h3 id=7-benchmarking-best-practices>7. Benchmarking Best Practices<a class=headerlink href=#7-benchmarking-best-practices title="Permanent link">&para;</a></h3> <ol> <li> <p><strong>Warm-up Runs</strong> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1>// First few iterations might be slower due to cache warming</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_Test</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>MinWarmUpTime</span><span class=p>(</span><span class=mf>1.0</span><span class=p>);</span>
</span></code></pre></div></p> </li> <li> <p><strong>Iteration Count</strong> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1>// Run enough iterations for stable measurements</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_Test</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>MinTime</span><span class=p>(</span><span class=mf>5.0</span><span class=p>);</span><span class=w>  </span><span class=c1>// Run for at least 5 seconds</span>
</span></code></pre></div></p> </li> <li> <p><strong>Parameterized Tests</strong> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=k>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>BM_Parameterized</span><span class=p>(</span><span class=n>benchmark</span><span class=o>::</span><span class=n>State</span><span class=o>&amp;</span><span class=w> </span><span class=n>state</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>state</span><span class=p>.</span><span class=n>range</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a><span class=w>    </span><span class=c1>// Test with different container sizes</span>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=p>}</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a><span class=n>BENCHMARK</span><span class=p>(</span><span class=n>BM_Parameterized</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>RangeMultiplier</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=o>-&gt;</span><span class=n>Range</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=w> </span><span class=mi>8</span><span class=o>&lt;&lt;</span><span class=mi>10</span><span class=p>);</span>
</span></code></pre></div></p> </li> <li> <p><strong>Memory Access Patterns</strong> <pre class=mermaid><code>flowchart LR
    A[Sequential] --&gt;|Best| B[Cache Friendly]
    C[Random] --&gt;|Worst| D[Cache Thrashing]
    E[Strided] --&gt;|Depends| F[Stride Length]</code></pre></p> </li> <li> <p><strong>Avoiding Optimization</strong> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1>// Prevent dead code elimination</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=n>benchmark</span><span class=o>::</span><span class=n>DoNotOptimize</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=c1>// Force memory writes</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=n>benchmark</span><span class=o>::</span><span class=n>ClobberMemory</span><span class=p>();</span>
</span></code></pre></div></p> </li> <li> <p><strong>Measuring Real-world Scenarios</strong> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1>// Simulate real-world access patterns</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>TimePoint</span><span class=o>&gt;</span><span class=w> </span><span class=n>times</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>generate_realistic_workload</span><span class=p>();</span>
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a><span class=n>BENCHMARK_CAPTURE</span><span class=p>(</span><span class=n>BM_RealWorld</span><span class=p>,</span><span class=w> </span><span class=n>workload1</span><span class=p>,</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>move</span><span class=p>(</span><span class=n>times</span><span class=p>));</span>
</span></code></pre></div> } BENCHMARK(BM_TimeFormatting);</p> </li> </ol> <p>BENCHMARK_MAIN(); <div class="language-text highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>### Measuring Time Zone Conversion Performance
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>```cpp
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>static void BM_TimeZoneConversion(benchmark::State&amp; state) {
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a>    auto tz = chronovyan::locate_zone(&quot;America/New_York&quot;);
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a>    auto now = chronovyan::system_clock::now();
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a>    for (auto _ : state) {
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a>        auto zt = chronovyan::zoned_time{tz, now};
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>        benchmark::DoNotOptimize(zt);
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a>    }
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a>    state.SetItemsProcessed(state.iterations());
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a>}
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a>BENCHMARK(BM_TimeZoneConversion);
</span></code></pre></div></p> <h2 id=real-world-examples>Real-World Examples<a class=headerlink href=#real-world-examples title="Permanent link">&para;</a></h2> <h3 id=high-performance-logging>High-Performance Logging<a class=headerlink href=#high-performance-logging title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=k>class</span><span class=w> </span><span class=nc>Logger</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>ofstream</span><span class=w> </span><span class=n>log_file</span><span class=p>;</span>
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=w> </span><span class=n>buffer</span><span class=p>;</span>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a><span class=k>public</span><span class=o>:</span>
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=n>log</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>string_view</span><span class=w> </span><span class=n>message</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a><span class=w>        </span><span class=n>buffer</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>now</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a>
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a><span class=w>        </span><span class=c1>// Format timestamp</span>
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a><span class=w>        </span><span class=n>format_to</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>back_inserter</span><span class=p>(</span><span class=n>buffer</span><span class=p>),</span><span class=w> </span>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=w>                 </span><span class=s>&quot;[%Y-%m-%d %H:%M:%S] &quot;</span><span class=p>,</span><span class=w> </span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a><span class=w>                 </span><span class=n>zoned_time</span><span class=p>{</span><span class=n>current_zone</span><span class=p>(),</span><span class=w> </span><span class=n>now</span><span class=p>});</span>
</span><span id=__span-46-14><a id=__codelineno-46-14 name=__codelineno-46-14 href=#__codelineno-46-14></a>
</span><span id=__span-46-15><a id=__codelineno-46-15 name=__codelineno-46-15 href=#__codelineno-46-15></a><span class=w>        </span><span class=c1>// Append message</span>
</span><span id=__span-46-16><a id=__codelineno-46-16 name=__codelineno-46-16 href=#__codelineno-46-16></a><span class=w>        </span><span class=n>buffer</span><span class=p>.</span><span class=n>append</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
</span><span id=__span-46-17><a id=__codelineno-46-17 name=__codelineno-46-17 href=#__codelineno-46-17></a><span class=w>        </span><span class=n>buffer</span><span class=p>.</span><span class=n>push_back</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
</span><span id=__span-46-18><a id=__codelineno-46-18 name=__codelineno-46-18 href=#__codelineno-46-18></a>
</span><span id=__span-46-19><a id=__codelineno-46-19 name=__codelineno-46-19 href=#__codelineno-46-19></a><span class=w>        </span><span class=c1>// Write to file</span>
</span><span id=__span-46-20><a id=__codelineno-46-20 name=__codelineno-46-20 href=#__codelineno-46-20></a><span class=w>        </span><span class=n>log_file</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=n>buffer</span><span class=p>.</span><span class=n>data</span><span class=p>(),</span><span class=w> </span><span class=n>buffer</span><span class=p>.</span><span class=n>size</span><span class=p>());</span>
</span><span id=__span-46-21><a id=__codelineno-46-21 name=__codelineno-46-21 href=#__codelineno-46-21></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-46-22><a id=__codelineno-46-22 name=__codelineno-46-22 href=#__codelineno-46-22></a><span class=p>};</span>
</span></code></pre></div> <h3 id=efficient-time-series-processing>Efficient Time Series Processing<a class=headerlink href=#efficient-time-series-processing title="Permanent link">&para;</a></h3> <div class="language-cpp highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=k>struct</span><span class=w> </span><span class=nc>TimeSeries</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=w>    </span><span class=k>struct</span><span class=w> </span><span class=nc>Point</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=w>        </span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=w> </span><span class=n>time</span><span class=p>;</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a><span class=w>        </span><span class=kt>double</span><span class=w> </span><span class=n>value</span><span class=p>;</span>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=w>    </span><span class=p>};</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=w>    </span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Point</span><span class=o>&gt;</span><span class=w> </span><span class=n>points</span><span class=p>;</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a><span class=w>    </span><span class=c1>// Find all points in a time range [start, end)</span>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=w>    </span><span class=k>auto</span><span class=w> </span><span class=n>find_in_range</span><span class=p>(</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=w> </span><span class=n>start</span><span class=p>,</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=w>                      </span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=w> </span><span class=n>end</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>std</span><span class=o>::</span><span class=n>equal_range</span><span class=p>(</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a><span class=w>            </span><span class=n>points</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span><span class=w> </span><span class=n>points</span><span class=p>.</span><span class=n>end</span><span class=p>(),</span>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=w>            </span><span class=n>start</span><span class=p>,</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=w>            </span><span class=p>[](</span><span class=k>const</span><span class=w> </span><span class=n>Point</span><span class=o>&amp;</span><span class=w> </span><span class=n>p</span><span class=p>,</span><span class=w> </span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span><span class=w> </span><span class=n>t</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a><span class=w>                </span><span class=k>return</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>time</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>t</span><span class=p>;</span>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a><span class=w>            </span><span class=p>});</span>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a>
</span><span id=__span-47-20><a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a><span class=w>    </span><span class=c1>// Resample to a fixed interval</span>
</span><span id=__span-47-21><a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a><span class=w>    </span><span class=n>TimeSeries</span><span class=w> </span><span class=n>resample</span><span class=p>(</span><span class=n>seconds</span><span class=w> </span><span class=n>interval</span><span class=p>)</span><span class=w> </span><span class=k>const</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-22><a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=w>        </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>points</span><span class=p>.</span><span class=n>empty</span><span class=p>())</span><span class=w> </span><span class=k>return</span><span class=w> </span><span class=p>{};</span>
</span><span id=__span-47-23><a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a>
</span><span id=__span-47-24><a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a><span class=w>        </span><span class=n>TimeSeries</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
</span><span id=__span-47-25><a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a><span class=w>        </span><span class=k>auto</span><span class=w> </span><span class=n>current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>points</span><span class=p>.</span><span class=n>front</span><span class=p>().</span><span class=n>time</span><span class=p>;</span>
</span><span id=__span-47-26><a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a><span class=w>        </span><span class=k>const</span><span class=w> </span><span class=k>auto</span><span class=w> </span><span class=n>end_time</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>points</span><span class=p>.</span><span class=n>back</span><span class=p>().</span><span class=n>time</span><span class=p>;</span>
</span><span id=__span-47-27><a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a>
</span><span id=__span-47-28><a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a><span class=w>        </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=n>current</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=n>end_time</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-29><a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a><span class=w>            </span><span class=k>auto</span><span class=w> </span><span class=n>next</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>current</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>interval</span><span class=p>;</span>
</span><span id=__span-47-30><a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a><span class=w>            </span><span class=k>auto</span><span class=w> </span><span class=p>[</span><span class=n>first</span><span class=p>,</span><span class=w> </span><span class=n>last</span><span class=p>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>find_in_range</span><span class=p>(</span><span class=n>current</span><span class=p>,</span><span class=w> </span><span class=n>next</span><span class=p>);</span>
</span><span id=__span-47-31><a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a>
</span><span id=__span-47-32><a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a><span class=w>            </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>first</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>last</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-33><a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a><span class=w>                </span><span class=c1>// Simple average of values in the interval</span>
</span><span id=__span-47-34><a id=__codelineno-47-34 name=__codelineno-47-34 href=#__codelineno-47-34></a><span class=w>                </span><span class=kt>double</span><span class=w> </span><span class=n>sum</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-47-35><a id=__codelineno-47-35 name=__codelineno-47-35 href=#__codelineno-47-35></a><span class=w>                </span><span class=kt>size_t</span><span class=w> </span><span class=n>count</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span>
</span><span id=__span-47-36><a id=__codelineno-47-36 name=__codelineno-47-36 href=#__codelineno-47-36></a><span class=w>                </span><span class=k>for</span><span class=w> </span><span class=p>(;</span><span class=w> </span><span class=n>first</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>last</span><span class=p>;</span><span class=w> </span><span class=o>++</span><span class=n>first</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-37><a id=__codelineno-47-37 name=__codelineno-47-37 href=#__codelineno-47-37></a><span class=w>                    </span><span class=n>sum</span><span class=w> </span><span class=o>+=</span><span class=w> </span><span class=n>first</span><span class=o>-&gt;</span><span class=n>value</span><span class=p>;</span>
</span><span id=__span-47-38><a id=__codelineno-47-38 name=__codelineno-47-38 href=#__codelineno-47-38></a><span class=w>                    </span><span class=o>++</span><span class=n>count</span><span class=p>;</span>
</span><span id=__span-47-39><a id=__codelineno-47-39 name=__codelineno-47-39 href=#__codelineno-47-39></a><span class=w>                </span><span class=p>}</span>
</span><span id=__span-47-40><a id=__codelineno-47-40 name=__codelineno-47-40 href=#__codelineno-47-40></a><span class=w>                </span><span class=n>result</span><span class=p>.</span><span class=n>points</span><span class=p>.</span><span class=n>push_back</span><span class=p>({</span><span class=n>current</span><span class=p>,</span><span class=w> </span><span class=n>sum</span><span class=w> </span><span class=o>/</span><span class=w> </span><span class=n>count</span><span class=p>});</span>
</span><span id=__span-47-41><a id=__codelineno-47-41 name=__codelineno-47-41 href=#__codelineno-47-41></a><span class=w>            </span><span class=p>}</span>
</span><span id=__span-47-42><a id=__codelineno-47-42 name=__codelineno-47-42 href=#__codelineno-47-42></a>
</span><span id=__span-47-43><a id=__codelineno-47-43 name=__codelineno-47-43 href=#__codelineno-47-43></a><span class=w>            </span><span class=n>current</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>next</span><span class=p>;</span>
</span><span id=__span-47-44><a id=__codelineno-47-44 name=__codelineno-47-44 href=#__codelineno-47-44></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-47-45><a id=__codelineno-47-45 name=__codelineno-47-45 href=#__codelineno-47-45></a>
</span><span id=__span-47-46><a id=__codelineno-47-46 name=__codelineno-47-46 href=#__codelineno-47-46></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>result</span><span class=p>;</span>
</span><span id=__span-47-47><a id=__codelineno-47-47 name=__codelineno-47-47 href=#__codelineno-47-47></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-47-48><a id=__codelineno-47-48 name=__codelineno-47-48 href=#__codelineno-47-48></a><span class=p>};</span>
</span></code></pre></div> <h2 id=conclusion>Conclusion<a class=headerlink href=#conclusion title="Permanent link">&para;</a></h2> <p>Optimizing time-related code requires careful consideration of both algorithmic efficiency and practical constraints. By following these guidelines and measuring performance in your specific use case, you can achieve optimal performance with Chronovyan.</p> <p>Remember to always profile your application to identify actual bottlenecks before optimizing. In many cases, the biggest performance gains come from higher-level architectural decisions rather than micro-optimizations of time operations. } } BENCHMARK(BM_TimeFormatting);</p> <p>BENCHMARK_MAIN(); ```</p> <h2 id=memory-usage>Memory Usage<a class=headerlink href=#memory-usage title="Permanent link">&para;</a></h2> <p>Be aware of the memory footprint:</p> <ul> <li><code>time_point&lt;system_clock&gt;</code>: Typically 8 bytes (64-bit)</li> <li><code>time_point&lt;system_clock, nanoseconds&gt;</code>: 16 bytes (for higher precision)</li> <li><code>zoned_time</code>: Larger due to time zone data</li> </ul> <h2 id=thread-safety>Thread Safety<a class=headerlink href=#thread-safety title="Permanent link">&para;</a></h2> <ul> <li><strong>Thread-safe</strong>: All const operations on time points and durations</li> <li><strong>Not thread-safe</strong>: Time zone database operations (use locks if modifying)</li> </ul> <h2 id=profiling-tips>Profiling Tips<a class=headerlink href=#profiling-tips title="Permanent link">&para;</a></h2> <ol> <li>Profile your application to identify time-related bottlenecks</li> <li>Look for:</li> <li>Excessive time zone conversions</li> <li>String formatting in tight loops</li> <li>Unnecessary time point copies</li> <li>Suboptimal duration types</li> </ol> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="June 9, 2025 21:02:26 UTC"><span class=timeago datetime=2025-06-09T21:02:26+00:00 locale=en></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="June 9, 2025 21:02:26 UTC">2025-06-09</span> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../timezones/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Timezones"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Timezones </div> </div> </a> <a href=../choosing_optimization_strategies/ class="md-footer__link md-footer__link--next" aria-label="Next: Choosing Optimization Strategies"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Choosing Optimization Strategies </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Forever Code Team </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/Chronovyan/Chronovyan target=_blank rel=noopener title=GitHub class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://twitter.com/chronovyan target=_blank rel=noopener title=Twitter class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg> </a> <a href=https://discord.gg/chronovyan target=_blank rel=noopener title=Discord class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485 485 0 0 0 404.081 32.03a1.82 1.82 0 0 0-1.923.91 338 338 0 0 0-14.9 30.6 447.9 447.9 0 0 0-134.426 0 310 310 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.7 483.7 0 0 0-119.688 37.107 1.7 1.7 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.02 2.02 0 0 0 .765 1.375 487.7 487.7 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348 348 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321 321 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251 251 0 0 0 9.109-7.137 1.82 1.82 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.81 1.81 0 0 1 1.924.233 235 235 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.4 301.4 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391 391 0 0 0 30.014 48.815 1.86 1.86 0 0 0 2.063.7A486 486 0 0 0 610.7 405.729a1.88 1.88 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541M222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241m195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241"/></svg> </a> </div> </div> </div> </footer> <!-- Custom footer content --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Forever Code Team </div> <div class=md-copyright__highlight> Made with ❤️ using <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener>Material for MkDocs</a> </div> </div> <!-- Social links --> <div class=md-social> <a href=https://github.com/Chronovyan/Chronovyan target=_blank rel=noopener title class=md-social__link> </a> <a href=https://twitter.com/chronovyan target=_blank rel=noopener title class=md-social__link> </a> <a href=https://discord.gg/chronovyan target=_blank rel=noopener title class=md-social__link> </a> </div> </div> </div> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "navigation.indexes", "navigation.footer", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.prune", "navigation.path", "toc.integrate", "header.autohide", "content.tabs.link", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate", "content.tooltips", "content.tooltips.blocks", "content.tooltips.links"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.13a4f30d.min.js></script> <script src=../../js/timeago.min.js></script> <script src=../../js/timeago_mkdocs_material.js></script> <script src=../../assets/javascripts/custom.js></script> </body> </html>